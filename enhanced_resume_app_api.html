<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Resume Database System</title>
    <style>
        body {
            font-family: 'Calibri', 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #2f5597;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: -1px;
            font-size: 14px;
        }
        .tab.active {
            background-color: white;
            font-weight: bold;
            border-bottom: 1px solid white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        textarea, input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            box-sizing: border-box;
        }
        button {
            background-color: #2f5597;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #1e3a6a;
        }
        button.secondary {
            background-color: #6c757d;
        }
        button.success {
            background-color: #28a745;
        }
        button.danger {
            background-color: #dc3545;
        }
        .search-interface {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .component-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .component-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #2f5597;
        }
        .component-card.selected {
            border-color: #2f5597;
            background-color: #e3f2fd;
        }
        .component-title {
            font-weight: bold;
            color: #2f5597;
            margin-bottom: 8px;
        }
        .component-preview {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
            max-height: none;
            overflow: visible;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        .component-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
        }
        .job-analysis {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .match-score {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }
        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .keyword-tag {
            background-color: #2f5597;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        .employment-entry {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fafafa;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-row.full {
            grid-template-columns: 1fr;
        }
        .suggestions-panel {
            background-color: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .suggestion-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background-color: #e3f2fd;
        }
        .ai-status {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
        }
        .resume-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .selected-components {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }
        .selected-component {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        .remove-component {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 12px;
            cursor: pointer;
            padding: 0;
            margin: 0;
        }
        .preview-pane {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        .instruction {
            background-color: #e9f7fe;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #2f5597;
        }
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2f5597;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .resume-builder {
                grid-template-columns: 1fr;
            }
            .tabs {
                overflow-x: auto;
            }
        }

        /* Resume Importer Styles */
        .resume-display-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            user-select: text;
            cursor: text;
        }

        .resume-display-area::-webkit-scrollbar {
            width: 8px;
        }

        .resume-display-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .resume-display-area::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .resume-display-area::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        .resume-display-controls {
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .upload-area {
            border: 2px dashed #ddd;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .upload-area:hover {
            border-color: #2f5597;
            background-color: #f8f9ff;
        }

        .import-method {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h2 {
            margin: 0;
            color: #2f5597;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover,
        .close:focus {
            color: #2f5597;
            text-decoration: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .modal-actions {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Component Action Buttons */
        .component-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            z-index: 10;
            position: relative;
        }

        .component-actions button {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .component-actions .edit-btn {
            background: #007bff;
            color: white;
        }

        .component-actions .edit-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }

        .component-actions .delete-btn {
            background: #dc3545;
            color: white;
        }

        .component-actions .delete-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(220,53,69,0.3);
        }

        /* Sub-tabs styles */
        .sub-tabs {
            display: flex;
            margin-bottom: 1rem;
        }

        .sub-tab {
            padding: 8px 16px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-bottom: none;
            margin-right: 2px;
            font-size: 14px;
            color: #6c757d;
            transition: all 0.2s ease;
        }

        .sub-tab:hover {
            background-color: #e9ecef;
            color: #495057;
        }

        .sub-tab.active {
            background-color: white;
            color: #2f5597;
            font-weight: 500;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* Resume and template card styles */
        .resume-card, .template-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .resume-card:hover, .template-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #2f5597;
        }

        .resume-meta, .template-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
            margin-top: 10px;
        }

        .file-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 8px;
        }

        .tag {
            background-color: #e9ecef;
            color: #495057;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
        }

        /* Resume Builder Interface Styles */
        .resume-builder-interface {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .components-sidebar {
            flex: 1;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .component-search {
            margin-bottom: 20px;
        }

        .component-search input, .component-search select {
            margin-bottom: 10px;
        }

        .component-list {
            list-style: none;
            padding: 0;
        }

        .builder-component-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .builder-component-item:hover {
            border-color: #2f5597;
            box-shadow: 0 2px 8px rgba(47, 85, 151, 0.2);
        }

        .builder-component-title {
            font-weight: bold;
            color: #2f5597;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .builder-component-preview {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            max-height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .builder-component-meta {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #888;
        }

        .add-to-cart-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-top: 5px;
        }

        .add-to-cart-btn:hover {
            background-color: #218838;
        }

        .add-to-cart-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .shopping-cart {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .cart-item {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            position: relative;
        }

        .cart-item-title {
            font-weight: bold;
            color: #2f5597;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .cart-item-preview {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
            max-height: 30px;
            overflow: hidden;
        }

        .cart-item-type {
            font-size: 10px;
            color: #888;
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
        }

        .remove-from-cart {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-from-cart:hover {
            background-color: #c82333;
        }

        .cart-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 10px;
        }

        .cart-stats {
            text-align: center;
            font-size: 12px;
            color: #666;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .resume-canvas {
            flex: 2;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .canvas-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .export-options button {
            white-space: nowrap;
        }

        .resume-preview {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Times New Roman', serif;
            line-height: 1.4;
        }

        .resume-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #2f5597;
            padding-bottom: 15px;
        }

        .resume-header h1 {
            margin: 0 0 8px 0;
            color: #2f5597;
            font-size: 24px;
            font-weight: bold;
        }

        .resume-header .header-line {
            margin: 4px 0;
            color: #666;
            font-size: 14px;
            line-height: 1.3;
        }

        .resume-header p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 14px;
        }




        .resume-content {
            min-height: 300px;
        }

        .resume-section {
            margin-bottom: 20px;
        }

        .resume-section h3 {
            color: #2f5597;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .resume-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fafafa;
            border-left: 3px solid #2f5597;
        }

        .resume-item h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 14px;
        }

        .resume-item p {
            margin: 0;
            font-size: 12px;
            line-height: 1.4;
        }

        .empty-canvas {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 50px 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 2px dashed #ddd;
        }

        .cart-empty {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        /* Responsive design for smaller screens */
        @media (max-width: 1200px) {
            .resume-builder-interface {
                flex-direction: column;
            }
            
            .components-sidebar, .shopping-cart, .resume-canvas {
                flex: none;
                max-height: none;
            }
            
            .shopping-cart {
                order: 2;
            }
            
            .resume-canvas {
                order: 3;
            }
        }

        @media (max-width: 768px) {
            .canvas-controls {
                flex-direction: column;
            }
            
            .canvas-controls button {
                margin-bottom: 5px;
            }
        }

        /* Enhanced Component Library Filter Styles */
        .search-interface label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
            font-size: 12px;
        }

        .search-interface select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            color: #333;
        }

        .search-interface select:focus {
            border-color: #2f5597;
            outline: none;
            box-shadow: 0 0 0 2px rgba(47, 85, 151, 0.2);
        }

        #filter-results-count {
            font-size: 14px;
            color: #666;
            font-weight: 500;
            text-align: right;
            padding: 8px 0;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 8px 12px;
        }

        .filter-active {
            background-color: #e3f2fd !important;
            border-color: #2f5597 !important;
            font-weight: bold !important;
        }

        .bulk-actions {
            display: none;
            background-color: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .bulk-actions.show {
            display: block;
        }

        .component-card.selected-for-bulk {
            border-color: #28a745;
            background-color: #f8fff8;
        }

        .component-card .bulk-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }

        /* Component grid enhancements */
        .component-grid {
            position: relative;
        }

        .no-components-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #ddd;
        }

        .filter-summary {
            background-color: #e9ecef;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #495057;
        }

        .filter-tag {
            display: inline-block;
            background-color: #2f5597;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-right: 5px;
            margin-bottom: 3px;
        }

        .clear-filter {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 1px 6px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            margin-left: 5px;
        }

        /* Resume Builder Shopping Cart Functions */

        /* Resume Importer Styles */
        .test-area { 
            border: 1px solid #ccc; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        /* Resume Importer Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-dialog {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin: 2vh auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #000;
        }

        .modal-body {
            padding: 20px;
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-section input,
        .form-section select,
        .form-section textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-section textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-actions {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Resume Library Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .resume-view-modal, .resume-edit-modal, .component-extraction-modal {
            background-color: white;
            border-radius: 12px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .resume-view-modal {
            width: 800px;
        }

        .resume-edit-modal, .component-extraction-modal {
            width: 900px;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background-color: #e9ecef;
            color: #333;
        }

        .modal-body {
            padding: 30px;
        }

        .resume-metadata {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .metadata-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 10px;
        }

        .metadata-row:last-child {
            margin-bottom: 0;
        }

        .metadata-row span {
            font-size: 14px;
            color: #666;
        }

        .metadata-row strong {
            color: #333;
        }

        .resume-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .resume-actions button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .content-viewer {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-section input, .form-section textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .form-section textarea {
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
        }

        .extraction-options {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .extraction-options h4 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
        }

        .radio-option {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 14px;
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
        }

        .text-selector {
            margin-bottom: 20px;
        }

        .text-selector textarea {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .component-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .extraction-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
        }

        .resume-card, .template-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .resume-card:hover, .template-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .file-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .resume-meta, .template-meta {
            font-size: 12px;
            color: #666;
            margin-top: 15px;
            margin-bottom: 15px;
            display: flex;
            gap: 15px;
        }

        .resume-meta span, .template-meta span {
            white-space: nowrap;
        }

        /* Responsive adjustments for modals */
        @media (max-width: 768px) {
            .resume-view-modal, .resume-edit-modal, .component-extraction-modal {
                width: 95vw;
                margin: 10px;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .metadata-row {
                flex-direction: column;
                gap: 5px;
            }
            
            .resume-actions, .modal-actions {
                flex-direction: column;
            }
            
            .resume-actions button, .modal-actions button {
                width: 100%;
            }
        }
        
        /* Work Order and Project Card Styles */
        .work-order-card {
            border-left: 4px solid #ff6b35;
            position: relative;
            min-height: 280px;
            padding: 20px;
        }
        .work-order-card:hover {
            border-left-color: #e55a2b;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
        }
        .work-order-card .component-title {
            color: #ff6b35;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        .work-order-card .component-preview {
            background: #fff8f6;
            border: 1px solid #ffe4dc;
            padding: 20px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .project-card {
            border-left: 4px solid #28a745;
            position: relative;
            min-height: 280px;
            padding: 20px;
        }
        .project-card:hover {
            border-left-color: #218838;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
        }
        .project-card .component-title {
            color: #28a745;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        .project-card .component-preview {
            background: #f8fff9;
            border: 1px solid #d4edda;
            padding: 20px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        /* Bulk Actions Panel */
        .bulk-actions {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        .bulk-actions h4 {
            margin-top: 0;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .bulk-actions p {
            color: #6c757d;
            margin-bottom: 15px;
        }
        .bulk-actions .form-row {
            margin-bottom: 10px;
        }
        .bulk-actions button {
            margin-right: 10px;
            margin-bottom: 5px;
        }
        
        /* Selection count styling */
        #work-order-bulk-selection-count,
        #project-bulk-selection-count {
            font-weight: bold;
            color: #495057;
            padding: 8px 12px;
            background: #e9ecef;
            border-radius: 4px;
            display: inline-block;
        }
        
        /* Selection checkboxes - normal positioning */
        .work-order-select, .project-select {
            margin: 0;
            transform: scale(1.1);
        }
        
        /* Title styling for work orders and projects */
        .work-order-card .card-title,
        .project-card .card-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0;
        }

        /* Work Orders Tiles Styles */
        .work-orders-tiles {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .work-order-tile {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
        }

        .work-order-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .work-order-tile.selected {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .work-order-tile.in-cart {
            border-color: #28a745;
            background: #f8fff8;
        }

        .work-order-tile-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .work-order-number {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .work-order-tile-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 10px 0;
            line-height: 1.3;
        }

        .work-order-tile-company {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .work-order-tile-description {
            font-size: 13px;
            color: #555;
            line-height: 1.4;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .work-order-tile-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .work-order-tile-tag {
            background: #e9ecef;
            color: #495057;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            border: 1px solid #dee2e6;
        }

        .work-order-tile-tag.tools {
            background: #ffeaa7;
            color: #2d3436;
        }

        .work-order-tile-tag.software {
            background: #74b9ff;
            color: white;
        }

        .work-order-tile-tag.skills {
            background: #fd79a8;
            color: white;
        }

        .work-order-tile-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .work-order-tile-actions button {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-view {
            background: #007bff;
            color: white;
        }

        .btn-view:hover {
            background: #0056b3;
        }

        .btn-cart {
            background: #28a745;
            color: white;
        }

        .btn-cart:hover {
            background: #1e7e34;
        }

        .btn-cart.in-cart {
            background: #6c757d;
        }

        .btn-cart.in-cart:hover {
            background: #545b62;
        }

        /* Work Order Modal Styles */
        .work-order-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .work-order-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .work-order-modal-header {
            background: #007bff;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .work-order-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .work-order-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .work-order-modal-close:hover {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        .work-order-modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .work-order-detail-section {
            margin-bottom: 20px;
        }

        .work-order-detail-section h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }

        .work-order-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .work-order-detail-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }

        .work-order-detail-label {
            font-weight: 600;
            color: #495057;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .work-order-detail-value {
            color: #333;
            font-size: 14px;
        }

        .work-order-modal-footer {
            background: #f8f9fa;
            padding: 15px 20px;
            border-top: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .controls-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        /* Load More Button Styles */
        .load-more-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        #load-more-work-orders {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        #load-more-work-orders:hover:not(:disabled) {
            background: #545b62;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        #load-more-work-orders:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Center the component meta information */
        .work-order-card .component-meta,
        .project-card .component-meta {
            text-align: center;
            justify-content: center;
            gap: 10px;
        }

        /* Personal Information Specific Styling */
        .personal-info-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .personal-info-section h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2f5597;
            border-bottom: 2px solid #2f5597;
            padding-bottom: 8px;
        }
        
        .personal-info-section label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            display: block;
        }
        
        .personal-info-section input {
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .personal-info-section input:focus {
            border-color: #2f5597;
            box-shadow: 0 0 0 3px rgba(47, 85, 151, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 AI-Powered Resume Database System</h1>
        
        <div class="instruction">
            <h3>Welcome to Your Intelligent Resume Builder!</h3>
            <p><strong>New Features:</strong> 🔍 Search resume components • 📋 Paste job descriptions for AI matching • 💼 Track employment history • 🎯 Get targeted suggestions</p>
            <p><strong>How it works:</strong> Build a database of resume components, paste job descriptions to get AI-powered matches, and generate customized resumes instantly.</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">📊 Dashboard</div>
            <div class="tab" data-tab="job-matcher">🎯 Job Matcher</div>
            <div class="tab" data-tab="component-library">📚 Component Library</div>
            <div class="tab" data-tab="employment-history">💼 Employment History</div>
            <div class="tab" data-tab="work-orders">🔧 Work Orders</div>
            <div class="tab" data-tab="projects">📂 Projects</div>
            <div class="tab" data-tab="resume-builder">🔨 Resume Builder</div>
            <div class="tab" data-tab="importer">📥 Resume Importer</div>
            <div class="tab" data-tab="resume-library">📁 Resume Library</div>
            <div class="tab" data-tab="settings">⚙️ Settings</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <h2>📊 Dashboard Overview</h2>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-number" id="total-components">0</div>
                    <div class="stat-label">Resume Components</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-jobs">0</div>
                    <div class="stat-label">Job Descriptions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-resumes">0</div>
                    <div class="stat-label">Generated Resumes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-employers">0</div>
                    <div class="stat-label">Employers</div>
                </div>
            </div>
            
            <div class="ai-status" id="ai-status">
                🤖 AI Resume Assistant Ready - Database initialized and ready for component matching
            </div>
            
            <h3>Recent Activity</h3>
            <div id="recent-activity">
                <p>📝 Start by importing your existing resumes or adding job descriptions to begin building your component library.</p>
            </div>
            
            <h3>Quick Actions</h3>
            <button onclick="switchTab('job-matcher')">🎯 Analyze New Job</button>
            <button onclick="switchTab('component-library')">📚 Browse Components</button>
            <button onclick="switchTab('resume-builder')">🔨 Build Resume</button>
            <button onclick="switchTab('importer')">📥 Import Resume</button>
        </div>
        
        <!-- Job Matcher Tab -->
        <div class="tab-content" id="job-matcher">
            <h2>🎯 AI Job Description Matcher</h2>
            
            <div class="search-interface">
                <h3>Paste Job Description</h3>
                <textarea id="job-description-input" rows="10" placeholder="Paste the complete job description here... The AI will analyze requirements and suggest matching resume components."></textarea>
                
                <div class="form-row">
                    <div>
                        <label for="company-name">Company Name:</label>
                        <input type="text" id="company-name" placeholder="Company Name">
                    </div>
                    <div>
                        <label for="position-title">Position Title:</label>
                        <input type="text" id="position-title" placeholder="Position Title">
                    </div>
                </div>
                
                <button onclick="analyzeJobDescription()" class="success">🔍 Analyze Job & Find Matches</button>
                <button onclick="saveJobDescription()" class="secondary">💾 Save Job Description</button>
            </div>
            
            <div id="job-analysis-results" style="display: none;">
                <div class="job-analysis">
                    <h3>📋 Analysis Results</h3>
                    <div id="extracted-keywords"></div>
                    <div id="match-suggestions"></div>
                </div>
                
                <div class="suggestions-panel">
                    <h3>🎯 Recommended Resume Components</h3>
                    <div id="component-suggestions"></div>
                </div>
            </div>
        </div>
        
        <!-- Component Library Tab -->
        <div class="tab-content" id="component-library">
            <h2>📚 Resume Component Library</h2>
            
            <div class="search-interface">
                <h3>🔍 Search & Filter Components</h3>
                
                <!-- Search Row -->
                <div class="form-row">
                    <div>
                        <label for="component-search">Search Keywords:</label>
                        <input type="text" id="component-search" placeholder="Search by keywords, title, or content...">
                    </div>
                    <div>
                        <button onclick="searchComponents()" class="success">🔍 Search</button>
                        <button onclick="clearSearchAndFilters()" class="secondary">🗑️ Clear All</button>
                    </div>
                </div>
                
                <!-- Filter Row -->
                <div class="form-row">
                    <div>
                        <label for="section-filter">Section Type:</label>
                        <select id="section-filter" onchange="filterComponents()">
                            <option value="">All Sections</option>
                            <option value="professional_summary">Professional Summary</option>
                            <option value="technical_skills">Technical Skills</option>
                            <option value="professional_skills">Professional Skills</option>
                            <option value="work_experience">Work Experience</option>
                            <option value="projects">Projects</option>
                            <option value="certifications">Certifications</option>
                            <option value="education">Education</option>
                            <option value="accomplishments">Accomplishments</option>
                            <option value="client_contract">Client/Contract</option>
                            <option value="summary_mission">Summary/Mission</option>
                        </select>
                    </div>
                    <div>
                        <label for="skill-level-filter">Skill Level:</label>
                        <select id="skill-level-filter" onchange="filterComponents()">
                            <option value="">All Levels</option>
                            <option value="entry">Entry Level</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                </div>
                
                <!-- Additional Filters Row -->
                <div class="form-row">
                    <div>
                        <label for="industry-filter">Industry:</label>
                        <select id="industry-filter" onchange="filterComponents()">
                            <option value="">All Industries</option>
                            <option value="technology">Technology</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="finance">Finance</option>
                            <option value="banking">Banking</option>
                            <option value="education">Education</option>
                            <option value="retail">Retail</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="consulting">Consulting</option>
                            <option value="government">Government</option>
                            <option value="nonprofit">Non-Profit</option>
                        </select>
                    </div>
                    <div>
                        <label for="usage-filter">Usage Count:</label>
                        <select id="usage-filter" onchange="filterComponents()">
                            <option value="">Any Usage</option>
                            <option value="unused">Never Used (0)</option>
                            <option value="low">Low Usage (1-3)</option>
                            <option value="medium">Medium Usage (4-10)</option>
                            <option value="high">High Usage (10+)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="form-row">
                    <div>
                        <button onclick="showAddComponentModal()" class="success">➕ Add New Component</button>
                        <button onclick="showBulkActions()" class="secondary">📦 Bulk Actions</button>
                    </div>
                    <div>
                        <span id="filter-results-count">Loading components...</span>
                    </div>
                </div>
            </div>
            
            <div class="component-grid" id="component-grid">
                <!-- Components will be populated here -->
            </div>
            
            <!-- Bulk Actions Panel (hidden by default) -->
            <div class="bulk-actions" id="bulk-actions-panel">
                <h4>📦 Bulk Actions</h4>
                <p>Select components by checking the boxes, then choose an action:</p>
                <div class="form-row">
                    <div>
                        <button onclick="selectAllVisibleComponents()" class="secondary">☑️ Select All Visible</button>
                        <button onclick="deselectAllComponents()" class="secondary">❌ Deselect All</button>
                    </div>
                    <div>
                        <button onclick="bulkAddToCart()" class="success">🛒 Add Selected to Cart</button>
                        <button onclick="bulkDelete()" class="danger">🗑️ Delete Selected</button>
                    </div>
                </div>
                <div id="bulk-selection-count">No components selected</div>
            </div>
        </div>
        
        <!-- Employment History Tab -->
        <div class="tab-content" id="employment-history">
            <h2>💼 Employment History Database</h2>
            
            <button onclick="showAddEmploymentModal()" class="success">➕ Add New Employer</button>
            <button onclick="exportEmploymentData()" class="secondary">📤 Export Data</button>
            
            <div id="employment-list">
                <!-- Employment history will be populated here -->
            </div>
        </div>
        
        <!-- Work Orders Tab -->
        <div class="tab-content" id="work-orders">
            <h2>🔧 Work Orders</h2>
            
            <div class="controls-panel">
                <div class="form-row">
                    <div>
                        <button onclick="loadWorkOrdersFromJsonl()" class="success">📥 Load JSONL Data</button>
                        <button onclick="refreshWorkOrders()" class="secondary">🔄 Refresh</button>
                    </div>
                    <div>
                        <input type="text" id="work-order-search" placeholder="Search work orders..." onkeyup="filterWorkOrders()">
                        <select id="company-filter" onchange="filterWorkOrders()">
                            <option value="">All Companies</option>
                        </select>
                        <select id="category-filter" onchange="filterWorkOrders()">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Work Order Statistics -->
            <div class="stats-panel" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-number" id="total-work-orders">0</div>
                    <div class="stat-label">Total Work Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="unique-companies">0</div>
                    <div class="stat-label">Companies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="selected-work-orders">0</div>
                    <div class="stat-label">Selected for Resume</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="cart-work-orders">0</div>
                    <div class="stat-label">In Cart</div>
                </div>
            </div>
            
            <!-- Work Orders Tiles Grid -->
            <div class="work-orders-tiles" id="work-orders-grid">
                <!-- Work order tiles will be populated here -->
            </div>
            
            <!-- Load More Button -->
            <div class="load-more-container" style="text-align: center; margin-top: 20px;">
                <button id="load-more-work-orders" onclick="loadMoreWorkOrders()" class="secondary" style="display: none;">
                    📄 Load More Work Orders
                </button>
            </div>
        </div>

        <!-- Work Order Modal -->
        <div id="work-order-modal" class="work-order-modal">
            <div class="work-order-modal-content">
                <div class="work-order-modal-header">
                    <h3 id="work-order-modal-title">Work Order Details</h3>
                    <button class="work-order-modal-close" onclick="closeWorkOrderModal()">&times;</button>
                </div>
                <div class="work-order-modal-body" id="work-order-modal-body">
                    <!-- Work order details will be populated here -->
                </div>
                <div class="work-order-modal-footer">
                    <button class="btn-cart" id="modal-cart-btn" onclick="toggleWorkOrderInCart()">Add to Cart</button>
                    <button class="btn-view" onclick="closeWorkOrderModal()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Projects Tab -->
        <div class="tab-content" id="projects">
            <h2>📂 Projects</h2>
            
            <div class="search-interface">
                <h3>🔍 Search & Filter Projects</h3>
                
                <!-- Search Row -->
                <div class="form-row">
                    <div>
                        <label for="project-search">Search Keywords:</label>
                        <input type="text" id="project-search" placeholder="Search by name, client, or description...">
                    </div>
                    <div>
                        <button onclick="searchProjects()" class="success">🔍 Search</button>
                        <button onclick="clearProjectFilters()" class="secondary">🗑️ Clear All</button>
                    </div>
                </div>
                
                <!-- Filter Row -->
                <div class="form-row">
                    <div>
                        <label for="project-type-filter">Project Type:</label>
                        <select id="project-type-filter" onchange="filterProjects()">
                            <option value="">All Types</option>
                        </select>
                    </div>
                    <div>
                        <label for="client-type-filter">Client Type:</label>
                        <select id="client-type-filter" onchange="filterProjects()">
                            <option value="">All Client Types</option>
                        </select>
                    </div>
                </div>
                
                <!-- Additional Filters Row -->
                <div class="form-row">
                    <div>
                        <label for="priority-filter">Priority Level:</label>
                        <select id="priority-filter" onchange="filterProjects()">
                            <option value="">All Priorities</option>
                            <option value="1">High Priority</option>
                            <option value="2">Medium Priority</option>
                            <option value="3">Low Priority</option>
                        </select>
                    </div>
                    <div>
                        <label for="project-status-filter">Status:</label>
                        <select id="project-status-filter" onchange="filterProjects()">
                            <option value="">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="planned">Planned</option>
                            <option value="on-hold">On Hold</option>
                        </select>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="form-row">
                    <div>
                        <button onclick="showCreateProjectModal()" class="success">➕ Create New Project</button>
                        <button onclick="showBulkProjectActions()" class="secondary">📦 Bulk Actions</button>
                        <button onclick="addSelectedProjectsToCart()" class="success">🛒 Add Selected to Cart</button>
                    </div>
                    <div>
                        <span id="project-results-count">Loading projects...</span>
                    </div>
                </div>
            </div>
            
            <!-- Project Statistics -->
            <div class="stats-panel" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-number" id="total-projects">0</div>
                    <div class="stat-label">Total Projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-projects">0</div>
                    <div class="stat-label">Active Projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="project-total-earnings">$0</div>
                    <div class="stat-label">Project Earnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-project-duration">0</div>
                    <div class="stat-label">Avg Duration (weeks)</div>
                </div>
            </div>
            
            <!-- Projects Grid -->
            <div class="component-grid" id="projects-grid">
                <!-- Projects will be populated here -->
            </div>
            
            <!-- Bulk Actions Panel (hidden by default) -->
            <div class="bulk-actions" id="project-bulk-actions-panel" style="display: none;">
                <h4>📦 Bulk Actions for Projects</h4>
                <p>Select projects by checking the boxes, then choose an action:</p>
                <div class="form-row">
                    <div>
                        <button onclick="selectAllVisibleProjects()" class="secondary">☑️ Select All Visible</button>
                        <button onclick="deselectAllProjects()" class="secondary">❌ Deselect All</button>
                    </div>
                    <div>
                        <button onclick="bulkAddProjectsToCart()" class="success">🛒 Add Selected to Cart</button>
                        <button onclick="bulkCreateComponentsFromProjects()" class="success">📝 Create Components</button>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <button onclick="bulkExportProjects()" class="secondary">📊 Export to CSV</button>
                        <button onclick="showBulkProjectActions()" class="secondary">❌ Hide Panel</button>
                    </div>
                    <div id="project-bulk-selection-count">No projects selected</div>
                </div>
            </div>
        </div>
        
        <!-- Resume Builder Tab -->
        <div class="tab-content" id="resume-builder">
            <h2>🔨 Resume Builder</h2>
            
            <div class="form-row">
                <div>
                    <label for="resume-title">Resume Title:</label>
                    <input type="text" id="resume-title" placeholder="e.g., Desktop Support Specialist - TechCorp">
                </div>
                <div>
                    <label for="target-job">Target Job ID (optional):</label>
                    <input type="text" id="target-job" placeholder="Link to specific job description">
                </div>
            </div>
            
            <!-- Resume Builder Interface -->
            <div class="resume-builder-interface">
                <!-- Component Library Sidebar -->
                <div class="components-sidebar">
                    <h3>📚 Component Library</h3>
                    <div class="component-search">
                        <input type="text" id="component-builder-search" placeholder="Search components..." onkeyup="filterBuilderComponents()">
                        <select id="component-type-filter" onchange="filterBuilderComponents()">
                            <option value="">All Types</option>
                            <option value="professional_summary">Professional Summary</option>
                            <option value="technical_skills">Technical Skills</option>
                            <option value="work_experience">Work Experience</option>
                            <option value="projects">Projects</option>
                            <option value="education">Education</option>
                            <option value="certifications">Certifications</option>
                            <option value="achievements">Achievements</option>
                        </select>
                    </div>
                    <div class="component-list" id="builder-component-list">
                        <!-- Components will be loaded here -->
                    </div>
                </div>
                
                <!-- Shopping Cart -->
                <div class="shopping-cart">
                    <h3>🛒 Shopping Cart</h3>
                    <div class="cart-items" id="cart-items">
                        <p>Add components to your cart to build your resume</p>
                    </div>
                    <div class="cart-actions">
                        <button onclick="clearCart()" class="secondary">🗑️ Clear Cart</button>
                        <button onclick="checkoutCart()" class="success">✅ Checkout</button>
                    </div>
                    <div class="cart-stats">
                        <span id="cart-count">0 items</span>
                    </div>
                </div>
                
                <!-- Resume Canvas -->
                <div class="resume-canvas">
                    <h3>📄 Resume Canvas</h3>
                    <div class="canvas-controls">
                        <button onclick="generateResumePreview()" class="success">🔄 Update Preview</button>
                        <div class="export-options">
                            <button onclick="exportResume()" class="secondary">📄 Export HTML</button>
                            <button onclick="exportResumeDocx()" class="secondary">📝 Export DOCX</button>
                            <button onclick="exportResumePdf()" class="secondary">📕 Export PDF</button>
                        </div>
                        <button onclick="saveResumeTemplate()" class="secondary">💾 Save Template</button>
                    </div>
                    <div class="resume-preview" id="resume-preview">
                        <div class="resume-header">
                            <h1 id="resume-name">Sadiqa 'Sadie' Thornton</h1>
                            <p id="resume-email" class="header-line">info@sadiethetechladyservices.net</p>
                            <p id="resume-phone" class="header-line" style="display: none;"></p>
                            <p id="resume-linkedin" class="header-line" style="display: none;"></p>
                            <p id="resume-location" class="header-line" style="display: none;"></p>
                        </div>
                        <div class="resume-content" id="resume-content">
                            <p class="empty-canvas">Select components from the library and add them to your cart, then checkout to build your resume.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resume Importer Tab -->
        <div class="tab-content" id="importer">
            <h2>📥 Resume Importer</h2>
            <p>Upload your resume to extract the text, then manually select and create components from the displayed content.</p>
            
            <div class="test-area">
                <h3>📎 Step 1: Upload Resume File</h3>
                <div class="upload-area" onclick="document.getElementById('resume-file-input').click()">
                    <p>📁 Click here to select a resume file</p>
                    <p style="font-size: 0.9rem; color: #666;">Supports: .txt, .doc, .docx, .pdf, .html</p>
                </div>
                <input type="file" id="resume-file-input" accept=".txt,.doc,.docx,.pdf,.html" style="display: none;" onchange="uploadAndDisplayResume()">
            </div>
            
            <div class="test-area">
                <h3>📝 Step 1 (Alternative): Paste Resume Text</h3>
                <textarea id="resume-text-input" rows="10" placeholder="Paste your resume text here..." style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 6px; font-family: inherit;">
John Doe
Senior Software Engineer

PROFESSIONAL SUMMARY
Experienced software engineer with 8+ years developing web applications using JavaScript, Python, and React. Strong background in full-stack development, database design, and cloud architecture.

TECHNICAL SKILLS
• Programming Languages: JavaScript, Python, Java, C#
• Frontend: React, Vue.js, HTML5, CSS3, Bootstrap
• Backend: Node.js, Django, Flask, Express.js
• Databases: PostgreSQL, MongoDB, MySQL, Redis
• Cloud: AWS, Azure, Docker, Kubernetes

WORK EXPERIENCE
Senior Software Engineer | TechCorp Inc. | 2020-Present
• Led development of microservices architecture serving 1M+ users
• Implemented CI/CD pipelines reducing deployment time by 60%
• Mentored junior developers and conducted code reviews
                </textarea>
                <br>
                <button class="success" onclick="displayImporterText()">📄 Display Text</button>
            </div>
            
            <div class="test-area" id="importer-text-display" style="display: none;">
                <h3>📄 Step 2: Select Text and Create Component</h3>
                <p>Select any text below with your mouse, then click the button:</p>
                <button class="success" onclick="createImporterComponent()">➕ Create Component from Selection</button>
                <button class="secondary" onclick="clearImporterDisplay()">🗑️ Clear Display</button>
                <div id="importer-resume-content" style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; background: #f9f9f9; user-select: text;">
                    <!-- Text will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Resume Library Tab -->
        <div class="tab-content" id="resume-library">
            <h2>📁 Resume Library</h2>
            
            <!-- Sub-tabs for Resume Library -->
            <div class="sub-tabs" style="border-bottom: 1px solid #ddd; margin-bottom: 20px;">
                <div class="sub-tab active" data-subtab="uploaded-resumes" onclick="switchResumeSubTab('uploaded-resumes')">📄 Uploaded Resumes</div>
                <div class="sub-tab" data-subtab="templates" onclick="switchResumeSubTab('templates')">📋 Templates</div>
            </div>
            
            <!-- Uploaded Resumes Section -->
            <div class="sub-tab-content active" id="uploaded-resumes">
                <div class="search-interface">
                    <h3>Uploaded Resume Documents</h3>
                    <p>View and manage all your uploaded resume files with full text content.</p>
                    
                    <div class="form-row">
                        <div>
                            <input type="text" id="resume-search" placeholder="Search by title, filename, or content...">
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <label>
                                <input type="checkbox" id="include-archived"> Include archived
                            </label>
                        </div>
                    </div>
                    <button onclick="searchUploadedResumes()" class="success">🔍 Search</button>
                    <button onclick="loadUploadedResumes()" class="secondary">🔄 Refresh</button>
                </div>
                
                <div class="stats-panel" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-number" id="total-uploaded-resumes">0</div>
                        <div class="stat-label">Total Resumes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-extracted-components">0</div>
                        <div class="stat-label">Components Extracted</div>
                    </div>
                </div>
                
                <div class="component-grid" id="uploaded-resumes-grid">
                    <!-- Uploaded resumes will be populated here -->
                </div>
            </div>
            
            <!-- Templates Section -->
            <div class="sub-tab-content" id="templates">
                <div class="search-interface">
                    <h3>Resume Templates</h3>
                    <p>Manage your resume templates for different roles and industries.</p>
                    
                    <div class="form-row">
                        <div>
                            <input type="text" id="template-search" placeholder="Search templates by name or role...">
                        </div>
                    </div>
                    <button onclick="searchTemplates()" class="success">🔍 Search</button>
                    <button onclick="showAddTemplateModal()" class="success">➕ Add Template</button>
                    <button onclick="loadTemplates()" class="secondary">🔄 Refresh</button>
                </div>
                
                <div class="component-grid" id="templates-grid">
                    <!-- Templates will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <h2>⚙️ System Settings</h2>
            
            <div class="search-interface">
                <h3>AI Configuration</h3>
                <div class="form-row">
                    <div>
                        <label for="ai-model">AI Model:</label>
                        <select id="ai-model">
                            <option value="local">Local LM Studio</option>
                            <option value="openai">OpenAI GPT-4</option>
                            <option value="anthropic">Claude</option>
                        </select>
                    </div>
                    <div>
                        <label for="match-threshold">Match Threshold:</label>
                        <input type="range" id="match-threshold" min="0.5" max="1.0" step="0.1" value="0.7">
                        <span id="threshold-value">0.7</span>
                    </div>
                </div>
                
                <h3>Database Management</h3>
                <button onclick="exportDatabase()" class="secondary">📤 Export Database</button>
                <button onclick="importDatabase()" class="secondary">📥 Import Database</button>
                <button onclick="clearDatabase()" class="danger">🗑️ Clear All Data</button>
                
                <h3>Personal Information</h3>
                <div class="personal-info-section">
                    <div class="form-row">
                        <div>
                            <label for="user-name">Full Name:</label>
                            <input type="text" id="user-name" value="Sadiqa 'Sadie' Thornton" placeholder="Enter your full name">
                        </div>
                        <div>
                            <label for="user-email">Email:</label>
                            <input type="email" id="user-email" value="info@sadiethetechladyservices.net" placeholder="your.email@example.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div>
                            <label for="user-phone">Phone Number:</label>
                            <input type="tel" id="user-phone" value="" placeholder="(555) 123-4567">
                        </div>
                        <div>
                            <label for="user-linkedin">LinkedIn Profile URL:</label>
                            <input type="url" id="user-linkedin" value="" placeholder="https://linkedin.com/in/yourprofile">
                        </div>
                    </div>
                    <div class="form-row">
                        <div>
                            <label for="user-city">City:</label>
                            <input type="text" id="user-city" value="" placeholder="Enter your city">
                        </div>
                        <div>
                            <label for="user-state">State:</label>
                            <input type="text" id="user-state" value="" placeholder="Enter your state">
                        </div>
                    </div>
                </div>
            </div>
            
            <button onclick="saveSettings()" class="success">💾 Save Settings</button>
        </div>
    </div>

    <!-- Modal for Adding Components -->
    <div id="component-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 30px; border-radius: 8px; width: 80%; max-width: 600px; max-height: 80%; overflow-y: auto;">
            <h3>➕ Add New Resume Component</h3>
            <div class="form-row">
                <div>
                    <label for="modal-section-type">Section Type:</label>
                    <select id="modal-section-type">
                        <option value="professional_summary">Professional Summary</option>
                        <option value="technical_skills">Technical Skills</option>
                        <option value="professional_skills">Professional Skills</option>
                        <option value="work_experience">Work Experience</option>
                        <option value="projects">Projects</option>
                        <option value="certifications">Certifications</option>
                        <option value="education">Education</option>
                        <option value="accomplishments">Accomplishments</option>
                        <option value="client_contract">Client/Contract</option>
                        <option value="summary_mission">Summary/Mission</option>
                        <option value="blank_component">Blank Component</option>
                    </select>
                </div>
                <div>
                    <label for="modal-skill-level">Skill Level:</label>
                    <select id="modal-skill-level">
                        <option value="entry">Entry Level</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>
            </div>
            <label for="modal-title">Component Title:</label>
            <input type="text" id="modal-title" placeholder="Brief descriptive title">
            <label for="modal-content">Content:</label>
            <textarea id="modal-content" rows="6" placeholder="Full component content"></textarea>
            <label for="modal-keywords">Keywords (comma-separated):</label>
            <input type="text" id="modal-keywords" placeholder="relevant, keywords, technologies">
            <label for="modal-industry-tags">Industry Tags (comma-separated):</label>
            <input type="text" id="modal-industry-tags" placeholder="healthcare, finance, technology">
            
            <div style="margin-top: 20px;">
                <button onclick="saveComponent()" class="success">💾 Save Component</button>
                <button onclick="closeModal('component-modal')" class="secondary">❌ Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Employment -->
    <div id="employment-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 30px; border-radius: 8px; width: 80%; max-width: 800px; max-height: 80%; overflow-y: auto;">
            <h3>💼 Add Employment History</h3>
            <div class="form-row">
                <div>
                    <label for="emp-company">Company Name:</label>
                    <input type="text" id="emp-company" placeholder="Company Name">
                </div>
                <div>
                    <label for="emp-position">Position Title:</label>
                    <input type="text" id="emp-position" placeholder="Job Title">
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="emp-start-date">Start Date:</label>
                    <input type="date" id="emp-start-date">
                </div>
                <div>
                    <label for="emp-end-date">End Date (leave blank if current):</label>
                    <input type="date" id="emp-end-date">
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="emp-location">Location:</label>
                    <input type="text" id="emp-location" placeholder="City, State">
                </div>
                <div>
                    <label for="emp-type">Employment Type:</label>
                    <select id="emp-type">
                        <option value="full-time">Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="freelance">Freelance</option>
                        <option value="internship">Internship</option>
                    </select>
                </div>
            </div>
            <label for="emp-responsibilities">Key Responsibilities (one per line):</label>
            <textarea id="emp-responsibilities" rows="4" placeholder="• Managed IT infrastructure&#10;• Provided technical support&#10;• Led deployment projects"></textarea>
            <label for="emp-achievements">Key Achievements (one per line):</label>
            <textarea id="emp-achievements" rows="3" placeholder="• Reduced downtime by 50%&#10;• Improved customer satisfaction&#10;• Led successful migration"></textarea>
            <label for="emp-technologies">Technologies Used (comma-separated):</label>
            <input type="text" id="emp-technologies" placeholder="Windows, Active Directory, ServiceNow">
            
            <div style="margin-top: 20px;">
                <button onclick="saveEmployment()" class="success">💾 Save Employment</button>
                <button onclick="closeModal('employment-modal')" class="secondary">❌ Cancel</button>
            </div>
        </div>
    </div>

    <!-- Resume Importer Component Creation Modal -->
    <div id="resume-importer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3>➕ Create Component from Selection</h3>
                <button class="close-btn" onclick="closeResumeImporterModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="form-section">
                    <label for="importer-selected-text">Selected Text:</label>
                    <textarea id="importer-selected-text" readonly rows="4" style="background: #f8f9fa; color: #6c757d; resize: vertical;"></textarea>
                </div>
                
                <div class="form-section">
                    <label for="importer-component-type">Component Type:</label>
                    <select id="importer-component-type">
                        <option value="professional_summary">📋 Professional Summary</option>
                        <option value="work_experience">💼 Work Experience</option>
                        <option value="technical_skills">🔧 Technical Skills</option>
                        <option value="professional_skills">💻 Professional Skills</option>
                        <option value="education">🎓 Education</option>
                        <option value="certifications">📜 Certifications</option>
                        <option value="accomplishments">🏆 Accomplishments</option>
                        <option value="projects">🚀 Projects</option>
                    </select>
                </div>
                
                <div class="form-section">
                    <label for="importer-component-title">Component Title:</label>
                    <input type="text" id="importer-component-title" placeholder="Enter a descriptive title">
                </div>
                
                <div class="form-section">
                    <label for="importer-component-content">Component Content:</label>
                    <textarea id="importer-component-content" rows="8" placeholder="Edit the content as needed..."></textarea>
                </div>
                
                <div class="form-section">
                    <label for="importer-component-keywords">Keywords (optional):</label>
                    <input type="text" id="importer-component-keywords" placeholder="e.g. project management, leadership, technical support">
                </div>
                
                <div class="form-section">
                    <label for="importer-component-industry">Industry Tags (optional):</label>
                    <input type="text" id="importer-component-industry" placeholder="e.g. healthcare, finance, technology">
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="success" onclick="saveImporterComponent()">💾 Save Component</button>
                <button class="secondary" onclick="closeResumeImporterModal()">❌ Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5001/api';
        let selectedComponents = [];
        
        // Database storage using localStorage (in production, use actual database)
        class ResumeDatabase {
            constructor() {
                this.components = JSON.parse(localStorage.getItem('resume_components') || '[]');
                this.employment = JSON.parse(localStorage.getItem('employment_history') || '[]');
                this.jobDescriptions = JSON.parse(localStorage.getItem('job_descriptions') || '[]');
                this.generatedResumes = JSON.parse(localStorage.getItem('generated_resumes') || '[]');
                this.selectedComponents = [];
            }
            
            saveComponents() {
                localStorage.setItem('resume_components', JSON.stringify(this.components));
            }
            
            saveEmployment() {
                localStorage.setItem('employment_history', JSON.stringify(this.employment));
            }
            
            saveJobDescriptions() {
                localStorage.setItem('job_descriptions', JSON.stringify(this.jobDescriptions));
            }
            
            saveGeneratedResumes() {
                localStorage.setItem('generated_resumes', JSON.stringify(this.generatedResumes));
            }
            
            addComponent(component) {
                component.id = Date.now().toString();
                component.created_at = new Date().toISOString();
                component.usage_count = 0;
                component.effectiveness_score = 0;
                this.components.push(component);
                this.saveComponents();
                return component;
            }
            
            addEmployment(employment) {
                employment.id = Date.now().toString();
                employment.created_at = new Date().toISOString();
                this.employment.push(employment);
                this.saveEmployment();
                return employment;
            }
            
            searchComponents(query, sectionFilter = '') {
                return this.components.filter(component => {
                    const matchesQuery = !query || 
                        component.title.toLowerCase().includes(query.toLowerCase()) ||
                        component.content.toLowerCase().includes(query.toLowerCase()) ||
                        (component.keywords && component.keywords.toLowerCase().includes(query.toLowerCase()));
                    
                    const matchesSection = !sectionFilter || component.section_type === sectionFilter;
                    
                    return matchesQuery && matchesSection;
                });
            }
            
            analyzeJobDescription(jobText) {
                // Simple keyword extraction (in production, use AI/NLP)
                const keywords = this.extractKeywords(jobText);
                const matches = this.findMatchingComponents(keywords);
                return { keywords, matches };
            }
            
            extractKeywords(text) {
                // Basic keyword extraction - would use AI in production
                const techKeywords = [
                    'windows', 'linux', 'macos', 'active directory', 'servicenow',
                    'desktop support', 'help desk', 'troubleshooting', 'hardware',
                    'software', 'network', 'security', 'server', 'cloud',
                    'office365', 'microsoft', 'vmware', 'citrix', 'azure',
                    'aws', 'cisco', 'dell', 'hp', 'lenovo', 'imaging',
                    'deployment', 'migration', 'backup', 'antivirus', 'firewall'
                ];
                
                const foundKeywords = [];
                const lowerText = text.toLowerCase();
                
                techKeywords.forEach(keyword => {
                    if (lowerText.includes(keyword)) {
                        foundKeywords.push(keyword);
                    }
                });
                
                return foundKeywords;
            }
            
            findMatchingComponents(keywords) {
                const matches = [];
                
                this.components.forEach(component => {
                    let score = 0;
                    const componentText = (component.title + ' ' + component.content + ' ' + (component.keywords || '')).toLowerCase();
                    
                    keywords.forEach(keyword => {
                        if (componentText.includes(keyword.toLowerCase())) {
                            score += 1;
                        }
                    });
                    
                    if (score > 0) {
                        matches.push({
                            component: component,
                            score: score,
                            matchPercentage: Math.round((score / keywords.length) * 100)
                        });
                    }
                });
                
                return matches.sort((a, b) => b.score - a.score);
            }
        }
        
        // Initialize database
        const db = new ResumeDatabase();
        
        // Tab navigation
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Load content based on tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'component-library':
                    loadComponentLibrary();
                    break;
                case 'employment-history':
                    loadEmploymentHistory();
                    break;
                case 'work-orders':
                    loadWorkOrders();
                    break;
                case 'projects':
                    loadProjects();
                    break;
                case 'resume-library':
                    loadUploadedResumes(); // Load uploaded resumes by default
                    break;
                case 'resume-builder':
                    initializeResumeBuilder();
                    // Update resume header when switching to resume builder
                    if (typeof updateResumeHeader === 'function') {
                        updateResumeHeader();
                    }
                    break;
            }
        }
        
        // Event listeners for tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                switchTab(tabName);
            });
        });
        
        // Dashboard functions
        function loadDashboard() {
            document.getElementById('total-components').textContent = db.components.length;
            document.getElementById('total-jobs').textContent = db.jobDescriptions.length;
            document.getElementById('total-resumes').textContent = db.generatedResumes.length;
            document.getElementById('total-employers').textContent = db.employment.length;
        }
        
        // Job Matcher functions
        function analyzeJobDescription() {
            const jobText = document.getElementById('job-description-input').value;
            const companyName = document.getElementById('company-name').value;
            const positionTitle = document.getElementById('position-title').value;
            
            if (!jobText.trim()) {
                alert('Please paste a job description to analyze.');
                return;
            }
            
            // Update AI status
            document.getElementById('ai-status').innerHTML = '🔄 Analyzing job description and finding matches...';
            
            setTimeout(() => {
                const analysis = db.analyzeJobDescription(jobText);
                displayJobAnalysis(analysis, jobText, companyName, positionTitle);
                
                document.getElementById('ai-status').innerHTML = `✅ Analysis complete! Found ${analysis.matches.length} matching components.`;
            }, 1000);
        }
        
        function displayJobAnalysis(analysis, jobText, companyName, positionTitle) {
            // Show results section
            document.getElementById('job-analysis-results').style.display = 'block';
            
            // Display extracted keywords
            const keywordsHtml = analysis.keywords.map(keyword => 
                `<span class="keyword-tag">${keyword}</span>`
            ).join('');
            document.getElementById('extracted-keywords').innerHTML = `
                <h4>🔍 Extracted Keywords (${analysis.keywords.length}):</h4>
                <div class="keyword-list">${keywordsHtml}</div>
            `;
            
            // Display component suggestions
            const suggestionsHtml = analysis.matches.map(match => `
                <div class="suggestion-item" onclick="addComponentToResume('${match.component.id}')">
                    <div class="match-score">Match: ${match.matchPercentage}%</div>
                    <strong>${match.component.title}</strong>
                    <p>${match.component.content.substring(0, 150)}...</p>
                    <small>Section: ${match.component.section_type} | Score: ${match.score}/${analysis.keywords.length}</small>
                </div>
            `).join('');
            
            document.getElementById('component-suggestions').innerHTML = suggestionsHtml || '<p>No matching components found. Consider adding more components to your library.</p>';
        }
        
        function saveJobDescription() {
            const jobText = document.getElementById('job-description-input').value;
            const companyName = document.getElementById('company-name').value;
            const positionTitle = document.getElementById('position-title').value;
            
            if (!jobText.trim() || !companyName.trim() || !positionTitle.trim()) {
                alert('Please fill in job description, company name, and position title.');
                return;
            }
            
            const jobDesc = {
                id: Date.now().toString(),
                company_name: companyName,
                position_title: positionTitle,
                job_description: jobText,
                keywords: db.extractKeywords(jobText),
                status: 'saved',
                created_at: new Date().toISOString()
            };
            
            db.jobDescriptions.push(jobDesc);
            db.saveJobDescriptions();
            
            alert('Job description saved successfully!');
            loadDashboard();
        }
        
        // Resume Importer functions (Working Version)
        let importerSelectedText = '';
        
        // Upload and display resume file
        async function uploadAndDisplayResume() {
            const fileInput = document.getElementById('resume-file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('Please select a file first.', 'error');
                return;
            }
            
            showStatus('📤 Uploading and processing file...', 'info');
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/upload_resume_file', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayImporterResumeText(result.text, result.filename);
                    showStatus(`✅ ${result.message}`, 'success');
                } else {
                    showStatus(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                showStatus('❌ Error uploading file. Please try again.', 'error');
            }
        }

        // Display pasted text
        function displayImporterText() {
            const textArea = document.getElementById('resume-text-input');
            const text = textArea.value.trim();
            
            if (!text) {
                showStatus('Please enter some text first', 'error');
                return;
            }
            
            displayImporterResumeText(text, 'Pasted Text');
            showStatus('✅ Text displayed. Now select some text with your mouse.', 'info');
        }
        
        // Display resume text in the preview area
        function displayImporterResumeText(text, filename) {
            const content = document.getElementById('importer-resume-content');
            const displayDiv = document.getElementById('importer-text-display');
            
            if (!content || !displayDiv) {
                console.error('Resume display elements not found');
                showStatus('Error: Display elements not found.', 'error');
                return;
            }
            
            content.textContent = text;
            displayDiv.style.display = 'block';
            
            // Remove existing event listeners to avoid duplicates
            content.removeEventListener('mouseup', handleImporterSelection);
            // Add selection event listener
            content.addEventListener('mouseup', handleImporterSelection);
            
            console.log('Resume text displayed and event listener added');
        }

        // Handle text selection
        function handleImporterSelection() {
            const selection = window.getSelection();
            importerSelectedText = selection.toString().trim();
            
            console.log('Selected text:', importerSelectedText);
            
            if (importerSelectedText.length > 10) {
                showStatus(`Selected: "${importerSelectedText.substring(0, 50)}${importerSelectedText.length > 50 ? '...' : ''}"`, 'info');
            } else if (importerSelectedText.length > 0) {
                showStatus('Please select at least 10 characters', 'error');
            }
        }

        // Create component from selected text
        function createImporterComponent() {
            console.log('createImporterComponent called, selectedText:', importerSelectedText);
            
            if (!importerSelectedText || importerSelectedText.length < 10) {
                showStatus('Please select at least 10 characters of text first', 'error');
                return;
            }
            
            // Fill modal
            const selectedTextArea = document.getElementById('importer-selected-text');
            const contentTextArea = document.getElementById('importer-component-content');
            const titleInput = document.getElementById('importer-component-title');
            
            if (!selectedTextArea || !contentTextArea || !titleInput) {
                console.error('Modal form elements not found');
                showStatus('Error: Modal form elements not found.', 'error');
                return;
            }
            
            selectedTextArea.value = importerSelectedText;
            contentTextArea.value = importerSelectedText;
            
            // Generate title
            const title = importerSelectedText.substring(0, 50).replace(/\n.*/, '') + (importerSelectedText.length > 50 ? '...' : '');
            titleInput.value = title;
            
            // Show modal
            const modal = document.getElementById('resume-importer-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Modal displayed');
                showStatus('Modal opened. Fill out the form and save.', 'info');
            } else {
                console.error('Modal not found');
                showStatus('Error: Modal not found.', 'error');
            }
        }

        // Save component from importer
        async function saveImporterComponent() {
            const data = {
                section_type: document.getElementById('importer-component-type').value,
                title: document.getElementById('importer-component-title').value.trim(),
                content: document.getElementById('importer-component-content').value.trim(),
                keywords: document.getElementById('importer-component-keywords').value.trim(),
                industry_tags: document.getElementById('importer-component-industry').value.trim()
            };
            
            console.log('Saving component:', data);
            
            if (!data.title || !data.content) {
                showStatus('Please provide both title and content', 'error');
                return;
            }
            
            try {
                showStatus('💾 Saving component...', 'info');
                
                const response = await fetch('/add_component', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                console.log('API Response:', result);
                
                if (result.success) {
                    showStatus(`✅ Component "${data.title}" created successfully! ID: ${result.id}`, 'success');
                    closeResumeImporterModal();
                    // Refresh component library and dashboard
                    if (typeof loadComponentLibrary === 'function') {
                        loadComponentLibrary();
                    }
                    if (typeof loadDashboard === 'function') {
                        loadDashboard();
                    }
                } else {
                    showStatus(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error saving component:', error);
                showStatus(`❌ Network error: ${error.message}`, 'error');
            }
        }

        // Close resume importer modal
        function closeResumeImporterModal() {
            const modal = document.getElementById('resume-importer-modal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            // Clear form
            document.getElementById('importer-component-title').value = '';
            document.getElementById('importer-component-content').value = '';
            document.getElementById('importer-component-keywords').value = '';
            document.getElementById('importer-component-industry').value = '';
            document.getElementById('importer-selected-text').value = '';
            
            console.log('Modal closed and form cleared');
        }

        // Clear resume display
        function clearImporterDisplay() {
            const displayDiv = document.getElementById('importer-text-display');
            const content = document.getElementById('importer-resume-content');
            
            if (displayDiv) {
                displayDiv.style.display = 'none';
            }
            if (content) {
                content.textContent = '';
            }
            
            importerSelectedText = '';
            showStatus('Resume display cleared.', 'info');
        }

        // Status message function
        function showStatus(message, type = 'info') {
            let statusDiv = document.getElementById('status-messages');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'status-messages';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    max-width: 400px;
                    padding: 1rem;
                    background: #f8f9ff;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                document.body.appendChild(statusDiv);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.parentNode.removeChild(statusDiv);
                    }
                }, 5000);
            }
            
            // Set styles based on type
            const styles = {
                info: { background: '#e3f2fd', border: '1px solid #2196f3', color: '#1976d2' },
                success: { background: '#e8f5e8', border: '1px solid #4caf50', color: '#2e7d32' },
                error: { background: '#ffebee', border: '1px solid #f44336', color: '#c62828' },
                warning: { background: '#fff3cd', border: '1px solid #ffc107', color: '#856404' }
            };
            
            const style = styles[type] || styles.info;
            statusDiv.innerHTML = `<div style="background: ${style.background}; border: ${style.border}; color: ${style.color}; padding: 0.75rem; border-radius: 6px;">${message}</div>`;
            
            // Auto-clear success and info messages after 5 seconds
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    if (statusDiv && statusDiv.innerHTML) {
                        statusDiv.innerHTML = '';
                    }
                }, 5000);
            }
        }

        // Update component display to use API and new filtering system
        async function loadComponentLibrary() {
            // Initialize filter event listeners if not already set
            initializeFilterEventListeners();
            
            // Use the new filtering system instead of direct display
            await filterComponents();
        }

        // Initialize filter event listeners
        function initializeFilterEventListeners() {
            // Add search input event listener for real-time filtering
            const searchInput = document.getElementById('component-search');
            if (searchInput && !searchInput.hasAttribute('data-listener-added')) {
                searchInput.addEventListener('keyup', function(event) {
                    // Filter on Enter key or after a brief delay
                    if (event.key === 'Enter') {
                        filterComponents();
                    } else {
                        // Debounced filtering for real-time search
                        clearTimeout(searchInput.filterTimeout);
                        searchInput.filterTimeout = setTimeout(filterComponents, 300);
                    }
                });
                searchInput.setAttribute('data-listener-added', 'true');
            }

            // Ensure all filter dropdowns have their onchange handlers
            const filterElements = [
                'section-filter',
                'skill-level-filter', 
                'industry-filter',
                'usage-filter'
            ];
            
            filterElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && !element.hasAttribute('data-listener-added')) {
                    element.addEventListener('change', filterComponents);
                    element.setAttribute('data-listener-added', 'true');
                }
            });
        }

        // Legacy function kept for compatibility - now redirects to filtering
        function displayComponents(components) {
            displayFilteredComponents(components);
        }

        // Delete component function
        async function deleteComponent(componentId, componentTitle) {
            const confirmed = confirm(`Are you sure you want to delete "${componentTitle}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch(`/api/components/${componentId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showStatus(`✅ Component "${componentTitle}" deleted successfully!`, 'success');
                    loadComponentLibrary();
                    loadDashboard();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error deleting component: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting component:', error);
                showStatus('❌ Error deleting component. Please try again.', 'error');
            }
        }

        // Edit component function
        async function editComponentDetails(componentId) {
            try {
                // First try to get component from API
                const response = await fetch(`/api/components/${componentId}`);
                let component;
                
                if (response.ok) {
                    component = await response.json();
                } else {
                    // Fallback to local storage
                    component = db.components.find(comp => comp.id == componentId);
                }
                
                if (!component) {
                    showStatus('Component not found.', 'error');
                    return;
                }
                
                // Pre-fill the component modal with existing data
                document.getElementById('modal-section-type').value = component.section_type_name || component.section_type || 'professional_summary';
                document.getElementById('modal-skill-level').value = component.skill_level || 'intermediate';
                document.getElementById('modal-title').value = component.title || '';
                document.getElementById('modal-content').value = component.content || '';
                document.getElementById('modal-keywords').value = component.keywords || '';
                document.getElementById('modal-industry-tags').value = component.industry_tags || '';
                
                // Store the ID for updating instead of creating new
                window.editingComponentId = componentId;
                
                // Show the modal
                document.getElementById('component-modal').style.display = 'block';
                
                showStatus('Editing component. Modify the details and save.', 'info');
                
            } catch (error) {
                console.error('Error loading component for editing:', error);
                showStatus('Error loading component for editing.', 'error');
            }
        }

        // Update dashboard to use API
        async function loadDashboard() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                document.getElementById('total-components').textContent = stats.total_components || 0;
                document.getElementById('total-jobs').textContent = stats.total_resumes || 0;
                document.getElementById('total-resumes').textContent = stats.total_resumes || 0;
                document.getElementById('total-employers').textContent = stats.total_employment || 0;
            } catch (error) {
                console.error('Error loading dashboard:', error);
                // Fallback to local storage
                document.getElementById('total-components').textContent = db.components.length;
                document.getElementById('total-jobs').textContent = db.jobDescriptions.length;
                document.getElementById('total-resumes').textContent = db.generatedResumes.length;
                document.getElementById('total-employers').textContent = db.employment.length;
            }
        }

        // Settings functions
        function saveSettings() {
            // Collect all personal information fields
            const personalInfo = {
                fullName: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                phone: document.getElementById('user-phone').value,
                linkedin: document.getElementById('user-linkedin').value,
                city: document.getElementById('user-city').value,
                state: document.getElementById('user-state').value,
                aiModel: document.getElementById('ai-model').value,
                matchThreshold: document.getElementById('match-threshold').value
            };
            
            // Save to localStorage
            localStorage.setItem('user_personal_info', JSON.stringify(personalInfo));
            
            // Also save individual settings for compatibility
            localStorage.setItem('ai_model', personalInfo.aiModel);
            localStorage.setItem('match_threshold', personalInfo.matchThreshold);
            
            console.log('Saved personal information:', personalInfo);
            
            // Update resume header with new information
            if (typeof updateResumeHeader === 'function') {
                updateResumeHeader();
            }
            
            showStatus('Settings saved successfully!', 'success');
        }
        
        // Load settings on page load
        function loadSettings() {
            try {
                const savedInfo = localStorage.getItem('user_personal_info');
                if (savedInfo) {
                    const personalInfo = JSON.parse(savedInfo);
                    
                    // Populate all fields if they exist
                    if (personalInfo.fullName) document.getElementById('user-name').value = personalInfo.fullName;
                    if (personalInfo.email) document.getElementById('user-email').value = personalInfo.email;
                    if (personalInfo.phone) document.getElementById('user-phone').value = personalInfo.phone;
                    if (personalInfo.linkedin) document.getElementById('user-linkedin').value = personalInfo.linkedin;
                    if (personalInfo.city) document.getElementById('user-city').value = personalInfo.city;
                    if (personalInfo.state) document.getElementById('user-state').value = personalInfo.state;
                    if (personalInfo.aiModel) document.getElementById('ai-model').value = personalInfo.aiModel;
                    if (personalInfo.matchThreshold) {
                        document.getElementById('match-threshold').value = personalInfo.matchThreshold;
                        document.getElementById('threshold-value').textContent = personalInfo.matchThreshold;
                    }
                }
                
                // Load individual settings for compatibility
                const aiModel = localStorage.getItem('ai_model');
                const matchThreshold = localStorage.getItem('match_threshold');
                
                if (aiModel && !savedInfo) document.getElementById('ai-model').value = aiModel;
                if (matchThreshold && !savedInfo) {
                    document.getElementById('match-threshold').value = matchThreshold;
                    document.getElementById('threshold-value').textContent = matchThreshold;
                }
                
                // Update resume header with loaded information
                if (typeof updateResumeHeader === 'function') {
                    updateResumeHeader();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // Helper function to get current personal info for resume exports
        function getCurrentPersonalInfo() {
            return {
                fullName: document.getElementById('user-name').value || '',
                email: document.getElementById('user-email').value || '',
                phone: document.getElementById('user-phone').value || '',
                linkedin: document.getElementById('user-linkedin').value || '',
                city: document.getElementById('user-city').value || '',
                state: document.getElementById('user-state').value || '',
                location: `${document.getElementById('user-city').value || ''}, ${document.getElementById('user-state').value || ''}`.replace(/^,\s*|,\s*$/g, ''),
                contactInfo: [
                    document.getElementById('user-email').value || '',
                    document.getElementById('user-phone').value || '',
                    document.getElementById('user-linkedin').value || '',
                    `${document.getElementById('user-city').value || ''}, ${document.getElementById('user-state').value || ''}`.replace(/^,\s*|,\s*$/g, '')
                ].filter(info => info.trim() !== '').join(' | ')
            };
        }
        
        function exportDatabase() {
            const data = {
                components: db.components,
                employment: db.employment,
                jobDescriptions: db.jobDescriptions,
                generatedResumes: db.generatedResumes
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resume_database_backup.json';
            a.click();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadSettings(); // Load personal information and settings
            
            // Add sample data if database is empty
            if (db.components.length === 0) {
                addSampleData();
            }
        });
        
        function addSampleData() {
            // Add sample components
            const sampleComponents = [
                {
                    section_type: 'professional_summary',
                    title: 'Desktop Support Specialist Summary',
                    content: 'Experienced Desktop Support Specialist with 16+ years providing technical support across diverse environments. Expert in Windows, Active Directory, and ServiceNow with proven track record in enterprise deployments.',
                    keywords: 'desktop support, windows, active directory, servicenow, technical support',
                    industry_tags: 'healthcare, finance, technology',
                    skill_level: 'expert'
                },
                {
                    section_type: 'technical_skills',
                    title: 'Windows Administration',
                    content: 'Windows 10/11, Windows Server 2016/2019, Active Directory, Group Policy, BitLocker, VDI, Remote Desktop Services',
                    keywords: 'windows, server, active directory, group policy, bitlocker',
                    industry_tags: 'enterprise, corporate',
                    skill_level: 'expert'
                },
                {
                    section_type: 'projects',
                    title: 'TD Bank Desktop Deployment',
                    content: 'Led desktop support deployment across 20 retail locations during 2020 rollout, ensuring minimal disruption and seamless transition to new hardware and software systems.',
                    keywords: 'deployment, retail, project management, hardware',
                    industry_tags: 'finance, banking',
                    skill_level: 'advanced'
                }
            ];
            
            sampleComponents.forEach(component => {
                db.addComponent(component);
            });
            
            // Add sample employment
            const sampleEmployment = {
                company_name: 'Field Services Nationwide',
                position_title: 'Senior Desktop Support Technician',
                start_date: '2020-01-01',
                end_date: '',
                location: 'Vermont, USA',
                employment_type: 'contract',
                responsibilities: 'Desktop support, hardware deployment, troubleshooting, customer service',
                achievements: 'Completed 960+ work orders with 99% customer satisfaction',
                technologies: 'Windows, Active Directory, ServiceNow, SCCM, BitLocker'
            };
            
            db.addEmployment(sampleEmployment);
        }

        // Modal functions
        function showAddComponentModal() {
            document.getElementById('component-modal').style.display = 'block';
        }
        
        function showAddEmploymentModal() {
            document.getElementById('employment-modal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Clear editing state when closing employment modal
            if (modalId === 'employment-modal' && window.editingEmploymentId) {
                delete window.editingEmploymentId;
                
                // Clear the form
                const fields = ['emp-company', 'emp-position', 'emp-start-date', 'emp-end-date', 
                               'emp-location', 'emp-type', 'emp-responsibilities', 'emp-achievements', 'emp-technologies'];
                fields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) element.value = '';
                });
            }
            
            // Clear editing state when closing component modal
            if (modalId === 'component-modal' && window.editingComponentId) {
                delete window.editingComponentId;
                
                // Clear the form
                const fields = ['modal-title', 'modal-content', 'modal-keywords', 'modal-industry-tags'];
                fields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) element.value = '';
                });
                
                // Reset selects to default
                document.getElementById('modal-section-type').value = 'professional_summary';
                document.getElementById('modal-skill-level').value = 'intermediate';
            }
        }

        // Component and employment functions
        function selectComponent(componentId) {
            showStatus('Component selected', 'info');
        }

        function searchComponents() {
            // This function now also triggers the filter process
            filterComponents();
        }

        // New comprehensive filtering function
        async function filterComponents() {
            try {
                const searchQuery = document.getElementById('component-search').value.toLowerCase().trim();
                const sectionFilter = document.getElementById('section-filter').value;
                const skillLevelFilter = document.getElementById('skill-level-filter').value;
                const industryFilter = document.getElementById('industry-filter').value;
                const usageFilter = document.getElementById('usage-filter').value;
                
                console.log('Filter values:', { searchQuery, sectionFilter, skillLevelFilter, industryFilter, usageFilter });
                
                // Load components from API or local storage
                let allComponents = [];
                try {
                    const response = await fetch('/api/components');
                    if (response.ok) {
                        allComponents = await response.json();
                        console.log('Loaded components from API:', allComponents.length);
                        
                        // Debug: Log section types of first few components
                        if (allComponents.length > 0) {
                            console.log('Sample component section types:', 
                                allComponents.slice(0, 5).map(c => ({ 
                                    id: c.id, 
                                    title: c.title, 
                                    section_type: c.section_type,
                                    section_type_name: c.section_type_name 
                                }))
                            );
                        }
                        
                        // Debug: Show what section filter value we're looking for
                        if (sectionFilter) {
                            console.log('Looking for section filter:', sectionFilter);
                        }
                    } else {
                        // Fallback to local storage
                        allComponents = db.components || [];
                        console.log('Using local storage components:', allComponents.length);
                    }
                } catch (error) {
                    console.error('Error loading components:', error);
                    allComponents = db.components || [];
                    console.log('Using local storage after error:', allComponents.length);
                }
                
                // Apply filters
                let filteredComponents = allComponents.filter(component => {
                    // Search query filter (if provided)
                    if (searchQuery) {
                        const searchableText = [
                            component.title || '',
                            component.content || '',
                            component.keywords || '',
                            component.industry_tags || ''
                        ].join(' ').toLowerCase();
                        
                        if (!searchableText.includes(searchQuery)) {
                            return false;
                        }
                    }
                    
                    // Section type filter - handle both section_type and section_type_name
                    if (sectionFilter) {
                        // Create bidirectional mapping for section types
                        const sectionMapping = {
                            // Database key -> Display name
                            'professional_summary': 'Professional Summary',
                            'technical_skills': 'Technical Skills',
                            'professional_skills': 'Professional Skills',
                            'work_experience': 'Work Experience',
                            'projects': 'Projects',
                            'certifications': 'Certifications',
                            'education': 'Education',
                            'accomplishments': 'Accomplishments',
                            'client_contract': 'Client/Contract',
                            'summary_mission': 'Summary/Mission',
                            'blank_component': 'Blank Component',
                            'general': 'General'
                        };
                        
                        // Reverse mapping: Display name -> Database key
                        const displayToKey = {};
                        Object.keys(sectionMapping).forEach(key => {
                            displayToKey[sectionMapping[key]] = key;
                        });
                        
                        // Get the component's section type (normalize to database key)
                        let componentSectionKey = component.section_type;
                        if (!componentSectionKey && component.section_type_name) {
                            // If we have a display name, convert it to database key
                            componentSectionKey = displayToKey[component.section_type_name] || component.section_type_name.toLowerCase().replace(/[^a-z0-9]/g, '_');
                        }
                        
                        // Default to 'general' if no section type found
                        componentSectionKey = componentSectionKey || 'general';
                        
                        // Compare with the selected filter
                        if (componentSectionKey !== sectionFilter) {
                            return false;
                        }
                    }
                    
                    // Skill level filter
                    if (skillLevelFilter && component.skill_level !== skillLevelFilter) {
                        return false;
                    }
                    
                    // Industry filter
                    if (industryFilter) {
                        const industryTags = (component.industry_tags || '').toLowerCase();
                        if (!industryTags.includes(industryFilter)) {
                            return false;
                        }
                    }
                    
                    // Usage count filter
                    if (usageFilter) {
                        const usageCount = component.usage_count || 0;
                        switch (usageFilter) {
                            case 'unused':
                                if (usageCount !== 0) return false;
                                break;
                            case 'low':
                                if (usageCount < 1 || usageCount > 3) return false;
                                break;
                            case 'medium':
                                if (usageCount < 4 || usageCount > 10) return false;
                                break;
                            case 'high':
                                if (usageCount < 10) return false;
                                break;
                        }
                    }
                    
                    return true;
                });
                
                console.log('Filtered components:', filteredComponents.length);
                
                // Display filtered components
                displayFilteredComponents(filteredComponents);
                
                // Update filter UI
                updateFilterDisplay(filteredComponents.length, allComponents.length);
                updateFilterActiveStates();
                
            } catch (error) {
                console.error('Error in filterComponents:', error);
                showStatus('Error filtering components. Please try again.', 'error');
            }
        }

        function displayFilteredComponents(components) {
            const grid = document.getElementById('component-grid');
            
            // Section type mapping for better display names
            const sectionTypeNames = {
                'professional_summary': 'Professional Summary',
                'technical_skills': 'Technical Skills',
                'professional_skills': 'Professional Skills',
                'work_experience': 'Work Experience',
                'projects': 'Projects',
                'certifications': 'Certifications',
                'education': 'Education',
                'accomplishments': 'Accomplishments',
                'client_contract': 'Client/Contract',
                'summary_mission': 'Summary/Mission',
                'blank_component': 'Blank Component',
                'general': 'General'
            };
            
            if (components.length === 0) {
                grid.innerHTML = `
                    <div class="no-components-message">
                        <h4>No Components Found</h4>
                        <p>No components match your current filters. Try adjusting your search criteria or <button onclick="clearSearchAndFilters()" class="link-button">clear all filters</button>.</p>
                        <p style="margin-top: 15px;"><button onclick="showAddComponentModal()" class="success">➕ Add New Component</button></p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = components.map(component => {
                const sectionType = component.section_type_name || component.section_type || 'general';
                const sectionDisplayName = sectionTypeNames[sectionType] || sectionType;
                
                return `
                    <div class="component-card" id="component-${component.id}">
                        <div class="component-title">${component.title || 'Untitled Component'}</div>
                        <div class="component-meta">
                            <span class="tag">${sectionDisplayName}</span>
                            ${component.skill_level ? `<span class="tag">${component.skill_level}</span>` : ''}
                            ${component.usage_count ? `<span class="tag">Used ${component.usage_count}x</span>` : ''}
                        </div>
                        <div class="component-preview">${(component.content || '').substring(0, 150)}${(component.content || '').length > 150 ? '...' : ''}</div>
                        ${component.keywords ? `<div class="keywords" style="font-size: 11px; color: #666; margin-top: 8px;"><strong>Keywords:</strong> ${component.keywords}</div>` : ''}
                        ${component.industry_tags ? `<div class="industry-tags" style="font-size: 11px; color: #666; margin-top: 5px;"><strong>Industries:</strong> ${component.industry_tags}</div>` : ''}
                        <div class="component-actions">
                            <button class="edit-btn" onclick="editComponentDetails('${component.id}')">✏️ Edit</button>
                            <button class="delete-btn" onclick="deleteComponent('${component.id}', '${(component.title || 'Untitled').replace(/'/g, "\\'")}')">🗑️ Delete</button>
                            <button class="secondary" onclick="selectComponent('${component.id}')">📋 Select</button>
                            <button class="success" onclick="addToCart('${component.id}')">🛒 Add to Cart</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateFilterDisplay(filteredCount, totalCount) {
            const countElement = document.getElementById('filter-results-count');
            const activeFilters = getActiveFilters();
            
            if (activeFilters.length > 0) {
                countElement.innerHTML = `
                    Showing ${filteredCount} of ${totalCount} components
                    <div class="filter-summary">
                        Active filters: ${activeFilters.map(filter => `<span class="filter-tag">${filter} <button class="clear-filter" onclick="clearSpecificFilter('${filter.split(':')[0]}')">&times;</button></span>`).join('')}
                    </div>
                `;
            } else {
                countElement.textContent = `Showing all ${totalCount} components`;
            }
        }

        function getActiveFilters() {
            const filters = [];
            const searchQuery = document.getElementById('component-search').value.trim();
            const sectionFilter = document.getElementById('section-filter').value;
            const skillLevelFilter = document.getElementById('skill-level-filter').value;
            const industryFilter = document.getElementById('industry-filter').value;
            const usageFilter = document.getElementById('usage-filter').value;
            
            if (searchQuery) filters.push(`search: ${searchQuery}`);
            if (sectionFilter) filters.push(`section: ${sectionFilter}`);
            if (skillLevelFilter) filters.push(`skill: ${skillLevelFilter}`);
            if (industryFilter) filters.push(`industry: ${industryFilter}`);
            if (usageFilter) filters.push(`usage: ${usageFilter}`);
            
            return filters;
        }

        function updateFilterActiveStates() {
            // Add visual indicators for active filters
            const filterElements = [
                'component-search',
                'section-filter',
                'skill-level-filter',
                'industry-filter',
                'usage-filter'
            ];
            
            filterElements.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    if ((element.type === 'text' && element.value.trim()) || 
                        (element.type === 'select-one' && element.value)) {
                        element.classList.add('filter-active');
                    } else {
                        element.classList.remove('filter-active');
                    }
                }
            });
        }

        function clearSearchAndFilters() {
            // Clear all filter inputs
            document.getElementById('component-search').value = '';
            document.getElementById('section-filter').value = '';
            document.getElementById('skill-level-filter').value = '';
            document.getElementById('industry-filter').value = '';
            document.getElementById('usage-filter').value = '';
            
            // Trigger filter update
            filterComponents();
            
            showStatus('All filters cleared', 'info');
        }

        function clearSpecificFilter(filterType) {
            switch (filterType) {
                case 'search':
                    document.getElementById('component-search').value = '';
                    break;
                case 'section':
                    document.getElementById('section-filter').value = '';
                    break;
                case 'skill':
                    document.getElementById('skill-level-filter').value = '';
                    break;
                case 'industry':
                    document.getElementById('industry-filter').value = '';
                    break;
                case 'usage':
                    document.getElementById('usage-filter').value = '';
                    break;
            }
            
            filterComponents();
        }

        function showBulkActions() {
            const panel = document.getElementById('bulk-actions-panel');
            panel.classList.toggle('show');
            
            if (panel.classList.contains('show')) {
                // Add checkboxes to all visible component cards
                document.querySelectorAll('.component-card').forEach(card => {
                    if (!card.querySelector('.bulk-checkbox')) {
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.className = 'bulk-checkbox';
                        checkbox.onchange = updateBulkSelectionCount;
                        card.style.position = 'relative';
                        card.appendChild(checkbox);
                    }
                });
                showStatus('Bulk actions enabled. Check components to perform batch operations.', 'info');
            } else {
                // Remove checkboxes
                document.querySelectorAll('.bulk-checkbox').forEach(checkbox => {
                    checkbox.remove();
                });
                showStatus('Bulk actions disabled.', 'info');
            }
        }

        function selectAllVisibleComponents() {
            document.querySelectorAll('.bulk-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            updateBulkSelectionCount();
        }

        function deselectAllComponents() {
            document.querySelectorAll('.bulk-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateBulkSelectionCount();
        }

        function updateBulkSelectionCount() {
            const selectedCount = document.querySelectorAll('.bulk-checkbox:checked').length;
            const totalVisible = document.querySelectorAll('.bulk-checkbox').length;
            
            const countElement = document.getElementById('bulk-selection-count');
            countElement.textContent = `${selectedCount} of ${totalVisible} components selected`;
            
            // Update component card styles
            document.querySelectorAll('.component-card').forEach(card => {
                const checkbox = card.querySelector('.bulk-checkbox');
                if (checkbox && checkbox.checked) {
                    card.classList.add('selected-for-bulk');
                } else {
                    card.classList.remove('selected-for-bulk');
                }
            });
        }

        async function bulkAddToCart() {
            const selectedCheckboxes = document.querySelectorAll('.bulk-checkbox:checked');
            let addedCount = 0;
            
            // Process each selected component
            for (const checkbox of selectedCheckboxes) {
                const card = checkbox.closest('.component-card');
                const componentId = card.id.replace('component-', '');
                
                // Try to get component from API first
                let component = null;
                try {
                    const response = await fetch(`/api/components/${componentId}`);
                    if (response.ok) {
                        component = await response.json();
                    }
                } catch (error) {
                    console.error('Error fetching component from API:', error);
                }
                
                // Fallback to local storage
                if (!component) {
                    component = db.components.find(comp => comp.id == componentId);
                }
                
                if (component) {
                    const existingItem = cart.find(item => item.id == componentId);
                    if (!existingItem) {
                        cart.push({...component});
                        addedCount++;
                    }
                }
            }
            
            if (addedCount > 0) {
                updateCartDisplay();
                showStatus(`Added ${addedCount} components to cart`, 'success');
            } else {
                showStatus('No new components were added (items may already be in cart)', 'info');
            }
        }

        function bulkDelete() {
            const selectedCheckboxes = document.querySelectorAll('.bulk-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showStatus('No components selected for deletion.', 'error');
                return;
            }
            
            const confirmed = confirm(`Are you sure you want to delete ${selectedCheckboxes.length} selected components?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            let deletedCount = 0;
            
            selectedCheckboxes.forEach(async (checkbox) => {
                const card = checkbox.closest('.component-card');
                const componentId = card.id.replace('component-', '');
                const component = db.components.find(comp => comp.id == componentId);
                
                if (component) {
                    try {
                        const response = await fetch(`/api/components/${componentId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response.ok) {
                            deletedCount++;
                        } else {
                            // Fallback: remove from local storage
                            db.components = db.components.filter(comp => comp.id != componentId);
                            db.saveComponents();
                            deletedCount++;
                        }
                    } catch (error) {
                        console.error('Error deleting component:', error);
                        // Fallback: remove from local storage
                        db.components = db.components.filter(comp => comp.id != componentId);
                        db.saveComponents();
                        deletedCount++;
                    }
                }
            });
            
            // Refresh the display after all deletions
            setTimeout(() => {
                loadComponentLibrary();
                loadDashboard();
                showStatus(`✅ Deleted ${deletedCount} components successfully!`, 'success');
            }, 500);
        }

        // Enhanced component library keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Only apply shortcuts when component library tab is active
            const componentLibraryTab = document.getElementById('component-library');
            if (!componentLibraryTab || !componentLibraryTab.classList.contains('active')) {
                return;
            }
            
            // Ctrl/Cmd + F: Focus search box
            if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
                event.preventDefault();
                document.getElementById('component-search').focus();
            }
            
            // Escape: Clear search and filters
            if (event.key === 'Escape') {
                clearSearchAndFilters();
            }
            
            // Ctrl/Cmd + A: Select all (when bulk actions are enabled)
            if ((event.ctrlKey || event.metaKey) && event.key === 'a') {
                const bulkPanel = document.getElementById('bulk-actions-panel');
                if (bulkPanel && bulkPanel.classList.contains('show')) {
                    event.preventDefault();
                    selectAllVisibleComponents();
                }
            }
        });

        // Add to cart function for the component library
        async function addToCart(componentId) {
            console.log('Adding to cart - componentId:', componentId);
            
            // First try to find component in the currently loaded components from API
            let component = null;
            
            try {
                // Try to fetch the specific component from API
                const response = await fetch(`/api/components/${componentId}`);
                if (response.ok) {
                    component = await response.json();
                    console.log('Component fetched from API:', component);
                }
            } catch (error) {
                console.error('Error fetching component from API:', error);
            }
            
            // Fallback to local storage if API fails
            if (!component) {
                component = db.components.find(comp => comp.id == componentId);
                console.log('Component found in local storage:', component);
            }
            
            if (component) {
                // Add to the resume builder cart
                const existingItem = cart.find(item => item.id == componentId);
                if (!existingItem) {
                    cart.push({...component});
                    console.log('Added to cart. New cart contents:', cart);
                    updateCartDisplay();
                    showStatus(`Added "${component.title}" to cart`, 'success');
                } else {
                    console.log('Component already in cart:', existingItem);
                    showStatus(`"${component.title}" is already in cart`, 'info');
                }
            } else {
                console.error('Component not found for ID:', componentId);
                showStatus('Component not found', 'error');
            }
        }

        async function saveComponent() {
            const component = {
                section_type: document.getElementById('modal-section-type').value,
                title: document.getElementById('modal-title').value.trim(),
                content: document.getElementById('modal-content').value.trim(),
                keywords: document.getElementById('modal-keywords').value.trim(),
                industry_tags: document.getElementById('modal-industry-tags').value.trim()
            };
            
            if (!component.title || !component.content) {
                showStatus('Please fill in title and content.', 'error');
                return;
            }
            
            try {
                let response;
                let result;
                
                // Check if we're editing an existing component
                if (window.editingComponentId) {
                    // Update existing component via API
                    response = await fetch(`/api/components/${window.editingComponentId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(component)
                    });
                    
                    if (response.ok) {
                        result = await response.json();
                        showStatus(`✅ Component "${component.title}" updated successfully!`, 'success');
                    } else {
                        // Fallback to local storage update
                        const existingIndex = db.components.findIndex(comp => comp.id == window.editingComponentId);
                        if (existingIndex !== -1) {
                            component.id = window.editingComponentId;
                            component.created_at = db.components[existingIndex].created_at;
                            component.updated_at = new Date().toISOString();
                            db.components[existingIndex] = component;
                            db.saveComponents();
                            showStatus(`✅ Component "${component.title}" updated successfully!`, 'success');
                        } else {
                            showStatus('Component not found for update.', 'error');
                            return;
                        }
                    }
                    
                    // Clear the editing flag
                    delete window.editingComponentId;
                } else {
                    // Create new component
                    response = await fetch('/add_component', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(component)
                    });
                    
                    result = await response.json();
                    
                    if (result.success) {
                        showStatus(`✅ Component "${component.title}" saved successfully!`, 'success');
                    } else {
                        showStatus(`❌ Error: ${result.error}`, 'error');
                        return;
                    }
                }
                
                closeModal('component-modal');
                
                // Clear form and reset to defaults
                document.getElementById('modal-title').value = '';
                document.getElementById('modal-content').value = '';
                document.getElementById('modal-keywords').value = '';
                document.getElementById('modal-industry-tags').value = '';
                document.getElementById('modal-section-type').value = 'professional_summary';
                document.getElementById('modal-skill-level').value = 'intermediate';
                
                // Force a fresh reload of components from server
                setTimeout(async () => {
                    await loadComponentLibrary();
                    loadDashboard();
                    showStatus('Component display refreshed with latest changes.', 'info');
                }, 100);
                
            } catch (error) {
                console.error('Error saving component:', error);
                showStatus('❌ Error saving component. Please try again.', 'error');
            }
        }

        async function saveEmployment() {
            const employment = {
                company_name: document.getElementById('emp-company').value,
                position_title: document.getElementById('emp-position').value,
                start_date: document.getElementById('emp-start-date').value,
                end_date: document.getElementById('emp-end-date').value,
                location: document.getElementById('emp-location').value,
                employment_type: document.getElementById('emp-type').value,
                responsibilities: document.getElementById('emp-responsibilities').value,
                achievements: document.getElementById('emp-achievements').value,
                technologies: document.getElementById('emp-technologies').value
            };
            
            if (!employment.company_name.trim() || !employment.position_title.trim()) {
                showStatus('Please fill in company name and position title.', 'error');
                return;
            }
            
            // Check if we're editing an existing entry
            if (window.editingEmploymentId) {
                // Update existing employment entry
                const existingIndex = db.employment.findIndex(emp => emp.id === window.editingEmploymentId);
                if (existingIndex !== -1) {
                    // Keep the original ID and created_at
                    employment.id = window.editingEmploymentId;
                    employment.created_at = db.employment[existingIndex].created_at;
                    employment.updated_at = new Date().toISOString();
                    db.employment[existingIndex] = employment;
                    showStatus('Employment history updated successfully!', 'success');
                } else {
                    showStatus('Employment entry not found for update.', 'error');
                    return;
                }
                
                // Clear the editing flag
                delete window.editingEmploymentId;
            } else {
                // Create new employment entry
                db.addEmployment(employment);
                showStatus('Employment history saved successfully!', 'success');
            }
            
            db.saveEmployment();
            closeModal('employment-modal');
            
            // Clear form
            Object.keys(employment).forEach(key => {
                if (key !== 'id' && key !== 'created_at' && key !== 'updated_at') {
                    const element = document.getElementById('emp-' + key.replace('_', '-'));
                    if (element) element.value = '';
                }
            });
            
            loadEmploymentHistory();
            loadDashboard();
        }

        function loadEmploymentHistory() {
            const list = document.getElementById('employment-list');
            list.innerHTML = db.employment.map(emp => `
                <div class="employment-entry">
                    <h4>${emp.position_title} at ${emp.company_name}</h4>
                    <p><strong>Duration:</strong> ${emp.start_date} - ${emp.end_date || 'Present'}</p>
                    <p><strong>Location:</strong> ${emp.location}</p>
                    <p><strong>Type:</strong> ${emp.employment_type}</p>
                    ${emp.responsibilities ? `<p><strong>Responsibilities:</strong> ${emp.responsibilities}</p>` : ''}
                    ${emp.achievements ? `<p><strong>Achievements:</strong> ${emp.achievements}</p>` : ''}
                    ${emp.technologies ? `<p><strong>Technologies:</strong> ${emp.technologies}</p>` : ''}
                    <div class="component-actions" style="margin-top: 1rem;">
                        <button class="edit-btn" onclick="editEmployment('${emp.id}')">✏️ Edit</button>
                        <button class="delete-btn" onclick="deleteEmployment('${emp.id}', '${emp.position_title} at ${emp.company_name}')">🗑️ Delete</button>
                    </div>
                </div>
            `).join('') || '<p>No employment history added yet.</p>';
        }

        // Delete employment function
        function deleteEmployment(employmentId, employmentTitle) {
            const confirmed = confirm(`Are you sure you want to delete "${employmentTitle}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            // Remove from local storage
            db.employment = db.employment.filter(emp => emp.id !== employmentId);
            db.saveEmployment();
            
            showStatus(`✅ Employment entry "${employmentTitle}" deleted successfully!`, 'success');
            loadEmploymentHistory();
            loadDashboard();
        }

        // Edit employment function
        function editEmployment(employmentId) {
            const employment = db.employment.find(emp => emp.id === employmentId);
            
            if (!employment) {
                showStatus('Employment entry not found.', 'error');
                return;
            }
            
            // Pre-fill the employment modal with existing data
            document.getElementById('emp-company').value = employment.company_name || '';
            document.getElementById('emp-position').value = employment.position_title || '';
            document.getElementById('emp-start-date').value = employment.start_date || '';
            document.getElementById('emp-end-date').value = employment.end_date || '';
            document.getElementById('emp-location').value = employment.location || '';
            document.getElementById('emp-type').value = employment.employment_type || 'full-time';
            document.getElementById('emp-responsibilities').value = employment.responsibilities || '';
            document.getElementById('emp-achievements').value = employment.achievements || '';
            document.getElementById('emp-technologies').value = employment.technologies || '';
            
            // Store the ID for updating instead of creating new
            window.editingEmploymentId = employmentId;
            
            // Show the modal
            document.getElementById('employment-modal').style.display = 'block';
            
            showStatus('Editing employment entry. Modify the details and save.', 'info');
        }

        // Export employment data function
        function exportEmploymentData() {
            if (db.employment.length === 0) {
                showStatus('No employment history to export.', 'warning');
                return;
            }
            
            const data = {
                employment_history: db.employment,
                exported_at: new Date().toISOString(),
                total_entries: db.employment.length
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `employment_history_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showStatus('Employment history exported successfully!', 'success');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal, [id$="-modal"]');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Resume Library Functions
        function switchResumeSubTab(subtabName) {
            // Remove active class from all sub-tabs and content
            document.querySelectorAll('.sub-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.sub-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected sub-tab and content
            document.querySelector(`[data-subtab="${subtabName}"]`).classList.add('active');
            document.getElementById(subtabName).classList.add('active');
            
            // Load content based on sub-tab
            if (subtabName === 'uploaded-resumes') {
                loadUploadedResumes();
            } else if (subtabName === 'templates') {
                loadTemplates();
            }
        }

        // Uploaded Resumes Functions
        async function loadUploadedResumes() {
            try {
                const includeArchived = document.getElementById('include-archived').checked;
                const response = await fetch(`/api/uploaded-resumes?include_archived=${includeArchived}`);
                const resumes = await response.json();
                
                displayUploadedResumes(resumes);
                updateResumeStats(resumes);
                
            } catch (error) {
                console.error('Error loading uploaded resumes:', error);
                showStatus('Error loading uploaded resumes', 'error');
            }
        }

        function displayUploadedResumes(resumes) {
            const grid = document.getElementById('uploaded-resumes-grid');
            
            if (!resumes || resumes.length === 0) {
                grid.innerHTML = '<p>No uploaded resumes found. Upload a resume using the Resume Importer to get started.</p>';
                return;
            }
            
            grid.innerHTML = resumes.map(resume => `
                <div class="resume-card">
                    <div class="component-title">${resume.resume_title || resume.original_filename}</div>
                    <div class="file-info">
                        📁 ${resume.original_filename} (${formatFileSize(resume.file_size)})
                        ${resume.file_type ? `• ${resume.file_type.toUpperCase()}` : ''}
                    </div>
                    <div class="component-preview" style="max-height: 100px; overflow: hidden;">
                        ${resume.full_text_content.substring(0, 200)}${resume.full_text_content.length > 200 ? '...' : ''}
                    </div>
                    ${resume.tags && resume.tags.length > 0 ? `
                        <div class="tags">
                            ${resume.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="resume-meta">
                        <span>📅 ${new Date(resume.created_at).toLocaleDateString()}</span>
                        <span>🧩 ${resume.components_extracted || 0} components</span>
                    </div>
                    <div class="component-actions">
                        <button class="edit-btn" onclick="viewResumeDetails('${resume.id}')">👁️ View</button>
                        <button class="edit-btn" onclick="editResumeDetails('${resume.id}')">✏️ Edit</button>
                        <button class="delete-btn" onclick="deleteUploadedResume('${resume.id}', '${resume.resume_title || resume.original_filename}')">🗑️ Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function searchUploadedResumes() {
            const query = document.getElementById('resume-search').value;
            const includeArchived = document.getElementById('include-archived').checked;
            
            try {
                const response = await fetch(`/api/uploaded-resumes?q=${encodeURIComponent(query)}&include_archived=${includeArchived}`);
                const resumes = await response.json();
                displayUploadedResumes(resumes);
                updateResumeStats(resumes);
            } catch (error) {
                console.error('Error searching resumes:', error);
                showStatus('Error searching resumes', 'error');
            }
        }

        async function deleteUploadedResume(resumeId, resumeTitle) {
            const confirmed = confirm(`Are you sure you want to delete "${resumeTitle}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showStatus(`✅ Resume "${resumeTitle}" deleted successfully!`, 'success');
                    loadUploadedResumes();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error deleting resume: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting resume:', error);
                showStatus('❌ Error deleting resume. Please try again.', 'error');
            }
        }

        function updateResumeStats(resumes) {
            document.getElementById('total-uploaded-resumes').textContent = resumes.length;
            const totalComponents = resumes.reduce((sum, resume) => sum + (resume.components_extracted || 0), 0);
            document.getElementById('total-extracted-components').textContent = totalComponents;
        }

        // Templates Functions
        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');
                const templates = await response.json();
                displayTemplates(templates);
            } catch (error) {
                console.error('Error loading templates:', error);
                showStatus('Error loading templates', 'error');
            }
        }

        function displayTemplates(templates) {
            const grid = document.getElementById('templates-grid');
            
            if (!templates || templates.length === 0) {
                grid.innerHTML = '<p>No templates found. Create your first template to get started.</p>';
                return;
            }
            
            grid.innerHTML = templates.map(template => `
                <div class="template-card">
                    <div class="component-title">${template.template_name} ${template.is_default ? '⭐' : ''}</div>
                    <div class="component-preview" style="max-height: 80px; overflow: hidden;">
                        ${template.description || 'No description provided'}
                    </div>
                    <div class="file-info">
                        ${template.target_role ? `🎯 ${template.target_role}` : ''} 
                        ${template.target_industry ? `• 🏢 ${template.target_industry}` : ''}
                    </div>
                    <div class="template-meta">
                        <span>📅 ${new Date(template.created_at).toLocaleDateString()}</span>
                        <span>📊 Used ${template.usage_count || 0} times</span>
                    </div>
                    <div class="component-actions">
                        <button class="edit-btn" onclick="viewTemplateDetails('${template.id}')">👁️ View</button>
                        <button class="edit-btn" onclick="editTemplateDetails('${template.id}')">✏️ Edit</button>
                        ${!template.is_default ? `<button class="delete-btn" onclick="deleteTemplate('${template.id}', '${template.template_name}')">🗑️ Delete</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function searchTemplates() {
            const query = document.getElementById('template-search').value;
            try {
                const response = await fetch(`/api/templates?q=${encodeURIComponent(query)}`);
                const templates = await response.json();
                displayTemplates(templates);
            } catch (error) {
                console.error('Error searching templates:', error);
                showStatus('Error searching templates', 'error');
            }
        }

        async function deleteTemplate(templateId, templateName) {
            const confirmed = confirm(`Are you sure you want to delete template "${templateName}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch(`/api/templates/${templateId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showStatus(`✅ Template "${templateName}" deleted successfully!`, 'success');
                    loadTemplates();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error deleting template: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting template:', error);
                showStatus('❌ Error deleting template. Please try again.', 'error');
            }
        }

        // Helper Functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Resume Library View and Edit Functions
        async function viewResumeDetails(resumeId) {
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch resume details');
                }
                const resume = await response.json();
                showResumeViewModal(resume);
            } catch (error) {
                console.error('Error loading resume details:', error);
                showStatus('Error loading resume details', 'error');
            }
        }

        function showResumeViewModal(resume) {
            const modal = document.createElement('div');
            modal.id = 'resume-view-modal';
            modal.innerHTML = `
                <div class="modal-overlay">
                    <div class="modal-content resume-view-modal">
                        <div class="modal-header">
                            <h3>📄 ${resume.resume_title || resume.original_filename}</h3>
                            <button class="close-btn" onclick="closeResumeModal()">&times;</button>
                        </div>
                        
                        <div class="modal-body">
                            <div class="resume-metadata">
                                <div class="metadata-row">
                                    <span><strong>Filename:</strong> ${resume.original_filename}</span>
                                    <span><strong>Size:</strong> ${formatFileSize(resume.file_size)}</span>
                                    <span><strong>Type:</strong> ${resume.file_type?.toUpperCase() || 'Unknown'}</span>
                                </div>
                                <div class="metadata-row">
                                    <span><strong>Uploaded:</strong> ${new Date(resume.created_at).toLocaleString()}</span>
                                    <span><strong>Components Extracted:</strong> ${resume.components_extracted || 0}</span>
                                </div>
                                ${resume.tags && resume.tags.length > 0 ? `
                                    <div class="metadata-row">
                                        <strong>Tags:</strong> ${resume.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="resume-actions">
                                <button onclick="editResumeDetails('${resume.id}')" class="success">✏️ Edit Resume</button>
                                <button onclick="createComponentsFromResume('${resume.id}')" class="primary">🧩 Extract Components</button>
                                <button onclick="copyEntireResume('${resume.id}')" class="secondary">📋 Copy Resume</button>
                                <button onclick="downloadResumeText('${resume.id}')" class="secondary">💾 Download Text</button>
                            </div>
                            
                            <div class="resume-content">
                                <h4>📝 Full Content</h4>
                                <div class="content-viewer">
                                    ${resume.full_text_content.replace(/\\n/g, '<br>').replace(/\\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'block';
        }

        async function editResumeDetails(resumeId) {
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch resume details');
                }
                const resume = await response.json();
                showResumeEditModal(resume);
            } catch (error) {
                console.error('Error loading resume for editing:', error);
                showStatus('Error loading resume for editing', 'error');
            }
        }

        function showResumeEditModal(resume) {
            const modal = document.createElement('div');
            modal.id = 'resume-edit-modal';
            modal.innerHTML = `
                <div class="modal-overlay">
                    <div class="modal-content resume-edit-modal">
                        <div class="modal-header">
                            <h3>✏️ Edit Resume: ${resume.original_filename}</h3>
                            <button class="close-btn" onclick="closeResumeModal()">&times;</button>
                        </div>
                        
                        <div class="modal-body">
                            <div class="form-section">
                                <label for="edit-resume-title">Resume Title:</label>
                                <input type="text" id="edit-resume-title" value="${resume.resume_title || ''}" placeholder="Professional resume title">
                                
                                <label for="edit-resume-tags">Tags (comma-separated):</label>
                                <input type="text" id="edit-resume-tags" value="${resume.tags ? resume.tags.join(', ') : ''}" placeholder="software, engineer, python">
                                
                                <label for="edit-resume-content">Full Content:</label>
                                <textarea id="edit-resume-content" rows="20" style="width: 100%; font-family: monospace;">${resume.full_text_content}</textarea>
                            </div>
                            
                            <div class="modal-actions">
                                <button onclick="saveResumeChanges('${resume.id}')" class="success">💾 Save Changes</button>
                                <button onclick="createComponentsFromResume('${resume.id}')" class="primary">🧩 Extract Components</button>
                                <button onclick="closeResumeModal()" class="secondary">❌ Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'block';
        }

        async function saveResumeChanges(resumeId) {
            try {
                const title = document.getElementById('edit-resume-title').value.trim();
                const tagsInput = document.getElementById('edit-resume-tags').value.trim();
                const content = document.getElementById('edit-resume-content').value;
                
                const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
                
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        resume_title: title,
                        tags: tags,
                        full_text_content: content
                    })
                });
                
                if (response.ok) {
                    showStatus('✅ Resume updated successfully!', 'success');
                    closeResumeModal();
                    loadUploadedResumes();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error updating resume: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error saving resume changes:', error);
                showStatus('❌ Error saving changes. Please try again.', 'error');
            }
        }

        async function createComponentsFromResume(resumeId) {
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch resume details');
                }
                const resume = await response.json();
                showComponentExtractionModal(resume);
            } catch (error) {
                console.error('Error loading resume for component extraction:', error);
                showStatus('Error loading resume for component extraction', 'error');
            }
        }

        function showComponentExtractionModal(resume) {
            const modal = document.createElement('div');
            modal.id = 'component-extraction-modal';
            modal.innerHTML = `
                <div class="modal-overlay">
                    <div class="modal-content component-extraction-modal">
                        <div class="modal-header">
                            <h3>🧩 Extract Components from: ${resume.resume_title || resume.original_filename}</h3>
                            <button class="close-btn" onclick="closeResumeModal()">&times;</button>
                        </div>
                        
                        <div class="modal-body">
                            <div class="extraction-options">
                                <h4>Extraction Method:</h4>
                                <label class="radio-option">
                                    <input type="radio" name="extraction-method" value="auto" checked>
                                    🤖 Automatic AI Extraction (Recommended)
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="extraction-method" value="manual">
                                    ✋ Manual Text Selection
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="extraction-method" value="bulk">
                                    📦 Create Single Component (Full Resume)
                                </label>
                            </div>
                            
                            <div id="manual-extraction" style="display: none;">
                                <h4>Select Text and Create Components:</h4>
                                <div class="text-selector">
                                    <textarea id="extraction-text" rows="15" style="width: 100%;">${resume.full_text_content}</textarea>
                                    <p><em>Select text above and click "Create Component" to extract specific sections.</em></p>
                                </div>
                                
                                <div class="component-form">
                                    <div class="form-row">
                                        <div>
                                            <label for="extract-section-type">Section Type:</label>
                                            <select id="extract-section-type">
                                                <option value="professional_summary">Professional Summary</option>
                                                <option value="technical_skills">Technical Skills</option>
                                                <option value="work_experience">Work Experience</option>
                                                <option value="education">Education</option>
                                                <option value="projects">Projects</option>
                                                <option value="certifications">Certifications</option>
                                                <option value="accomplishments">Accomplishments</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="extract-title">Component Title:</label>
                                            <input type="text" id="extract-title" placeholder="Component title">
                                        </div>
                                    </div>
                                    <button onclick="createComponentFromSelection('${resume.id}')" class="success">➕ Create Component</button>
                                </div>
                            </div>
                            
                            <div class="extraction-actions">
                                <button onclick="performAutoExtraction('${resume.id}')" class="primary">🚀 Start Extraction</button>
                                <button onclick="closeResumeModal()" class="secondary">❌ Cancel</button>
                            </div>
                            
                            <div id="extraction-results" style="display: none;">
                                <h4>Extraction Results:</h4>
                                <div id="extraction-progress"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'block';
            
            // Add event listener for extraction method change
            document.querySelectorAll('input[name="extraction-method"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const manualSection = document.getElementById('manual-extraction');
                    if (this.value === 'manual') {
                        manualSection.style.display = 'block';
                    } else {
                        manualSection.style.display = 'none';
                    }
                });
            });
        }

        async function performAutoExtraction(resumeId) {
            const method = document.querySelector('input[name="extraction-method"]:checked').value;
            const progressDiv = document.getElementById('extraction-progress');
            const resultsDiv = document.getElementById('extraction-results');
            
            resultsDiv.style.display = 'block';
            progressDiv.innerHTML = '<p>🔄 Starting extraction...</p>';
            
            try {
                let response;
                if (method === 'auto') {
                    response = await fetch(`/api/uploaded-resumes/${resumeId}/extract-components`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ method: 'auto' })
                    });
                } else if (method === 'bulk') {
                    const resume = await fetch(`/api/uploaded-resumes/${resumeId}`).then(r => r.json());
                    response = await fetch('/add_component', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            section_type: 'full_resume',
                            title: `Full Resume: ${resume.resume_title || resume.original_filename}`,
                            content: resume.full_text_content,
                            keywords: resume.tags ? resume.tags.join(', ') : '',
                            industry_tags: '',
                            skill_level: 'intermediate'
                        })
                    });
                }
                
                if (response.ok) {
                    const result = await response.json();
                    progressDiv.innerHTML = `
                        <div class="success-message">
                            ✅ Extraction completed successfully!
                            <br>Created ${result.components_created || 1} new component(s).
                        </div>
                    `;
                    
                    // Refresh component library
                    setTimeout(() => {
                        closeResumeModal();
                        loadUploadedResumes();
                        if (typeof filterComponents === 'function') {
                            filterComponents();
                        }
                    }, 2000);
                } else {
                    const error = await response.json();
                    progressDiv.innerHTML = `<div class="error-message">❌ Extraction failed: ${error.error}</div>`;
                }
            } catch (error) {
                console.error('Error during extraction:', error);
                progressDiv.innerHTML = '<div class="error-message">❌ Extraction failed. Please try again.</div>';
            }
        }

        async function createComponentFromSelection(resumeId) {
            const textarea = document.getElementById('extraction-text');
            const selectedText = textarea.value.substring(textarea.selectionStart, textarea.selectionEnd).trim();
            
            if (!selectedText) {
                showStatus('❌ Please select text in the textarea first', 'error');
                return;
            }
            
            const sectionType = document.getElementById('extract-section-type').value;
            const title = document.getElementById('extract-title').value.trim();
            
            if (!title) {
                showStatus('❌ Please provide a component title', 'error');
                return;
            }
            
            try {
                const response = await fetch('/add_component', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        section_type: sectionType,
                        title: title,
                        content: selectedText,
                        keywords: `extracted-from-resume-${resumeId}`,
                        industry_tags: '',
                        skill_level: 'intermediate'
                    })
                });
                
                if (response.ok) {
                    showStatus(`✅ Component "${title}" created successfully!`, 'success');
                    document.getElementById('extract-title').value = '';
                    
                    // Refresh component library
                    if (typeof filterComponents === 'function') {
                        filterComponents();
                    }
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error creating component: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error creating component from selection:', error);
                showStatus('❌ Error creating component. Please try again.', 'error');
            }
        }

        async function copyEntireResume(resumeId) {
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch resume');
                }
                const resume = await response.json();
                
                // Copy to clipboard
                await navigator.clipboard.writeText(resume.full_text_content);
                showStatus('📋 Resume copied to clipboard!', 'success');
                
                // Also offer to save as new file
                const shouldSave = confirm('Resume copied to clipboard! Would you also like to save a copy as a new file?');
                if (shouldSave) {
                    downloadResumeText(resumeId);
                }
            } catch (error) {
                console.error('Error copying resume:', error);
                showStatus('❌ Error copying resume. Please try again.', 'error');
            }
        }

        async function downloadResumeText(resumeId) {
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch resume');
                }
                const resume = await response.json();
                
                const blob = new Blob([resume.full_text_content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${resume.resume_title || resume.original_filename}_copy.txt`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showStatus('💾 Resume downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error downloading resume:', error);
                showStatus('❌ Error downloading resume. Please try again.', 'error');
            }
        }

        function closeResumeModal() {
            const modals = ['resume-view-modal', 'resume-edit-modal', 'component-extraction-modal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.remove();
                }
            });
        }

        // Resume Builder Shopping Cart Functions
        let cart = [];
        let builderComponents = [];

        // Load components for the resume builder
        async function loadBuilderComponents() {
            try {
                const response = await fetch('/api/components');
                if (response.ok) {
                    builderComponents = await response.json();
                } else {
                    // Fallback to local storage
                    builderComponents = db.components;
                }
                displayBuilderComponents();
            } catch (error) {
                console.error('Error loading builder components:', error);
                builderComponents = db.components;
                displayBuilderComponents();
            }
        }

        // Display components in the sidebar
        function displayBuilderComponents(components = builderComponents) {
            const list = document.getElementById('builder-component-list');
            
            if (!components || components.length === 0) {
                list.innerHTML = '<p class="cart-empty">No components available. Add some components first.</p>';
                return;
            }

            list.innerHTML = components.map(component => {
                const isInCart = cart.some(item => item.id === component.id);
                return `
                    <div class="builder-component-item">
                        <div class="builder-component-title">${component.title}</div>
                        <div class="builder-component-preview">${component.content.substring(0, 80)}${component.content.length > 80 ? '...' : ''}</div>
                        <div class="builder-component-meta">
                            <span>${component.section_type_name || component.section_type || 'General'}</span>
                            <span>Used: ${component.usage_count || 0}x</span>
                        </div>
                        <button class="add-to-cart-btn" onclick="addComponentToBuilderCart('${component.id}')" ${isInCart ? 'disabled' : ''}>
                            ${isInCart ? '✓ In Cart' : '🛒 Add to Cart'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Filter components in builder
        function filterBuilderComponents() {
            const searchTerm = document.getElementById('component-builder-search').value.toLowerCase();
            const typeFilter = document.getElementById('component-type-filter').value;
            
            let filtered = builderComponents.filter(component => {
                const matchesSearch = component.title.toLowerCase().includes(searchTerm) || 
                                    component.content.toLowerCase().includes(searchTerm) ||
                                    (component.keywords && component.keywords.toLowerCase().includes(searchTerm));
                                    
                const matchesType = !typeFilter || component.section_type === typeFilter;
                
                return matchesSearch && matchesType;
            });
            
            displayBuilderComponents(filtered);
        }

        // Add component to cart (Resume Builder specific)
        function addComponentToBuilderCart(componentId) {
            const component = builderComponents.find(comp => comp.id == componentId);
            if (!component) {
                showStatus('Component not found', 'error');
                return;
            }
            
            // Check if already in cart
            if (cart.some(item => item.id === component.id)) {
                showStatus('Component already in cart', 'warning');
                return;
            }
            
            cart.push({
                id: component.id,
                title: component.title,
                content: component.content,
                section_type: component.section_type,
                section_type_name: component.section_type_name || component.section_type,
                keywords: component.keywords
            });
            
            updateCartDisplay();
            displayBuilderComponents(); // Refresh to update button states
            showStatus(`Added "${component.title}" to cart`, 'success');
        }

        // Remove component from cart
        function removeFromCart(componentId) {
            cart = cart.filter(item => item.id !== componentId);
            updateCartDisplay();
            displayBuilderComponents(); // Refresh to update button states
            showStatus('Component removed from cart', 'info');
        }

        // Update cart display
        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            
            cartCount.textContent = `${cart.length} item${cart.length !== 1 ? 's' : ''}`;
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="cart-empty">Add components to your cart to build your resume</p>';
                return;
            }
            
            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <button class="remove-from-cart" onclick="removeFromCart('${item.id}')">×</button>
                    <div class="cart-item-title">${item.title}</div>
                    <div class="cart-item-preview">${item.content.substring(0, 60)}${item.content.length > 60 ? '...' : ''}</div>
                    <span class="cart-item-type">${item.section_type_name || item.section_type}</span>
                </div>
            `).join('');
        }

        // Clear entire cart
        function clearCart() {
            if (cart.length === 0) {
                showStatus('Cart is already empty', 'info');
                return;
            }
            
            const confirmed = confirm(`Are you sure you want to clear all ${cart.length} items from your cart?`);
            if (confirmed) {
                cart = [];
                updateCartDisplay();
                displayBuilderComponents();
                showStatus('Cart cleared', 'info');
            }
        }

        // Checkout cart - build resume
        function checkoutCart() {
            if (cart.length === 0) {
                showStatus('Cart is empty. Add some components first.', 'warning');
                return;
            }
            
            generateResumePreview();
            showStatus(`Checked out ${cart.length} components. Resume updated!`, 'success');
        }

        // Generate resume preview from cart contents
        function generateResumePreview() {
            const resumeContent = document.getElementById('resume-content');
            const resumeTitleElement = document.getElementById('resume-title');
            const resumeTitle = resumeTitleElement ? resumeTitleElement.value : 'Professional Resume';
            
            // Update resume header with current personal information
            updateResumeHeader();
            
            if (cart.length === 0) {
                resumeContent.innerHTML = '<p class="empty-canvas">Select components from the library and add them to your cart, then checkout to build your resume.</p>';
                return;
            }
            
            console.log('Generating resume preview with cart:', cart);
            
            // Group components by section type
            const sections = {};
            cart.forEach(component => {
                const sectionType = component.section_type_name || component.section_type || 'general';
                if (!sections[sectionType]) {
                    sections[sectionType] = [];
                }
                sections[sectionType].push(component);
            });
            
            console.log('Grouped sections:', sections);
            
            // Define section order and names (updated to match actual database section types)
            const sectionOrder = {
                'professional_summary': 'Professional Summary',
                'technical_skills': 'Technical Skills',
                'work_experience': 'Work Experience',
                'client_contract': 'Client Contracts & Consulting', 
                'projects': 'Projects',
                'education': 'Education',
                'certifications': 'Certifications',
                'achievements': 'Achievements',
                'general': 'Additional Information'
            };
            
            let resumeHTML = '';
            
            // Generate sections in defined order first
            Object.keys(sectionOrder).forEach(sectionType => {
                if (sections[sectionType]) {
                    const sectionName = sectionOrder[sectionType];
                    resumeHTML += `
                        <div class="resume-section">
                            <h3>${sectionName}</h3>
                            ${sections[sectionType].map(component => `
                                <div class="resume-item">
                                    <h4>${component.title}</h4>
                                    <p>${component.content}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    // Mark this section as processed
                    delete sections[sectionType];
                }
            });
            
            // Handle any remaining sections not in the predefined order
            Object.keys(sections).forEach(sectionType => {
                const sectionName = sectionType.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                resumeHTML += `
                    <div class="resume-section">
                        <h3>${sectionName}</h3>
                        ${sections[sectionType].map(component => `
                            <div class="resume-item">
                                <h4>${component.title}</h4>
                                <p>${component.content}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            resumeContent.innerHTML = resumeHTML;
            console.log('Resume HTML generated:', resumeHTML);
            
            // Update resume title in header if provided and element exists
            if (resumeTitle && resumeTitle !== 'Professional Resume') {
                const resumeNameElement = document.getElementById('resume-name');
                if (resumeNameElement) {
                    resumeNameElement.textContent = resumeTitle;
                }
            }
        }

        // Update resume header with current personal information
        function updateResumeHeader() {
            const personalInfo = getCurrentPersonalInfo();
            
            // Update name
            const nameElement = document.getElementById('resume-name');
            if (nameElement && personalInfo.fullName) {
                nameElement.textContent = personalInfo.fullName;
            }
            
            // Update contact information
            const emailElement = document.getElementById('resume-email');
            const phoneElement = document.getElementById('resume-phone');
            const linkedinElement = document.getElementById('resume-linkedin');
            const locationElement = document.getElementById('resume-location');
            
            // Show/hide and update email
            if (emailElement) {
                if (personalInfo.email) {
                    emailElement.textContent = personalInfo.email;
                    emailElement.style.display = 'block';
                } else {
                    emailElement.style.display = 'none';
                }
            }
            
            // Show/hide and update phone
            if (phoneElement) {
                if (personalInfo.phone) {
                    phoneElement.textContent = personalInfo.phone;
                    phoneElement.style.display = 'block';
                } else {
                    phoneElement.style.display = 'none';
                }
            }
            
            // Show/hide and update LinkedIn
            if (linkedinElement) {
                if (personalInfo.linkedin) {
                    linkedinElement.textContent = personalInfo.linkedin;
                    linkedinElement.style.display = 'block';
                } else {
                    linkedinElement.style.display = 'none';
                }
            }
            
            // Show/hide and update location
            if (locationElement) {
                if (personalInfo.location && personalInfo.location !== ',') {
                    locationElement.textContent = personalInfo.location;
                    locationElement.style.display = 'block';
                } else {
                    locationElement.style.display = 'none';
                }
            }
        }

        // Export resume as text/HTML
        function exportResume() {
            const resumePreview = document.getElementById('resume-preview');
            const resumeTitleElement = document.getElementById('resume-title');
            const resumeTitle = resumeTitleElement ? resumeTitleElement.value || 'Resume' : 'Resume';
            
            // Get personal information from settings
            const personalInfo = getCurrentPersonalInfo();
            const fileName = personalInfo.fullName || resumeTitle;
            
            if (cart.length === 0) {
                showStatus('No components to export. Build your resume first.', 'warning');
                return;
            }
            
            // Create HTML content
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${fileName}</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.4; }
                        .resume-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #2f5597; padding-bottom: 10px; }
                        .resume-header h1 { margin: 0; color: #2f5597; font-size: 24px; }
                        .resume-header p { margin: 5px 0 0 0; color: #666; font-size: 14px; }
                        .resume-section { margin-bottom: 20px; }
                        .resume-section h3 { color: #2f5597; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; font-size: 16px; }
                        .resume-item { margin-bottom: 15px; padding: 10px; background-color: #fafafa; border-left: 3px solid #2f5597; }
                        .resume-item h4 { margin: 0 0 5px 0; color: #333; font-size: 14px; }
                        .resume-item p { margin: 0; font-size: 12px; line-height: 1.4; }
                    </style>
                </head>
                <body>
                    ${resumePreview.innerHTML}
                </body>
                </html>
            `;
            
            // Create and download file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('Resume exported successfully!', 'success');
        }

        // Export resume as DOCX
        async function exportResumeDocx() {
            const resumeTitleElement = document.getElementById('resume-title');
            const resumeTitle = resumeTitleElement ? resumeTitleElement.value || 'Resume' : 'Resume';
            
            // Get personal information from settings
            const personalInfo = getCurrentPersonalInfo();
            const contactInfo = personalInfo.contactInfo || '';
            
            if (cart.length === 0) {
                showStatus('No components to export. Build your resume first.', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/export/docx', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        components: cart,
                        title: personalInfo.fullName || resumeTitle,
                        contact: contactInfo
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Export failed');
                }
                
                // Download the file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${(personalInfo.fullName || resumeTitle).replace(/[^a-z0-9]/gi, '_').toLowerCase()}.docx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showStatus('DOCX resume exported successfully!', 'success');
                
            } catch (error) {
                console.error('Error exporting DOCX:', error);
                showStatus(`Error exporting DOCX: ${error.message}`, 'error');
            }
        }

        // Export resume as PDF
        async function exportResumePdf() {
            const resumeTitleElement = document.getElementById('resume-title');
            const resumeTitle = resumeTitleElement ? resumeTitleElement.value || 'Resume' : 'Resume';
            
            // Get personal information from settings
            const personalInfo = getCurrentPersonalInfo();
            const contactInfo = personalInfo.contactInfo || '';
            
            if (cart.length === 0) {
                showStatus('No components to export. Build your resume first.', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/export/pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        components: cart,
                        title: personalInfo.fullName || resumeTitle,
                        contact: contactInfo
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Export failed');
                }
                
                // Download the file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${(personalInfo.fullName || resumeTitle).replace(/[^a-z0-9]/gi, '_').toLowerCase()}.pdf`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showStatus('PDF resume exported successfully!', 'success');
                
            } catch (error) {
                console.error('Error exporting PDF:', error);
                showStatus(`Error exporting PDF: ${error.message}`, 'error');
            }
        }

        // Save resume as template
        function saveResumeTemplate() {
            const resumeTitle = document.getElementById('resume-title').value;
            
            if (cart.length === 0) {
                showStatus('No components to save as template. Build your resume first.', 'warning');
                return;
            }
            
            if (!resumeTitle) {
                showStatus('Please enter a resume title before saving as template.', 'warning');
                return;
            }
            
            const template = {
                template_name: resumeTitle,
                description: `Template with ${cart.length} components`,
                components: cart.map(c => c.id),
                created_at: new Date().toISOString(),
                usage_count: 0
            };
            
            // Store in local storage for now (could be enhanced to save to database)
            const templates = JSON.parse(localStorage.getItem('resume_templates') || '[]');
            templates.push({
                ...template,
                id: Date.now().toString()
            });
            localStorage.setItem('resume_templates', JSON.stringify(templates));
            
            showStatus(`Template "${resumeTitle}" saved successfully!`, 'success');
        }

        // Initialize resume builder when tab is activated
        function initializeResumeBuilder() {
            loadBuilderComponents();
            updateCartDisplay();
        }

        // Load builder components when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize resume builder if the tab is already active
            const resumeBuilderTab = document.getElementById('resume-builder');
            if (resumeBuilderTab && resumeBuilderTab.classList.contains('active')) {
                initializeResumeBuilder();
            }
        });

        // Override the switchTab function to initialize builder when activated
        const originalSwitchTab = window.switchTab;
        window.switchTab = function(tabName) {
            if (originalSwitchTab) {
                originalSwitchTab(tabName);
            } else {
                // Basic tab switching if original function doesn't exist
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                
                document.getElementById(tabName).classList.add('active');
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            }
            
            if (tabName === 'resume-builder') {
                initializeResumeBuilder();
            }
        };

        // ==================== WORK ORDERS FUNCTIONALITY ====================
        
        let workOrders = [];
        let filteredWorkOrders = [];
        let currentWorkOrder = null;
        
        // Pagination state for work orders
        let workOrdersPagination = {
            offset: 0,
            limit: 50,
            totalCount: 0,
            hasMore: false,
            loading: false
        };

        // Load work orders from JSONL file
        async function loadWorkOrdersFromJsonl() {
            try {
                showStatus('Loading work orders from JSONL file...', 'info');
                const response = await fetch('/api/work-orders/load-jsonl', {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (response.ok) {
                    showStatus(result.message, 'success');
                    // Reset pagination when loading new data
                    workOrdersPagination.offset = 0;
                    await refreshWorkOrders(true);
                } else {
                    showStatus(result.error || 'Error loading JSONL data', 'error');
                }
            } catch (error) {
                console.error('Error loading JSONL data:', error);
                showStatus('Error loading JSONL data', 'error');
            }
        }

        // Refresh work orders data
        async function refreshWorkOrders(reset = true) {
            try {
                if (reset) {
                    workOrdersPagination.offset = 0;
                    workOrders = [];
                }
                
                workOrdersPagination.loading = true;
                updateLoadMoreButton();
                
                const url = `/api/work-orders?limit=${workOrdersPagination.limit}&offset=${workOrdersPagination.offset}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Handle new API response format
                if (data.work_orders) {
                    if (reset) {
                        workOrders = data.work_orders;
                    } else {
                        workOrders = [...workOrders, ...data.work_orders];
                    }
                    workOrdersPagination.totalCount = data.total_count;
                    workOrdersPagination.hasMore = data.has_more;
                    if (!reset) {
                        workOrdersPagination.offset += workOrdersPagination.limit;
                    }
                } else {
                    // Fallback for old API format
                    workOrders = data;
                    workOrdersPagination.hasMore = false;
                }
                
                filteredWorkOrders = [...workOrders];
                workOrdersPagination.loading = false;
                
                await loadWorkOrderFilters();
                await loadWorkOrderStats();
                displayWorkOrderTiles(reset);
                updateLoadMoreButton();
                
                showStatus(`Loaded ${workOrders.length} work orders (${workOrdersPagination.totalCount} total)`, 'success');
            } catch (error) {
                console.error('Error loading work orders:', error);
                workOrdersPagination.loading = false;
                updateLoadMoreButton();
                showStatus('Error loading work orders', 'error');
            }
        }

        // Load filter options for work orders
        async function loadWorkOrderFilters() {
            try {
                const response = await fetch('/api/work-orders/categories');
                const categories = await response.json();
                
                // Populate category filter
                const categoryFilter = document.getElementById('category-filter');
                categoryFilter.innerHTML = '<option value="">All Categories</option>';
                categories.categories.forEach(category => {
                    if (category) {
                        categoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
                    }
                });
                
                // Populate company filter
                const companyFilter = document.getElementById('company-filter');
                companyFilter.innerHTML = '<option value="">All Companies</option>';
                const uniqueCompanies = [...new Set(workOrders.map(wo => wo.company_name))].sort();
                uniqueCompanies.forEach(company => {
                    if (company) {
                        companyFilter.innerHTML += `<option value="${company}">${company}</option>`;
                    }
                });
                
                // Populate state filter
                const stateFilter = document.getElementById('state-filter');
                stateFilter.innerHTML = '<option value="">All States</option>';
                categories.states.forEach(state => {
                    if (state) {
                        stateFilter.innerHTML += `<option value="${state}">${state}</option>`;
                    }
                });
                
            } catch (error) {
                console.error('Error loading work order filters:', error);
            }
        }

        // Load work order statistics
        async function loadWorkOrderStats() {
            try {
                const response = await fetch('/api/work-orders/stats');
                const stats = await response.json();
                
                document.getElementById('total-work-orders').textContent = stats.total_orders || 0;
                document.getElementById('unique-companies').textContent = stats.unique_companies || 0;
                document.getElementById('total-earnings').textContent = `$${stats.total_earnings || 0}`;
                document.getElementById('unassigned-work-orders').textContent = stats.unassigned_orders || 0;
                
            } catch (error) {
                console.error('Error loading work order stats:', error);
            }
        }

        // Display work orders as tiles
        function displayWorkOrderTiles(reset = true) {
            const grid = document.getElementById('work-orders-grid');
            
            if (filteredWorkOrders.length === 0) {
                grid.innerHTML = '<div class="no-components-message">No work orders found. Click "Load JSONL Data" to import work orders.</div>';
                return;
            }
            
            const workOrdersHtml = filteredWorkOrders.map(workOrder => {
                const isInCart = cart.some(item => item.id === `wo_${workOrder.work_order_number || workOrder.id}`);
                const cartButtonText = isInCart ? 'In Cart' : 'Add to Cart';
                const cartButtonClass = isInCart ? 'btn-cart in-cart' : 'btn-cart';
                
                // Parse tools, software, and skills from JSONL data
                const tools = Array.isArray(workOrder.tools) ? workOrder.tools : [];
                const software = Array.isArray(workOrder.software) ? workOrder.software : [];
                const skills = Array.isArray(workOrder.skills) ? workOrder.skills : [];
                
                return `
                    <div class="work-order-tile" id="work-order-tile-${workOrder.work_order_number || workOrder.id}">
                        <div class="work-order-tile-header">
                            <div class="work-order-number">#${workOrder.work_order_number || workOrder.id}</div>
                            <input type="checkbox" class="work-order-select" value="${workOrder.work_order_number || workOrder.id}" onchange="updateWorkOrderSelection()">
                        </div>
                        
                        <div class="work-order-tile-title">${workOrder.title || 'Work Order'}</div>
                        
                        <div class="work-order-tile-description">
                            ${workOrder.service_description || workOrder.description || 'No description available'}
                        </div>
                        
                        <div class="work-order-tile-tags">
                            ${tools.slice(0, 3).map(tool => `<span class="work-order-tile-tag tools">${tool}</span>`).join('')}
                            ${software.slice(0, 3).map(sw => `<span class="work-order-tile-tag software">${sw}</span>`).join('')}
                            ${skills.slice(0, 2).map(skill => `<span class="work-order-tile-tag skills">${skill}</span>`).join('')}
                        </div>
                        
                        <div class="work-order-tile-actions">
                            <button onclick="openWorkOrderModal('${workOrder.work_order_number || workOrder.id}')" class="btn-view">👁️ View Details</button>
                            <button onclick="toggleWorkOrderInCart('${workOrder.work_order_number || workOrder.id}')" class="${cartButtonClass}">${cartButtonText}</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (reset) {
                grid.innerHTML = workOrdersHtml;
            } else {
                grid.innerHTML += workOrdersHtml;
            }
        }

        // Load more work orders
        async function loadMoreWorkOrders() {
            if (workOrdersPagination.loading || !workOrdersPagination.hasMore) {
                return;
            }
            
            await refreshWorkOrders(false); // Don't reset, append to existing
        }

        // Update load more button state
        function updateLoadMoreButton() {
            const button = document.getElementById('load-more-work-orders');
            if (!button) return;
            
            if (workOrdersPagination.loading) {
                button.textContent = '⏳ Loading...';
                button.disabled = true;
                button.style.display = 'inline-block';
            } else if (workOrdersPagination.hasMore) {
                button.textContent = `📄 Load More Work Orders (${workOrdersPagination.totalCount - workOrders.length} remaining)`;
                button.disabled = false;
                button.style.display = 'inline-block';
            } else {
                button.style.display = 'none';
            }
        }

        // Open work order modal
        function openWorkOrderModal(workOrderId) {
            const workOrder = workOrders.find(wo => wo.work_order_number === workOrderId || wo.id === workOrderId);
            if (!workOrder) {
                showStatus('Work order not found', 'error');
                return;
            }
            
            currentWorkOrder = workOrder;
            
            // Update modal title
            document.getElementById('work-order-modal-title').textContent = `Work Order #${workOrder.work_order_number || workOrder.id}`;
            
            // Parse tools, software, and skills
            const tools = Array.isArray(workOrder.tools) ? workOrder.tools : [];
            const software = Array.isArray(workOrder.software) ? workOrder.software : [];
            const skills = Array.isArray(workOrder.skills) ? workOrder.skills : [];
            
            // Build modal content
            const modalContent = `
                <div class="work-order-detail-section">
                    <h4>📋 Work Order Information</h4>
                    <div class="work-order-detail-grid">
                        <div class="work-order-detail-item">
                            <div class="work-order-detail-label">Work Order Number</div>
                            <div class="work-order-detail-value">#${workOrder.work_order_number || workOrder.id}</div>
                        </div>
                        <div class="work-order-detail-item">
                            <div class="work-order-detail-label">Title</div>
                            <div class="work-order-detail-value">${workOrder.title || 'N/A'}</div>
                        </div>
                        <div class="work-order-detail-item">
                            <div class="work-order-detail-label">Source File</div>
                            <div class="work-order-detail-value">${workOrder.source_file || 'N/A'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="work-order-detail-section">
                    <h4>📝 Service Description</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; line-height: 1.5;">
                        ${workOrder.service_description || workOrder.description || 'No description available'}
                    </div>
                </div>
                
                ${tools.length > 0 ? `
                <div class="work-order-detail-section">
                    <h4>🔧 Tools Required</h4>
                    <div class="work-order-tile-tags">
                        ${tools.map(tool => `<span class="work-order-tile-tag tools">${tool}</span>`).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${software.length > 0 ? `
                <div class="work-order-detail-section">
                    <h4>💻 Software Used</h4>
                    <div class="work-order-tile-tags">
                        ${software.map(sw => `<span class="work-order-tile-tag software">${sw}</span>`).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${skills.length > 0 ? `
                <div class="work-order-detail-section">
                    <h4>🎯 Skills Demonstrated</h4>
                    <div class="work-order-tile-tags">
                        ${skills.map(skill => `<span class="work-order-tile-tag skills">${skill}</span>`).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="work-order-detail-section">
                    <h4>📊 Raw JSONL Data</h4>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; max-height: 200px; overflow-y: auto;">${JSON.stringify(workOrder, null, 2)}</pre>
                </div>
            `;
            
            document.getElementById('work-order-modal-body').innerHTML = modalContent;
            
            // Update cart button in modal
            const isInCart = cart.some(item => item.id === `wo_${workOrder.work_order_number || workOrder.id}`);
            const modalCartBtn = document.getElementById('modal-cart-btn');
            modalCartBtn.textContent = isInCart ? 'Remove from Cart' : 'Add to Cart';
            modalCartBtn.className = isInCart ? 'btn-cart in-cart' : 'btn-cart';
            
            // Show modal
            document.getElementById('work-order-modal').style.display = 'block';
        }

        // Close work order modal
        function closeWorkOrderModal() {
            document.getElementById('work-order-modal').style.display = 'none';
            currentWorkOrder = null;
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('work-order-modal');
            if (event.target === modal) {
                closeWorkOrderModal();
            }
        }

        // Toggle work order in cart from modal
        function toggleWorkOrderInCart(workOrderId = null) {
            const workOrder = workOrderId ? 
                workOrders.find(wo => wo.work_order_number === workOrderId || wo.id === workOrderId) : 
                currentWorkOrder;
                
            if (!workOrder) {
                showStatus('Work order not found', 'error');
                return;
            }
            
            const cartItemId = `wo_${workOrder.work_order_number || workOrder.id}`;
            const existingIndex = cart.findIndex(item => item.id === cartItemId);
            
            if (existingIndex >= 0) {
                // Remove from cart
                cart.splice(existingIndex, 1);
                showStatus(`Removed "${workOrder.title}" from cart`, 'success');
            } else {
                // Add to cart
                const cartItem = {
                    id: cartItemId,
                    title: workOrder.title || `Work Order #${workOrder.work_order_number || workOrder.id}`,
                    content: workOrder.service_description || workOrder.description || 'Work order completion',
                    section_type: 'work_experience',
                    section_type_name: 'Work Experience',
                    type: 'work_order',
                    original_data: workOrder
                };
                
                cart.push(cartItem);
                showStatus(`Added "${workOrder.title}" to cart`, 'success');
            }
            
            updateCartDisplay();
            displayWorkOrderTiles(); // Refresh tiles to update button states
            
            // Update modal button if modal is open
            if (currentWorkOrder) {
                const isInCart = cart.some(item => item.id === cartItemId);
                const modalCartBtn = document.getElementById('modal-cart-btn');
                modalCartBtn.textContent = isInCart ? 'Remove from Cart' : 'Add to Cart';
                modalCartBtn.className = isInCart ? 'btn-cart in-cart' : 'btn-cart';
            }
        }

        // Filter work orders
        function filterWorkOrders() {
            const searchTerm = document.getElementById('work-order-search').value.toLowerCase().trim();
            const companyFilter = document.getElementById('company-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;
            
            filteredWorkOrders = workOrders.filter(workOrder => {
                const matchesSearch = !searchTerm || 
                    (workOrder.title && workOrder.title.toLowerCase().includes(searchTerm)) ||
                    (workOrder.service_description && workOrder.service_description.toLowerCase().includes(searchTerm)) ||
                    (workOrder.work_order_number && workOrder.work_order_number.toString().includes(searchTerm));
                
                const matchesCompany = !companyFilter || 
                    (workOrder.company_name && workOrder.company_name === companyFilter);
                
                const matchesCategory = !categoryFilter || 
                    (workOrder.work_category && workOrder.work_category === categoryFilter);
                
                return matchesSearch && matchesCompany && matchesCategory;
            });
            
            displayWorkOrderTiles();
            updateLoadMoreButton(); // Update button state after filtering
        }

        // Search work orders
        function searchWorkOrders() {
            const searchTerm = document.getElementById('work-order-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredWorkOrders = [...workOrders];
            } else {
                filteredWorkOrders = workOrders.filter(workOrder => 
                    workOrder.title.toLowerCase().includes(searchTerm) ||
                    workOrder.company_name.toLowerCase().includes(searchTerm) ||
                    (workOrder.work_description && workOrder.work_description.toLowerCase().includes(searchTerm)) ||
                    (workOrder.technologies_used && workOrder.technologies_used.toLowerCase().includes(searchTerm))
                );
            }
            
            displayWorkOrders();
        }

        // Filter work orders
        function filterWorkOrders() {
            const categoryFilter = document.getElementById('category-filter').value;
            const companyFilter = document.getElementById('company-filter').value;
            const stateFilter = document.getElementById('state-filter').value;
            const dateRangeFilter = document.getElementById('date-range-filter').value;
            
            filteredWorkOrders = workOrders.filter(workOrder => {
                const matchesCategory = !categoryFilter || workOrder.work_category === categoryFilter;
                const matchesCompany = !companyFilter || workOrder.company_name === companyFilter;
                const matchesState = !stateFilter || workOrder.state === stateFilter;
                
                let matchesDate = true;
                if (dateRangeFilter && workOrder.service_date) {
                    const workOrderDate = new Date(workOrder.service_date);
                    const now = new Date();
                    
                    switch(dateRangeFilter) {
                        case 'last-year':
                            matchesDate = workOrderDate >= new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
                            break;
                        case 'last-2-years':
                            matchesDate = workOrderDate >= new Date(now.getFullYear() - 2, now.getMonth(), now.getDate());
                            break;
                        case 'last-5-years':
                            matchesDate = workOrderDate >= new Date(now.getFullYear() - 5, now.getMonth(), now.getDate());
                            break;
                    }
                }
                
                return matchesCategory && matchesCompany && matchesState && matchesDate;
            });
            
            displayWorkOrders();
        }

        // Clear work order filters
        function clearWorkOrderFilters() {
            document.getElementById('work-order-search').value = '';
            document.getElementById('category-filter').value = '';
            document.getElementById('company-filter').value = '';
            document.getElementById('state-filter').value = '';
            document.getElementById('date-range-filter').value = '';
            
            filteredWorkOrders = [...workOrders];
            displayWorkOrders();
        }

        // Add work order to cart
        function addWorkOrderToCart(workOrderId) {
            const workOrder = workOrders.find(wo => wo.id === workOrderId);
            if (!workOrder) return;
            
            // Convert work order to cart item format
            const cartItem = {
                id: `wo_${workOrder.id}`,
                title: workOrder.title,
                content: `${workOrder.company_name} - ${workOrder.work_description || 'Work Order'}`,
                section_type: 'work_experience',
                section_type_name: 'work_experience',
                type: 'work_order',
                original_id: workOrder.id,
                data: workOrder
            };
            
            // Check if already in cart
            if (cart.find(item => item.id === cartItem.id)) {
                showStatus('Work order already in cart', 'warning');
                return;
            }
            
            cart.push(cartItem);
            updateCartDisplay();
            showStatus('Work order added to cart!', 'success');
        }

        // Toggle work order selection
        function toggleWorkOrderSelection(workOrderId) {
            console.log('toggleWorkOrderSelection called with ID:', workOrderId);
            console.log('Current selectedWorkOrders:', selectedWorkOrders);
            
            const index = selectedWorkOrders.indexOf(workOrderId);
            if (index === -1) {
                selectedWorkOrders.push(workOrderId);
                console.log('Added work order to selection');
            } else {
                selectedWorkOrders.splice(index, 1);
                console.log('Removed work order from selection');
            }
            
            console.log('Updated selectedWorkOrders:', selectedWorkOrders);
            updateWorkOrderBulkSelectionCount();
        }

        // Update bulk selection count for work orders
        function updateWorkOrderBulkSelectionCount() {
            console.log('updateWorkOrderBulkSelectionCount called');
            const countElement = document.getElementById('work-order-bulk-selection-count');
            console.log('Count element found:', countElement);
            
            if (countElement) {
                countElement.textContent = `${selectedWorkOrders.length} work orders selected`;
                console.log('Updated count to:', selectedWorkOrders.length);
                
                // Auto-show bulk actions panel if items are selected
                const panel = document.getElementById('work-order-bulk-actions-panel');
                if (selectedWorkOrders.length > 0) {
                    panel.style.display = 'block';
                    console.log('Showing bulk actions panel');
                } else {
                    panel.style.display = 'none';
                    console.log('Hiding bulk actions panel');
                }
            } else {
                console.error('work-order-bulk-selection-count element not found!');
            }
        }

        // Show bulk actions panel for work orders
        function showBulkWorkOrderActions() {
            const panel = document.getElementById('work-order-bulk-actions-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Select all visible work orders
        function selectAllVisibleWorkOrders() {
            selectedWorkOrders = [...filteredWorkOrders.map(wo => wo.id)];
            
            // Update checkboxes
            document.querySelectorAll('.work-order-select').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            updateWorkOrderBulkSelectionCount();
        }

        // Deselect all work orders
        function deselectAllWorkOrders() {
            selectedWorkOrders = [];
            
            // Update checkboxes
            document.querySelectorAll('.work-order-select').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            updateWorkOrderBulkSelectionCount();
        }

        // Bulk add work orders to cart
        function bulkAddWorkOrdersToCart() {
            if (selectedWorkOrders.length === 0) {
                showStatus('Please select work orders first', 'warning');
                return;
            }
            
            let addedCount = 0;
            selectedWorkOrders.forEach(workOrderId => {
                const workOrder = workOrders.find(wo => wo.id === workOrderId);
                if (workOrder) {
                    const cartItem = {
                        id: `wo_${workOrder.id}`,
                        title: workOrder.title,
                        content: `${workOrder.company_name} - ${workOrder.work_description || 'Work Order'}`,
                        section_type: 'work_experience',
                        section_type_name: 'work_experience',
                        type: 'work_order',
                        original_id: workOrder.id,
                        data: workOrder
                    };
                    
                    // Check if already in cart
                    if (!cart.find(item => item.id === cartItem.id)) {
                        cart.push(cartItem);
                        addedCount++;
                    }
                }
            });
            
            updateCartDisplay();
            showStatus(`Added ${addedCount} work orders to cart!`, 'success');
            deselectAllWorkOrders();
        }

        // ==================== PROJECTS FUNCTIONALITY ====================
        
        let projects = [];
        let filteredProjects = [];
        let selectedProjects = [];

        // Load projects data
        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                projects = await response.json();
                filteredProjects = [...projects];
                
                await loadProjectFilters();
                await loadProjectStats();
                displayProjects();
                
                showStatus(`Loaded ${projects.length} projects`, 'success');
            } catch (error) {
                console.error('Error loading projects:', error);
                showStatus('Error loading projects', 'error');
            }
        }

        // Load filter options for projects
        function loadProjectFilters() {
            // Populate project type filter
            const projectTypeFilter = document.getElementById('project-type-filter');
            projectTypeFilter.innerHTML = '<option value="">All Types</option>';
            const uniqueTypes = [...new Set(projects.map(p => p.project_type).filter(Boolean))].sort();
            uniqueTypes.forEach(type => {
                projectTypeFilter.innerHTML += `<option value="${type}">${type}</option>`;
            });
            
            // Populate client type filter
            const clientTypeFilter = document.getElementById('client-type-filter');
            clientTypeFilter.innerHTML = '<option value="">All Client Types</option>';
            const uniqueClientTypes = [...new Set(projects.map(p => p.client_type).filter(Boolean))].sort();
            uniqueClientTypes.forEach(type => {
                clientTypeFilter.innerHTML += `<option value="${type}">${type}</option>`;
            });
        }

        // Load project statistics
        function loadProjectStats() {
            const totalProjects = projects.length;
            const activeProjects = projects.filter(p => 
                !p.end_date || new Date(p.end_date) > new Date()
            ).length;
            
            const totalEarnings = projects.reduce((sum, p) => sum + (p.total_earnings || 0), 0);
            
            const avgDuration = projects.length > 0 ? 
                projects.reduce((sum, p) => sum + (p.duration_weeks || 0), 0) / projects.length : 0;
            
            document.getElementById('total-projects').textContent = totalProjects;
            document.getElementById('active-projects').textContent = activeProjects;
            document.getElementById('project-total-earnings').textContent = `$${totalEarnings.toFixed(2)}`;
            document.getElementById('avg-project-duration').textContent = Math.round(avgDuration);
        }

        // Display projects in grid
        function displayProjects() {
            const grid = document.getElementById('projects-grid');
            const resultsCount = document.getElementById('project-results-count');
            
            if (filteredProjects.length === 0) {
                grid.innerHTML = '<p>No projects found. Try adjusting your filters.</p>';
                resultsCount.textContent = 'No projects found';
                return;
            }
            
            resultsCount.textContent = `Showing ${filteredProjects.length} projects`;
            
            grid.innerHTML = filteredProjects.map(project => `
                <div class="component-card project-card" data-id="${project.id}">
                    <div class="component-title">
                        <input type="checkbox" class="project-select" data-id="${project.id}" onchange="toggleProjectSelection(${project.id})">
                        <span class="card-title">${project.project_name}</span>
                    </div>
                    <div class="component-preview">
                        <strong>Client:</strong> ${project.client_name || 'N/A'}<br>
                        <strong>Type:</strong> ${project.project_type || 'N/A'}<br>
                        <strong>Duration:</strong> ${project.duration_weeks || 'N/A'} weeks<br>
                        <strong>Role:</strong> ${project.my_role || 'N/A'}<br>
                        <strong>Earnings:</strong> $${project.total_earnings || 0}<br>
                        ${project.project_description ? `<strong>Description:</strong> ${project.project_description.substring(0, 150)}...` : ''}
                    </div>
                    <div class="component-meta">
                        <span>Priority: ${project.priority_level || 1} | Work Orders: ${project.total_work_orders || 0}</span>
                        <button onclick="addProjectToCart(${project.id})" class="success" style="padding: 5px 10px; font-size: 12px;">🛒 Add to Cart</button>
                    </div>
                </div>
            `).join('');
        }

        // Search projects
        function searchProjects() {
            const searchTerm = document.getElementById('project-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredProjects = [...projects];
            } else {
                filteredProjects = projects.filter(project => 
                    project.project_name.toLowerCase().includes(searchTerm) ||
                    (project.client_name && project.client_name.toLowerCase().includes(searchTerm)) ||
                    (project.project_description && project.project_description.toLowerCase().includes(searchTerm)) ||
                    (project.key_achievements && project.key_achievements.toLowerCase().includes(searchTerm))
                );
            }
            
            displayProjects();
        }

        // Filter projects
        function filterProjects() {
            const projectTypeFilter = document.getElementById('project-type-filter').value;
            const clientTypeFilter = document.getElementById('client-type-filter').value;
            const priorityFilter = document.getElementById('priority-filter').value;
            const statusFilter = document.getElementById('project-status-filter').value;
            
            filteredProjects = projects.filter(project => {
                const matchesType = !projectTypeFilter || project.project_type === projectTypeFilter;
                const matchesClientType = !clientTypeFilter || project.client_type === clientTypeFilter;
                const matchesPriority = !priorityFilter || project.priority_level == priorityFilter;
                
                let matchesStatus = true;
                if (statusFilter) {
                    const now = new Date();
                    const startDate = project.start_date ? new Date(project.start_date) : null;
                    const endDate = project.end_date ? new Date(project.end_date) : null;
                    
                    switch(statusFilter) {
                        case 'active':
                            matchesStatus = startDate && startDate <= now && (!endDate || endDate > now);
                            break;
                        case 'completed':
                            matchesStatus = endDate && endDate <= now;
                            break;
                        case 'planned':
                            matchesStatus = startDate && startDate > now;
                            break;
                        case 'on-hold':
                            // This would need a status field in the database
                            matchesStatus = true;
                            break;
                    }
                }
                
                return matchesType && matchesClientType && matchesPriority && matchesStatus;
            });
            
            displayProjects();
        }

        // Clear project filters
        function clearProjectFilters() {
            document.getElementById('project-search').value = '';
            document.getElementById('project-type-filter').value = '';
            document.getElementById('client-type-filter').value = '';
            document.getElementById('priority-filter').value = '';
            document.getElementById('project-status-filter').value = '';
            
            filteredProjects = [...projects];
            displayProjects();
        }

        // Add project to cart
        function addProjectToCart(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            // Convert project to cart item format
            const cartItem = {
                id: `proj_${project.id}`,
                title: project.project_name,
                content: `${project.client_name || 'Project'} - ${project.project_description || project.key_achievements || 'Project Work'}`,
                section_type: 'projects',
                section_type_name: 'projects',
                type: 'project',
                original_id: project.id,
                data: project
            };
            
            // Check if already in cart
            if (cart.find(item => item.id === cartItem.id)) {
                showStatus('Project already in cart', 'warning');
                return;
            }
            
            cart.push(cartItem);
            updateCartDisplay();
            showStatus('Project added to cart!', 'success');
        }

        // Toggle project selection
        function toggleProjectSelection(projectId) {
            console.log('toggleProjectSelection called with ID:', projectId);
            console.log('Current selectedProjects:', selectedProjects);
            
            const index = selectedProjects.indexOf(projectId);
            if (index === -1) {
                selectedProjects.push(projectId);
                console.log('Added project to selection');
            } else {
                selectedProjects.splice(index, 1);
                console.log('Removed project from selection');
            }
            
            console.log('Updated selectedProjects:', selectedProjects);
            updateProjectBulkSelectionCount();
        }

        // Update bulk selection count for projects
        function updateProjectBulkSelectionCount() {
            const countElement = document.getElementById('project-bulk-selection-count');
            countElement.textContent = `${selectedProjects.length} projects selected`;
        }

        // Show bulk actions panel for projects
        function showBulkProjectActions() {
            const panel = document.getElementById('project-bulk-actions-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Select all visible projects
        function selectAllVisibleProjects() {
            selectedProjects = [...filteredProjects.map(p => p.id)];
            
            // Update checkboxes
            document.querySelectorAll('.project-select').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            updateProjectBulkSelectionCount();
        }

        // Deselect all projects
        function deselectAllProjects() {
            selectedProjects = [];
            
            // Update checkboxes
            document.querySelectorAll('.project-select').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            updateProjectBulkSelectionCount();
        }

        // Bulk add projects to cart
        function bulkAddProjectsToCart() {
            if (selectedProjects.length === 0) {
                showStatus('Please select projects first', 'warning');
                return;
            }
            
            let addedCount = 0;
            selectedProjects.forEach(projectId => {
                const project = projects.find(p => p.id === projectId);
                if (project) {
                    const cartItem = {
                        id: `proj_${project.id}`,
                        title: project.project_name,
                        content: `${project.client_name || 'Project'} - ${project.project_description || project.key_achievements || 'Project Work'}`,
                        section_type: 'projects',
                        section_type_name: 'projects',
                        type: 'project',
                        original_id: project.id,
                        data: project
                    };
                    
                    // Check if already in cart
                    if (!cart.find(item => item.id === cartItem.id)) {
                        cart.push(cartItem);
                        addedCount++;
                    }
                }
            });
            
            updateCartDisplay();
            showStatus(`Added ${addedCount} projects to cart!`, 'success');
            deselectAllProjects();
        }

        // Placeholder functions for project management
        function showCreateProjectModal() {
            showStatus('Project creation feature coming soon!', 'info');
        }

        // Enhanced bulk functions for work orders
        function addSelectedWorkOrdersToCart() {
            return bulkAddWorkOrdersToCart(); // Reuse existing function
        }

        function addSelectedProjectsToCart() {
            return bulkAddProjectsToCart(); // Reuse existing function
        }

        // Enhanced bulk create components functionality
        function bulkCreateComponentsFromWorkOrders() {
            if (selectedWorkOrders.length === 0) {
                showStatus('Please select work orders first', 'warning');
                return;
            }
            
            let createdCount = 0;
            const promises = [];
            
            selectedWorkOrders.forEach(workOrderId => {
                const workOrder = workOrders.find(wo => wo.id === workOrderId);
                if (workOrder) {
                    // Create a comprehensive component from work order
                    const componentData = {
                        title: `${workOrder.title} - ${workOrder.company_name}`,
                        content: `${workOrder.company_name} - ${workOrder.title}
                        
Service Date: ${workOrder.service_date || 'N/A'}
Location: ${workOrder.city || 'N/A'}, ${workOrder.state || 'N/A'}
Category: ${workOrder.work_category || 'N/A'}
Pay: $${workOrder.pay_amount || 0}

${workOrder.work_description || 'Work order completion'}

Technologies Used: ${workOrder.technologies_used ? JSON.parse(workOrder.technologies_used).join(', ') : 'Various technical skills'}`,
                        section_type: 'work_experience',
                        tags: [workOrder.work_category, workOrder.company_name, ...(workOrder.technologies_used ? JSON.parse(workOrder.technologies_used) : [])].filter(Boolean).join(', '),
                        industry_tags: workOrder.work_category || 'Technology Services',
                        skill_level: 'intermediate'
                    };
                    
                    // Add component to database
                    const promise = fetch('/add_component', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(componentData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            createdCount++;
                        }
                    })
                    .catch(error => {
                        console.error('Error creating component:', error);
                    });
                    
                    promises.push(promise);
                }
            });
            
            Promise.all(promises).then(() => {
                showStatus(`Successfully created ${createdCount} components from work orders!`, 'success');
                loadComponentLibrary(); // Refresh component library
                loadDashboard(); // Update stats
                deselectAllWorkOrders();
            });
        }

        function bulkCreateComponentsFromProjects() {
            if (selectedProjects.length === 0) {
                showStatus('Please select projects first', 'warning');
                return;
            }
            
            let createdCount = 0;
            const promises = [];
            
            selectedProjects.forEach(projectId => {
                const project = projects.find(p => p.id === projectId);
                if (project) {
                    // Create a comprehensive component from project
                    const componentData = {
                        title: `${project.project_name} - ${project.client_name || 'Project'}`,
                        content: `${project.client_name || 'Client'} - ${project.project_name}
                        
Project Type: ${project.project_type || 'N/A'}
Duration: ${project.duration_weeks || 'N/A'} weeks
Role: ${project.my_role || 'N/A'}
Earnings: $${project.total_earnings || 0}

${project.project_description || project.key_achievements || 'Project completion and delivery'}

Key Achievements:
${project.key_achievements || 'Successfully delivered project objectives'}`,
                        section_type: 'projects',
                        tags: [project.project_type, project.client_name, project.my_role].filter(Boolean).join(', '),
                        industry_tags: project.project_type || 'Project Management',
                        skill_level: 'advanced'
                    };
                    
                    // Add component to database
                    const promise = fetch('/add_component', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(componentData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            createdCount++;
                        }
                    })
                    .catch(error => {
                        console.error('Error creating component:', error);
                    });
                    
                    promises.push(promise);
                }
            });
            
            Promise.all(promises).then(() => {
                showStatus(`Successfully created ${createdCount} components from projects!`, 'success');
                loadComponentLibrary(); // Refresh component library
                loadDashboard(); // Update stats
                deselectAllProjects();
            });
        }

        // Bulk export functionality
        function bulkExportWorkOrders() {
            if (selectedWorkOrders.length === 0) {
                showStatus('Please select work orders first', 'warning');
                return;
            }
            
            const selectedData = workOrders.filter(wo => selectedWorkOrders.includes(wo.id));
            const csvContent = convertToCSV(selectedData, 'work_orders');
            downloadCSV(csvContent, `work_orders_export_${new Date().getTime()}.csv`);
            showStatus(`Exported ${selectedData.length} work orders to CSV`, 'success');
        }

        function bulkExportProjects() {
            if (selectedProjects.length === 0) {
                showStatus('Please select projects first', 'warning');
                return;
            }
            
            const selectedData = projects.filter(p => selectedProjects.includes(p.id));
            const csvContent = convertToCSV(selectedData, 'projects');
            downloadCSV(csvContent, `projects_export_${new Date().getTime()}.csv`);
            showStatus(`Exported ${selectedData.length} projects to CSV`, 'success');
        }

        // Helper functions for CSV export
        function convertToCSV(data, type) {
            if (!data.length) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [];
            
            // Add headers
            csvRows.push(headers.join(','));
            
            // Add data rows
            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header];
                    // Escape commas and quotes
                    return typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value;
                });
                csvRows.push(values.join(','));
            });
            
            return csvRows.join('\n');
        }

        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
</html>