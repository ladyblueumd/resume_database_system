<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Resume Database System</title>
    <style>
        body {
            font-family: 'Calibri', 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #2f5597;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: -1px;
            font-size: 14px;
        }
        .tab.active {
            background-color: white;
            font-weight: bold;
            border-bottom: 1px solid white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        textarea, input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            box-sizing: border-box;
        }
        button {
            background-color: #2f5597;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #1e3a6a;
        }
        button.secondary {
            background-color: #6c757d;
        }
        button.success {
            background-color: #28a745;
        }
        button.danger {
            background-color: #dc3545;
        }
        .search-interface {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .component-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .component-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #2f5597;
        }
        .component-card.selected {
            border-color: #2f5597;
            background-color: #e3f2fd;
        }
        .component-title {
            font-weight: bold;
            color: #2f5597;
            margin-bottom: 8px;
        }
        .component-preview {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
            max-height: none;
            overflow: visible;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        .component-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
        }
        .job-analysis {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .match-score {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }
        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .keyword-tag {
            background-color: #2f5597;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        .employment-entry {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fafafa;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-row.full {
            grid-template-columns: 1fr;
        }
        .suggestions-panel {
            background-color: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .suggestion-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background-color: #e3f2fd;
        }
        .ai-status {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
        }
        .resume-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .selected-components {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }
        .selected-component {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        .remove-component {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 12px;
            cursor: pointer;
            padding: 0;
            margin: 0;
        }
        .preview-pane {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        .instruction {
            background-color: #e9f7fe;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #2f5597;
        }
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2f5597;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .resume-builder {
                grid-template-columns: 1fr;
            }
            .tabs {
                overflow-x: auto;
            }
        }

        /* Resume Importer Styles */
        .resume-display-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            user-select: text;
            cursor: text;
        }

        .resume-display-area::-webkit-scrollbar {
            width: 8px;
        }

        .resume-display-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .resume-display-area::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .resume-display-area::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        .resume-display-controls {
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .upload-area {
            border: 2px dashed #ddd;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .upload-area:hover {
            border-color: #2f5597;
            background-color: #f8f9ff;
        }

        .import-method {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h2 {
            margin: 0;
            color: #2f5597;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover,
        .close:focus {
            color: #2f5597;
            text-decoration: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .modal-actions {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Component Action Buttons */
        .component-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            z-index: 10;
            position: relative;
        }

        .component-actions button {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .component-actions .edit-btn {
            background: #007bff;
            color: white;
        }

        .component-actions .edit-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }

        .component-actions .delete-btn {
            background: #dc3545;
            color: white;
        }

        .component-actions .delete-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(220,53,69,0.3);
        }

        /* Sub-tabs styles */
        .sub-tabs {
            display: flex;
            margin-bottom: 1rem;
        }

        .sub-tab {
            padding: 8px 16px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-bottom: none;
            margin-right: 2px;
            font-size: 14px;
            color: #6c757d;
            transition: all 0.2s ease;
        }

        .sub-tab:hover {
            background-color: #e9ecef;
            color: #495057;
        }

        .sub-tab.active {
            background-color: white;
            color: #2f5597;
            font-weight: 500;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* Resume and template card styles */
        .resume-card, .template-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .resume-card:hover, .template-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #2f5597;
        }

        .resume-meta, .template-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
            margin-top: 10px;
        }

        .file-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 8px;
        }

        .tag {
            background-color: #e9ecef;
            color: #495057;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
        }

        /* Resume Builder Interface Styles */
        .resume-builder-interface {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .components-sidebar {
            flex: 1;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .component-search {
            margin-bottom: 20px;
        }

        .component-search input, .component-search select {
            margin-bottom: 10px;
        }

        .component-list {
            list-style: none;
            padding: 0;
        }

        .builder-component-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .builder-component-item:hover {
            border-color: #2f5597;
            box-shadow: 0 2px 8px rgba(47, 85, 151, 0.2);
        }

        .builder-component-title {
            font-weight: bold;
            color: #2f5597;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .builder-component-preview {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            max-height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .builder-component-meta {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #888;
        }

        .add-to-cart-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-top: 5px;
        }

        .add-to-cart-btn:hover {
            background-color: #218838;
        }

        .add-to-cart-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .shopping-cart {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .cart-item {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            position: relative;
        }

        .cart-item-title {
            font-weight: bold;
            color: #2f5597;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .cart-item-preview {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
            max-height: 30px;
            overflow: hidden;
        }

        .cart-item-type {
            font-size: 10px;
            color: #888;
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
        }

        .remove-from-cart {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-from-cart:hover {
            background-color: #c82333;
        }

        .cart-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 10px;
        }

        .cart-stats {
            text-align: center;
            font-size: 12px;
            color: #666;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .resume-canvas {
            flex: 2;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .canvas-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .resume-preview {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Times New Roman', serif;
            line-height: 1.4;
        }

        .resume-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #2f5597;
            padding-bottom: 10px;
        }

        .resume-header h1 {
            margin: 0;
            color: #2f5597;
            font-size: 24px;
        }

        .resume-header p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 14px;
        }

        .resume-content {
            min-height: 300px;
        }

        .resume-section {
            margin-bottom: 20px;
        }

        .resume-section h3 {
            color: #2f5597;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .resume-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fafafa;
            border-left: 3px solid #2f5597;
        }

        .resume-item h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 14px;
        }

        .resume-item p {
            margin: 0;
            font-size: 12px;
            line-height: 1.4;
        }

        .empty-canvas {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 50px 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 2px dashed #ddd;
        }

        .cart-empty {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        /* Responsive design for smaller screens */
        @media (max-width: 1200px) {
            .resume-builder-interface {
                flex-direction: column;
            }
            
            .components-sidebar, .shopping-cart, .resume-canvas {
                flex: none;
                max-height: none;
            }
            
            .shopping-cart {
                order: 2;
            }
            
            .resume-canvas {
                order: 3;
            }
        }

        @media (max-width: 768px) {
            .canvas-controls {
                flex-direction: column;
            }
            
            .canvas-controls button {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 AI-Powered Resume Database System</h1>
        
        <div class="instruction">
            <h3>Welcome to Your Intelligent Resume Builder!</h3>
            <p><strong>New Features:</strong> 🔍 Search resume components • 📋 Paste job descriptions for AI matching • 💼 Track employment history • 🎯 Get targeted suggestions</p>
            <p><strong>How it works:</strong> Build a database of resume components, paste job descriptions to get AI-powered matches, and generate customized resumes instantly.</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">📊 Dashboard</div>
            <div class="tab" data-tab="job-matcher">🎯 Job Matcher</div>
            <div class="tab" data-tab="component-library">📚 Component Library</div>
            <div class="tab" data-tab="employment-history">💼 Employment History</div>
            <div class="tab" data-tab="resume-builder">🔨 Resume Builder</div>
            <div class="tab" data-tab="importer">📥 Resume Importer</div>
            <div class="tab" data-tab="resume-library">📁 Resume Library</div>
            <div class="tab" data-tab="settings">⚙️ Settings</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <h2>📊 Dashboard Overview</h2>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-number" id="total-components">0</div>
                    <div class="stat-label">Resume Components</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-jobs">0</div>
                    <div class="stat-label">Job Descriptions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-resumes">0</div>
                    <div class="stat-label">Generated Resumes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-employers">0</div>
                    <div class="stat-label">Employers</div>
                </div>
            </div>
            
            <div class="ai-status" id="ai-status">
                🤖 AI Resume Assistant Ready - Database initialized and ready for component matching
            </div>
            
            <h3>Recent Activity</h3>
            <div id="recent-activity">
                <p>📝 Start by importing your existing resumes or adding job descriptions to begin building your component library.</p>
            </div>
            
            <h3>Quick Actions</h3>
            <button onclick="switchTab('job-matcher')">🎯 Analyze New Job</button>
            <button onclick="switchTab('component-library')">📚 Browse Components</button>
            <button onclick="switchTab('resume-builder')">🔨 Build Resume</button>
            <button onclick="switchTab('importer')">📥 Import Resume</button>
        </div>
        
        <!-- Job Matcher Tab -->
        <div class="tab-content" id="job-matcher">
            <h2>🎯 AI Job Description Matcher</h2>
            
            <div class="search-interface">
                <h3>Paste Job Description</h3>
                <textarea id="job-description-input" rows="10" placeholder="Paste the complete job description here... The AI will analyze requirements and suggest matching resume components."></textarea>
                
                <div class="form-row">
                    <div>
                        <label for="company-name">Company Name:</label>
                        <input type="text" id="company-name" placeholder="Company Name">
                    </div>
                    <div>
                        <label for="position-title">Position Title:</label>
                        <input type="text" id="position-title" placeholder="Position Title">
                    </div>
                </div>
                
                <button onclick="analyzeJobDescription()" class="success">🔍 Analyze Job & Find Matches</button>
                <button onclick="saveJobDescription()" class="secondary">💾 Save Job Description</button>
            </div>
            
            <div id="job-analysis-results" style="display: none;">
                <div class="job-analysis">
                    <h3>📋 Analysis Results</h3>
                    <div id="extracted-keywords"></div>
                    <div id="match-suggestions"></div>
                </div>
                
                <div class="suggestions-panel">
                    <h3>🎯 Recommended Resume Components</h3>
                    <div id="component-suggestions"></div>
                </div>
            </div>
        </div>
        
        <!-- Component Library Tab -->
        <div class="tab-content" id="component-library">
            <h2>📚 Resume Component Library</h2>
            
            <div class="search-interface">
                <h3>Search Components</h3>
                <div class="form-row">
                    <div>
                        <input type="text" id="component-search" placeholder="Search by keywords, title, or content...">
                    </div>
                    <div>
                        <select id="section-filter">
                            <option value="">All Sections</option>
                            <option value="professional_summary">Professional Summary</option>
                            <option value="technical_skills">Technical Skills</option>
                            <option value="professional_skills">Professional Skills</option>
                            <option value="work_experience">Work Experience</option>
                            <option value="projects">Projects</option>
                            <option value="certifications">Certifications</option>
                            <option value="education">Education</option>
                            <option value="accomplishments">Accomplishments</option>
                        </select>
                    </div>
                </div>
                <button onclick="searchComponents()" class="success">🔍 Search</button>
                <button onclick="showAddComponentModal()" class="success">➕ Add New Component</button>
            </div>
            
            <div class="component-grid" id="component-grid">
                <!-- Components will be populated here -->
            </div>
        </div>
        
        <!-- Employment History Tab -->
        <div class="tab-content" id="employment-history">
            <h2>💼 Employment History Database</h2>
            
            <button onclick="showAddEmploymentModal()" class="success">➕ Add New Employer</button>
            <button onclick="exportEmploymentData()" class="secondary">📤 Export Data</button>
            
            <div id="employment-list">
                <!-- Employment history will be populated here -->
            </div>
        </div>
        
        <!-- Resume Builder Tab -->
        <div class="tab-content" id="resume-builder">
            <h2>🔨 Resume Builder</h2>
            
            <div class="form-row">
                <div>
                    <label for="resume-title">Resume Title:</label>
                    <input type="text" id="resume-title" placeholder="e.g., Desktop Support Specialist - TechCorp">
                </div>
                <div>
                    <label for="target-job">Target Job ID (optional):</label>
                    <input type="text" id="target-job" placeholder="Link to specific job description">
                </div>
            </div>
            
            <!-- Resume Builder Interface -->
            <div class="resume-builder-interface">
                <!-- Component Library Sidebar -->
                <div class="components-sidebar">
                    <h3>📚 Component Library</h3>
                    <div class="component-search">
                        <input type="text" id="component-builder-search" placeholder="Search components..." onkeyup="filterBuilderComponents()">
                        <select id="component-type-filter" onchange="filterBuilderComponents()">
                            <option value="">All Types</option>
                            <option value="professional_summary">Professional Summary</option>
                            <option value="technical_skills">Technical Skills</option>
                            <option value="work_experience">Work Experience</option>
                            <option value="projects">Projects</option>
                            <option value="education">Education</option>
                            <option value="certifications">Certifications</option>
                            <option value="achievements">Achievements</option>
                        </select>
                    </div>
                    <div class="component-list" id="builder-component-list">
                        <!-- Components will be loaded here -->
                    </div>
                </div>
                
                <!-- Shopping Cart -->
                <div class="shopping-cart">
                    <h3>🛒 Shopping Cart</h3>
                    <div class="cart-items" id="cart-items">
                        <p>Add components to your cart to build your resume</p>
                    </div>
                    <div class="cart-actions">
                        <button onclick="clearCart()" class="secondary">🗑️ Clear Cart</button>
                        <button onclick="checkoutCart()" class="success">✅ Checkout</button>
                    </div>
                    <div class="cart-stats">
                        <span id="cart-count">0 items</span>
                    </div>
                </div>
                
                <!-- Resume Canvas -->
                <div class="resume-canvas">
                    <h3>📄 Resume Canvas</h3>
                    <div class="canvas-controls">
                        <button onclick="generateResumePreview()" class="success">🔄 Update Preview</button>
                        <button onclick="exportResume()" class="secondary">📄 Export Resume</button>
                        <button onclick="saveResumeTemplate()" class="secondary">💾 Save Template</button>
                    </div>
                    <div class="resume-preview" id="resume-preview">
                        <div class="resume-header">
                            <h1 id="resume-name">Sadiqa 'Sadie' Thornton</h1>
                            <p id="resume-contact">info@sadiethetechladyservices.net</p>
                        </div>
                        <div class="resume-content" id="resume-content">
                            <p class="empty-canvas">Select components from the library and add them to your cart, then checkout to build your resume.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resume Importer Tab -->
        <div class="tab-content" id="importer">
            <!-- Resume Importer Section -->
            <div class="search-interface">
                <h2>📥 Resume Importer</h2>
                <p>Upload your resume to extract the text, then manually select and create components from the displayed content.</p>
                
                <div class="resume-import-methods">
                    <!-- File Upload Method -->
                    <div class="import-method">
                        <h3>📎 Upload Resume File</h3>
                        <div class="upload-area" onclick="document.getElementById('resume-file-input').click()">
                            <p>📁 Click here to select a resume file</p>
                            <p style="font-size: 0.9rem; color: #666;">Supports: .txt, .doc, .docx, .pdf, .html</p>
                        </div>
                        <input type="file" id="resume-file-input" accept=".txt,.doc,.docx,.pdf,.html" style="display: none;" onchange="uploadAndDisplayResume()">
                        
                        <div id="file-upload-status" style="margin-top: 1rem;"></div>
                    </div>
                    
                    <!-- Text Input Method -->
                    <div class="import-method">
                        <h3>📝 Paste Resume Text</h3>
                        <textarea id="resume-text-input" placeholder="Paste your resume text here..." rows="8" style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 6px; font-family: inherit;"></textarea>
                        <button class="success" onclick="displayPastedText()" style="margin-top: 1rem;">📄 Display Text</button>
                    </div>
                </div>
                
                <!-- Resume Display Area -->
                <div id="resume-display-section" style="display: none;">
                    <h3>📄 Resume Content</h3>
                    <p>Select any text below and click "Create Component" to add it to your library:</p>
                    
                    <div class="resume-display-controls">
                        <button class="success" onclick="createComponentFromSelection()">➕ Create Component from Selection</button>
                        <button class="secondary" onclick="clearResumeDisplay()">🗑️ Clear Display</button>
                    </div>
                    
                    <div id="resume-display-area" class="resume-display-area">
                        <!-- Resume text will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resume Library Tab -->
        <div class="tab-content" id="resume-library">
            <h2>📁 Resume Library</h2>
            
            <!-- Sub-tabs for Resume Library -->
            <div class="sub-tabs" style="border-bottom: 1px solid #ddd; margin-bottom: 20px;">
                <div class="sub-tab active" data-subtab="uploaded-resumes" onclick="switchResumeSubTab('uploaded-resumes')">📄 Uploaded Resumes</div>
                <div class="sub-tab" data-subtab="templates" onclick="switchResumeSubTab('templates')">📋 Templates</div>
            </div>
            
            <!-- Uploaded Resumes Section -->
            <div class="sub-tab-content active" id="uploaded-resumes">
                <div class="search-interface">
                    <h3>Uploaded Resume Documents</h3>
                    <p>View and manage all your uploaded resume files with full text content.</p>
                    
                    <div class="form-row">
                        <div>
                            <input type="text" id="resume-search" placeholder="Search by title, filename, or content...">
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <label>
                                <input type="checkbox" id="include-archived"> Include archived
                            </label>
                        </div>
                    </div>
                    <button onclick="searchUploadedResumes()" class="success">🔍 Search</button>
                    <button onclick="loadUploadedResumes()" class="secondary">🔄 Refresh</button>
                </div>
                
                <div class="stats-panel" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-number" id="total-uploaded-resumes">0</div>
                        <div class="stat-label">Total Resumes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-extracted-components">0</div>
                        <div class="stat-label">Components Extracted</div>
                    </div>
                </div>
                
                <div class="component-grid" id="uploaded-resumes-grid">
                    <!-- Uploaded resumes will be populated here -->
                </div>
            </div>
            
            <!-- Templates Section -->
            <div class="sub-tab-content" id="templates">
                <div class="search-interface">
                    <h3>Resume Templates</h3>
                    <p>Manage your resume templates for different roles and industries.</p>
                    
                    <div class="form-row">
                        <div>
                            <input type="text" id="template-search" placeholder="Search templates by name or role...">
                        </div>
                    </div>
                    <button onclick="searchTemplates()" class="success">🔍 Search</button>
                    <button onclick="showAddTemplateModal()" class="success">➕ Add Template</button>
                    <button onclick="loadTemplates()" class="secondary">🔄 Refresh</button>
                </div>
                
                <div class="component-grid" id="templates-grid">
                    <!-- Templates will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <h2>⚙️ System Settings</h2>
            
            <div class="search-interface">
                <h3>AI Configuration</h3>
                <div class="form-row">
                    <div>
                        <label for="ai-model">AI Model:</label>
                        <select id="ai-model">
                            <option value="local">Local LM Studio</option>
                            <option value="openai">OpenAI GPT-4</option>
                            <option value="anthropic">Claude</option>
                        </select>
                    </div>
                    <div>
                        <label for="match-threshold">Match Threshold:</label>
                        <input type="range" id="match-threshold" min="0.5" max="1.0" step="0.1" value="0.7">
                        <span id="threshold-value">0.7</span>
                    </div>
                </div>
                
                <h3>Database Management</h3>
                <button onclick="exportDatabase()" class="secondary">📤 Export Database</button>
                <button onclick="importDatabase()" class="secondary">📥 Import Database</button>
                <button onclick="clearDatabase()" class="danger">🗑️ Clear All Data</button>
                
                <h3>Personal Information</h3>
                <div class="form-row">
                    <div>
                        <label for="user-name">Full Name:</label>
                        <input type="text" id="user-name" value="Sadiqa 'Sadie' Thornton">
                    </div>
                    <div>
                        <label for="user-email">Email:</label>
                        <input type="email" id="user-email" value="info@sadiethetechladyservices.net">
                    </div>
                </div>
                
                <button onclick="saveSettings()" class="success">💾 Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Components -->
    <div id="component-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 30px; border-radius: 8px; width: 80%; max-width: 600px; max-height: 80%; overflow-y: auto;">
            <h3>➕ Add New Resume Component</h3>
            <div class="form-row">
                <div>
                    <label for="modal-section-type">Section Type:</label>
                    <select id="modal-section-type">
                        <option value="professional_summary">Professional Summary</option>
                        <option value="technical_skills">Technical Skills</option>
                        <option value="professional_skills">Professional Skills</option>
                        <option value="work_experience">Work Experience</option>
                        <option value="projects">Projects</option>
                        <option value="certifications">Certifications</option>
                        <option value="education">Education</option>
                        <option value="accomplishments">Accomplishments</option>
                        <option value="client_contract">Client/Contract</option>
                        <option value="summary_mission">Summary/Mission</option>
                        <option value="blank_component">Blank Component</option>
                    </select>
                </div>
                <div>
                    <label for="modal-skill-level">Skill Level:</label>
                    <select id="modal-skill-level">
                        <option value="entry">Entry Level</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>
            </div>
            <label for="modal-title">Component Title:</label>
            <input type="text" id="modal-title" placeholder="Brief descriptive title">
            <label for="modal-content">Content:</label>
            <textarea id="modal-content" rows="6" placeholder="Full component content"></textarea>
            <label for="modal-keywords">Keywords (comma-separated):</label>
            <input type="text" id="modal-keywords" placeholder="relevant, keywords, technologies">
            <label for="modal-industry-tags">Industry Tags (comma-separated):</label>
            <input type="text" id="modal-industry-tags" placeholder="healthcare, finance, technology">
            
            <div style="margin-top: 20px;">
                <button onclick="saveComponent()" class="success">💾 Save Component</button>
                <button onclick="closeModal('component-modal')" class="secondary">❌ Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Employment -->
    <div id="employment-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 30px; border-radius: 8px; width: 80%; max-width: 800px; max-height: 80%; overflow-y: auto;">
            <h3>💼 Add Employment History</h3>
            <div class="form-row">
                <div>
                    <label for="emp-company">Company Name:</label>
                    <input type="text" id="emp-company" placeholder="Company Name">
                </div>
                <div>
                    <label for="emp-position">Position Title:</label>
                    <input type="text" id="emp-position" placeholder="Job Title">
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="emp-start-date">Start Date:</label>
                    <input type="date" id="emp-start-date">
                </div>
                <div>
                    <label for="emp-end-date">End Date (leave blank if current):</label>
                    <input type="date" id="emp-end-date">
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="emp-location">Location:</label>
                    <input type="text" id="emp-location" placeholder="City, State">
                </div>
                <div>
                    <label for="emp-type">Employment Type:</label>
                    <select id="emp-type">
                        <option value="full-time">Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="freelance">Freelance</option>
                        <option value="internship">Internship</option>
                    </select>
                </div>
            </div>
            <label for="emp-responsibilities">Key Responsibilities (one per line):</label>
            <textarea id="emp-responsibilities" rows="4" placeholder="• Managed IT infrastructure&#10;• Provided technical support&#10;• Led deployment projects"></textarea>
            <label for="emp-achievements">Key Achievements (one per line):</label>
            <textarea id="emp-achievements" rows="3" placeholder="• Reduced downtime by 50%&#10;• Improved customer satisfaction&#10;• Led successful migration"></textarea>
            <label for="emp-technologies">Technologies Used (comma-separated):</label>
            <input type="text" id="emp-technologies" placeholder="Windows, Active Directory, ServiceNow">
            
            <div style="margin-top: 20px;">
                <button onclick="saveEmployment()" class="success">💾 Save Employment</button>
                <button onclick="closeModal('employment-modal')" class="secondary">❌ Cancel</button>
            </div>
        </div>
    </div>

    <!-- Component Creation Modal for Resume Importer -->
    <div id="create-component-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ Create Component from Selection</h2>
                <span class="close" onclick="closeCreateComponentModal()">&times;</span>
            </div>
            
            <div class="form-group">
                <label for="selected-text-preview">Selected Text:</label>
                <textarea id="selected-text-preview" readonly style="background: #f8f9fa; color: #6c757d;" rows="8"></textarea>
            </div>
            
            <div class="form-group">
                <label for="component-section-type">Component Type:</label>
                <select id="component-section-type">
                    <option value="work_experience">💼 Work Experience</option>
                    <option value="education">🎓 Education</option>
                    <option value="technical_skills">🔧 Technical Skills</option>
                    <option value="professional_skills">💻 Professional Skills</option>
                    <option value="certifications">📜 Certifications</option>
                    <option value="accomplishments">🏆 Accomplishments</option>
                    <option value="professional_summary">📋 Professional Summary</option>
                    <option value="projects">🚀 Projects</option>
                    <option value="client_contract">🤝 Client/Contract</option>
                    <option value="summary_mission">📝 Summary/Mission</option>
                    <option value="blank_component">📄 Blank Component</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="component-title-input">Component Title:</label>
                <input type="text" id="component-title-input" placeholder="Enter a descriptive title for this component">
            </div>
            
            <div class="form-group">
                <label for="component-content-input">Component Content:</label>
                <textarea id="component-content-input" rows="10" placeholder="Edit the content as needed..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="component-keywords-input">Keywords (optional):</label>
                <input type="text" id="component-keywords-input" placeholder="e.g. project management, leadership, technical support">
            </div>
            
            <div class="form-group">
                <label for="component-industry-input">Industry Tags (optional):</label>
                <input type="text" id="component-industry-input" placeholder="e.g. healthcare, finance, technology">
            </div>
            
            <div class="modal-actions">
                <button class="success" onclick="saveSelectedComponent()">💾 Save Component</button>
                <button class="secondary" onclick="closeCreateComponentModal()">❌ Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5001/api';
        let selectedComponents = [];
        
        // Database storage using localStorage (in production, use actual database)
        class ResumeDatabase {
            constructor() {
                this.components = JSON.parse(localStorage.getItem('resume_components') || '[]');
                this.employment = JSON.parse(localStorage.getItem('employment_history') || '[]');
                this.jobDescriptions = JSON.parse(localStorage.getItem('job_descriptions') || '[]');
                this.generatedResumes = JSON.parse(localStorage.getItem('generated_resumes') || '[]');
                this.selectedComponents = [];
            }
            
            saveComponents() {
                localStorage.setItem('resume_components', JSON.stringify(this.components));
            }
            
            saveEmployment() {
                localStorage.setItem('employment_history', JSON.stringify(this.employment));
            }
            
            saveJobDescriptions() {
                localStorage.setItem('job_descriptions', JSON.stringify(this.jobDescriptions));
            }
            
            saveGeneratedResumes() {
                localStorage.setItem('generated_resumes', JSON.stringify(this.generatedResumes));
            }
            
            addComponent(component) {
                component.id = Date.now().toString();
                component.created_at = new Date().toISOString();
                component.usage_count = 0;
                component.effectiveness_score = 0;
                this.components.push(component);
                this.saveComponents();
                return component;
            }
            
            addEmployment(employment) {
                employment.id = Date.now().toString();
                employment.created_at = new Date().toISOString();
                this.employment.push(employment);
                this.saveEmployment();
                return employment;
            }
            
            searchComponents(query, sectionFilter = '') {
                return this.components.filter(component => {
                    const matchesQuery = !query || 
                        component.title.toLowerCase().includes(query.toLowerCase()) ||
                        component.content.toLowerCase().includes(query.toLowerCase()) ||
                        (component.keywords && component.keywords.toLowerCase().includes(query.toLowerCase()));
                    
                    const matchesSection = !sectionFilter || component.section_type === sectionFilter;
                    
                    return matchesQuery && matchesSection;
                });
            }
            
            analyzeJobDescription(jobText) {
                // Simple keyword extraction (in production, use AI/NLP)
                const keywords = this.extractKeywords(jobText);
                const matches = this.findMatchingComponents(keywords);
                return { keywords, matches };
            }
            
            extractKeywords(text) {
                // Basic keyword extraction - would use AI in production
                const techKeywords = [
                    'windows', 'linux', 'macos', 'active directory', 'servicenow',
                    'desktop support', 'help desk', 'troubleshooting', 'hardware',
                    'software', 'network', 'security', 'server', 'cloud',
                    'office365', 'microsoft', 'vmware', 'citrix', 'azure',
                    'aws', 'cisco', 'dell', 'hp', 'lenovo', 'imaging',
                    'deployment', 'migration', 'backup', 'antivirus', 'firewall'
                ];
                
                const foundKeywords = [];
                const lowerText = text.toLowerCase();
                
                techKeywords.forEach(keyword => {
                    if (lowerText.includes(keyword)) {
                        foundKeywords.push(keyword);
                    }
                });
                
                return foundKeywords;
            }
            
            findMatchingComponents(keywords) {
                const matches = [];
                
                this.components.forEach(component => {
                    let score = 0;
                    const componentText = (component.title + ' ' + component.content + ' ' + (component.keywords || '')).toLowerCase();
                    
                    keywords.forEach(keyword => {
                        if (componentText.includes(keyword.toLowerCase())) {
                            score += 1;
                        }
                    });
                    
                    if (score > 0) {
                        matches.push({
                            component: component,
                            score: score,
                            matchPercentage: Math.round((score / keywords.length) * 100)
                        });
                    }
                });
                
                return matches.sort((a, b) => b.score - a.score);
            }
        }
        
        // Initialize database
        const db = new ResumeDatabase();
        
        // Tab navigation
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Load content based on tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'component-library':
                    loadComponentLibrary();
                    break;
                case 'employment-history':
                    loadEmploymentHistory();
                    break;
                case 'resume-library':
                    loadUploadedResumes(); // Load uploaded resumes by default
                    break;
                case 'resume-builder':
                    initializeResumeBuilder();
                    break;
            }
        }
        
        // Event listeners for tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                switchTab(tabName);
            });
        });
        
        // Dashboard functions
        function loadDashboard() {
            document.getElementById('total-components').textContent = db.components.length;
            document.getElementById('total-jobs').textContent = db.jobDescriptions.length;
            document.getElementById('total-resumes').textContent = db.generatedResumes.length;
            document.getElementById('total-employers').textContent = db.employment.length;
        }
        
        // Job Matcher functions
        function analyzeJobDescription() {
            const jobText = document.getElementById('job-description-input').value;
            const companyName = document.getElementById('company-name').value;
            const positionTitle = document.getElementById('position-title').value;
            
            if (!jobText.trim()) {
                alert('Please paste a job description to analyze.');
                return;
            }
            
            // Update AI status
            document.getElementById('ai-status').innerHTML = '🔄 Analyzing job description and finding matches...';
            
            setTimeout(() => {
                const analysis = db.analyzeJobDescription(jobText);
                displayJobAnalysis(analysis, jobText, companyName, positionTitle);
                
                document.getElementById('ai-status').innerHTML = `✅ Analysis complete! Found ${analysis.matches.length} matching components.`;
            }, 1000);
        }
        
        function displayJobAnalysis(analysis, jobText, companyName, positionTitle) {
            // Show results section
            document.getElementById('job-analysis-results').style.display = 'block';
            
            // Display extracted keywords
            const keywordsHtml = analysis.keywords.map(keyword => 
                `<span class="keyword-tag">${keyword}</span>`
            ).join('');
            document.getElementById('extracted-keywords').innerHTML = `
                <h4>🔍 Extracted Keywords (${analysis.keywords.length}):</h4>
                <div class="keyword-list">${keywordsHtml}</div>
            `;
            
            // Display component suggestions
            const suggestionsHtml = analysis.matches.map(match => `
                <div class="suggestion-item" onclick="addComponentToResume('${match.component.id}')">
                    <div class="match-score">Match: ${match.matchPercentage}%</div>
                    <strong>${match.component.title}</strong>
                    <p>${match.component.content.substring(0, 150)}...</p>
                    <small>Section: ${match.component.section_type} | Score: ${match.score}/${analysis.keywords.length}</small>
                </div>
            `).join('');
            
            document.getElementById('component-suggestions').innerHTML = suggestionsHtml || '<p>No matching components found. Consider adding more components to your library.</p>';
        }
        
        function saveJobDescription() {
            const jobText = document.getElementById('job-description-input').value;
            const companyName = document.getElementById('company-name').value;
            const positionTitle = document.getElementById('position-title').value;
            
            if (!jobText.trim() || !companyName.trim() || !positionTitle.trim()) {
                alert('Please fill in job description, company name, and position title.');
                return;
            }
            
            const jobDesc = {
                id: Date.now().toString(),
                company_name: companyName,
                position_title: positionTitle,
                job_description: jobText,
                keywords: db.extractKeywords(jobText),
                status: 'saved',
                created_at: new Date().toISOString()
            };
            
            db.jobDescriptions.push(jobDesc);
            db.saveJobDescriptions();
            
            alert('Job description saved successfully!');
            loadDashboard();
        }
        
        // Resume Importer functions
        let currentResumeText = '';
        let selectedText = '';

        // Upload and display resume file
        async function uploadAndDisplayResume() {
            const fileInput = document.getElementById('resume-file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('Please select a file first.', 'error');
                return;
            }
            
            showStatus('📤 Uploading and processing file...', 'info');
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/upload_resume_file', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentResumeText = result.text;
                    displayResumeText(result.text, result.filename);
                    showStatus(`✅ ${result.message}`, 'success');
                } else {
                    showStatus(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                showStatus('❌ Error uploading file. Please try again.', 'error');
            }
        }

        // Display pasted text
        function displayPastedText() {
            const textInput = document.getElementById('resume-text-input');
            const text = textInput.value.trim();
            
            if (!text) {
                showStatus('Please paste some resume text first.', 'error');
                return;
            }
            
            currentResumeText = text;
            displayResumeText(text, 'Pasted Text');
            showStatus('✅ Resume text displayed successfully!', 'success');
        }

        // Display resume text in the preview area
        function displayResumeText(text, filename) {
            const displayArea = document.getElementById('resume-display-area');
            const displaySection = document.getElementById('resume-display-section');
            
            displayArea.textContent = text;
            displaySection.style.display = 'block';
            
            // Add selection event listener
            displayArea.addEventListener('mouseup', handleTextSelection);
        }

        // Handle text selection
        function handleTextSelection() {
            const selection = window.getSelection();
            selectedText = selection.toString().trim();
            
            if (selectedText.length > 10) {
                showStatus(`Selected: "${selectedText.substring(0, 50)}${selectedText.length > 50 ? '...' : ''}"`, 'info');
            }
        }

        // Create component from selected text
        function createComponentFromSelection() {
            if (!selectedText || selectedText.length < 10) {
                showStatus('Please select some text first (minimum 10 characters).', 'error');
                return;
            }
            
            // Pre-fill the modal with selected text
            document.getElementById('selected-text-preview').value = selectedText;
            document.getElementById('component-content-input').value = selectedText;
            
            // Generate a suggested title
            const suggestedTitle = selectedText.substring(0, 50).replace(/\n.*/, '') + (selectedText.length > 50 ? '...' : '');
            document.getElementById('component-title-input').value = suggestedTitle;
            
            // Show the modal
            document.getElementById('create-component-modal').style.display = 'block';
        }

        // Save component from selection
        async function saveSelectedComponent() {
            const componentData = {
                section_type: document.getElementById('component-section-type').value,
                title: document.getElementById('component-title-input').value.trim(),
                content: document.getElementById('component-content-input').value.trim(),
                keywords: document.getElementById('component-keywords-input').value.trim(),
                industry_tags: document.getElementById('component-industry-input').value.trim()
            };
            
            if (!componentData.title || !componentData.content) {
                showStatus('Please provide both title and content.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/add_component', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(componentData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`✅ Component "${componentData.title}" created successfully!`, 'success');
                    closeCreateComponentModal();
                    loadComponentLibrary();
                    loadDashboard();
                } else {
                    showStatus(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error saving component:', error);
                showStatus('❌ Error saving component. Please try again.', 'error');
            }
        }

        // Close create component modal
        function closeCreateComponentModal() {
            document.getElementById('create-component-modal').style.display = 'none';
            
            // Clear form
            document.getElementById('component-title-input').value = '';
            document.getElementById('component-content-input').value = '';
            document.getElementById('component-keywords-input').value = '';
            document.getElementById('component-industry-input').value = '';
            document.getElementById('selected-text-preview').value = '';
        }

        // Clear resume display
        function clearResumeDisplay() {
            document.getElementById('resume-display-section').style.display = 'none';
            document.getElementById('resume-display-area').textContent = '';
            currentResumeText = '';
            selectedText = '';
            showStatus('Resume display cleared.', 'info');
        }

        // Status message function
        function showStatus(message, type = 'info') {
            let statusDiv = document.getElementById('status-messages');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'status-messages';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    max-width: 400px;
                    padding: 1rem;
                    background: #f8f9ff;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                document.body.appendChild(statusDiv);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.parentNode.removeChild(statusDiv);
                    }
                }, 5000);
            }
            
            // Set styles based on type
            const styles = {
                info: { background: '#e3f2fd', border: '1px solid #2196f3', color: '#1976d2' },
                success: { background: '#e8f5e8', border: '1px solid #4caf50', color: '#2e7d32' },
                error: { background: '#ffebee', border: '1px solid #f44336', color: '#c62828' },
                warning: { background: '#fff3cd', border: '1px solid #ffc107', color: '#856404' }
            };
            
            const style = styles[type] || styles.info;
            statusDiv.innerHTML = `<div style="background: ${style.background}; border: ${style.border}; color: ${style.color}; padding: 0.75rem; border-radius: 6px;">${message}</div>`;
            
            // Auto-clear success and info messages after 5 seconds
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    if (statusDiv && statusDiv.innerHTML) {
                        statusDiv.innerHTML = '';
                    }
                }, 5000);
            }
        }

        // Update component display to use API and include delete buttons
        async function loadComponentLibrary() {
            try {
                const response = await fetch('/api/components');
                const components = await response.json();
                displayComponents(components);
            } catch (error) {
                console.error('Error loading components:', error);
                showStatus('Error loading components', 'error');
                // Fallback to local storage
                displayComponents(db.components);
            }
        }

        function displayComponents(components) {
            const grid = document.getElementById('component-grid');
            grid.innerHTML = components.map(component => `
                <div class="component-card" onclick="selectComponent('${component.id}')">
                    <div class="component-title">${component.title}</div>
                    <div class="component-preview">${component.content}</div>
                    <div class="component-meta">
                        <span>${component.section_type_name || component.section_type}</span>
                        <span>Used: ${component.usage_count || 0} times</span>
                    </div>
                    <div class="component-actions">
                        <button class="edit-btn" onclick="event.stopPropagation(); editComponentDetails('${component.id}')">✏️ Edit</button>
                        <button class="delete-btn" onclick="event.stopPropagation(); deleteComponent('${component.id}', '${component.title}')">🗑️ Delete</button>
                    </div>
                </div>
            `).join('') || '<p>No components found. Add some components to get started.</p>';
        }

        // Delete component function
        async function deleteComponent(componentId, componentTitle) {
            const confirmed = confirm(`Are you sure you want to delete "${componentTitle}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch(`/api/components/${componentId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showStatus(`✅ Component "${componentTitle}" deleted successfully!`, 'success');
                    loadComponentLibrary();
                    loadDashboard();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error deleting component: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting component:', error);
                showStatus('❌ Error deleting component. Please try again.', 'error');
            }
        }

        // Edit component function
        async function editComponentDetails(componentId) {
            try {
                // First try to get component from API
                const response = await fetch(`/api/components/${componentId}`);
                let component;
                
                if (response.ok) {
                    component = await response.json();
                } else {
                    // Fallback to local storage
                    component = db.components.find(comp => comp.id == componentId);
                }
                
                if (!component) {
                    showStatus('Component not found.', 'error');
                    return;
                }
                
                // Pre-fill the component modal with existing data
                document.getElementById('modal-section-type').value = component.section_type || 'professional_summary';
                document.getElementById('modal-skill-level').value = component.skill_level || 'intermediate';
                document.getElementById('modal-title').value = component.title || '';
                document.getElementById('modal-content').value = component.content || '';
                document.getElementById('modal-keywords').value = component.keywords || '';
                document.getElementById('modal-industry-tags').value = component.industry_tags || '';
                
                // Store the ID for updating instead of creating new
                window.editingComponentId = componentId;
                
                // Show the modal
                document.getElementById('component-modal').style.display = 'block';
                
                showStatus('Editing component. Modify the details and save.', 'info');
                
            } catch (error) {
                console.error('Error loading component for editing:', error);
                showStatus('Error loading component for editing.', 'error');
            }
        }

        // Update dashboard to use API
        async function loadDashboard() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                document.getElementById('total-components').textContent = stats.total_components || 0;
                document.getElementById('total-jobs').textContent = stats.total_resumes || 0;
                document.getElementById('total-resumes').textContent = stats.total_resumes || 0;
                document.getElementById('total-employers').textContent = stats.total_employment || 0;
            } catch (error) {
                console.error('Error loading dashboard:', error);
                // Fallback to local storage
                document.getElementById('total-components').textContent = db.components.length;
                document.getElementById('total-jobs').textContent = db.jobDescriptions.length;
                document.getElementById('total-resumes').textContent = db.generatedResumes.length;
                document.getElementById('total-employers').textContent = db.employment.length;
            }
        }

        // Settings functions
        function saveSettings() {
            alert('Settings saved successfully!');
        }
        
        function exportDatabase() {
            const data = {
                components: db.components,
                employment: db.employment,
                jobDescriptions: db.jobDescriptions,
                generatedResumes: db.generatedResumes
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resume_database_backup.json';
            a.click();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Add sample data if database is empty
            if (db.components.length === 0) {
                addSampleData();
            }
        });
        
        function addSampleData() {
            // Add sample components
            const sampleComponents = [
                {
                    section_type: 'professional_summary',
                    title: 'Desktop Support Specialist Summary',
                    content: 'Experienced Desktop Support Specialist with 16+ years providing technical support across diverse environments. Expert in Windows, Active Directory, and ServiceNow with proven track record in enterprise deployments.',
                    keywords: 'desktop support, windows, active directory, servicenow, technical support',
                    industry_tags: 'healthcare, finance, technology',
                    skill_level: 'expert'
                },
                {
                    section_type: 'technical_skills',
                    title: 'Windows Administration',
                    content: 'Windows 10/11, Windows Server 2016/2019, Active Directory, Group Policy, BitLocker, VDI, Remote Desktop Services',
                    keywords: 'windows, server, active directory, group policy, bitlocker',
                    industry_tags: 'enterprise, corporate',
                    skill_level: 'expert'
                },
                {
                    section_type: 'projects',
                    title: 'TD Bank Desktop Deployment',
                    content: 'Led desktop support deployment across 20 retail locations during 2020 rollout, ensuring minimal disruption and seamless transition to new hardware and software systems.',
                    keywords: 'deployment, retail, project management, hardware',
                    industry_tags: 'finance, banking',
                    skill_level: 'advanced'
                }
            ];
            
            sampleComponents.forEach(component => {
                db.addComponent(component);
            });
            
            // Add sample employment
            const sampleEmployment = {
                company_name: 'Field Services Nationwide',
                position_title: 'Senior Desktop Support Technician',
                start_date: '2020-01-01',
                end_date: '',
                location: 'Vermont, USA',
                employment_type: 'contract',
                responsibilities: 'Desktop support, hardware deployment, troubleshooting, customer service',
                achievements: 'Completed 960+ work orders with 99% customer satisfaction',
                technologies: 'Windows, Active Directory, ServiceNow, SCCM, BitLocker'
            };
            
            db.addEmployment(sampleEmployment);
        }

        // Modal functions
        function showAddComponentModal() {
            document.getElementById('component-modal').style.display = 'block';
        }
        
        function showAddEmploymentModal() {
            document.getElementById('employment-modal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Clear editing state when closing employment modal
            if (modalId === 'employment-modal' && window.editingEmploymentId) {
                delete window.editingEmploymentId;
                
                // Clear the form
                const fields = ['emp-company', 'emp-position', 'emp-start-date', 'emp-end-date', 
                               'emp-location', 'emp-type', 'emp-responsibilities', 'emp-achievements', 'emp-technologies'];
                fields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) element.value = '';
                });
            }
            
            // Clear editing state when closing component modal
            if (modalId === 'component-modal' && window.editingComponentId) {
                delete window.editingComponentId;
                
                // Clear the form
                const fields = ['modal-title', 'modal-content', 'modal-keywords', 'modal-industry-tags'];
                fields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) element.value = '';
                });
                
                // Reset selects to default
                document.getElementById('modal-section-type').value = 'professional_summary';
                document.getElementById('modal-skill-level').value = 'intermediate';
            }
        }

        // Component and employment functions
        function selectComponent(componentId) {
            showStatus('Component selected', 'info');
        }

        function searchComponents() {
            const query = document.getElementById('component-search').value;
            const sectionFilter = document.getElementById('section-filter').value;
            // Implementation would use API search
            showStatus('Search functionality available', 'info');
        }

        async function saveComponent() {
            const component = {
                section_type: document.getElementById('modal-section-type').value,
                title: document.getElementById('modal-title').value.trim(),
                content: document.getElementById('modal-content').value.trim(),
                keywords: document.getElementById('modal-keywords').value.trim(),
                industry_tags: document.getElementById('modal-industry-tags').value.trim()
            };
            
            if (!component.title || !component.content) {
                showStatus('Please fill in title and content.', 'error');
                return;
            }
            
            try {
                let response;
                let result;
                
                // Check if we're editing an existing component
                if (window.editingComponentId) {
                    // Update existing component via API
                    response = await fetch(`/api/components/${window.editingComponentId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(component)
                    });
                    
                    if (response.ok) {
                        result = await response.json();
                        showStatus(`✅ Component "${component.title}" updated successfully!`, 'success');
                    } else {
                        // Fallback to local storage update
                        const existingIndex = db.components.findIndex(comp => comp.id == window.editingComponentId);
                        if (existingIndex !== -1) {
                            component.id = window.editingComponentId;
                            component.created_at = db.components[existingIndex].created_at;
                            component.updated_at = new Date().toISOString();
                            db.components[existingIndex] = component;
                            db.saveComponents();
                            showStatus(`✅ Component "${component.title}" updated successfully!`, 'success');
                        } else {
                            showStatus('Component not found for update.', 'error');
                            return;
                        }
                    }
                    
                    // Clear the editing flag
                    delete window.editingComponentId;
                } else {
                    // Create new component
                    response = await fetch('/add_component', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(component)
                    });
                    
                    result = await response.json();
                    
                    if (result.success) {
                        showStatus(`✅ Component "${component.title}" saved successfully!`, 'success');
                    } else {
                        showStatus(`❌ Error: ${result.error}`, 'error');
                        return;
                    }
                }
                
                closeModal('component-modal');
                
                // Clear form
                document.getElementById('modal-title').value = '';
                document.getElementById('modal-content').value = '';
                document.getElementById('modal-keywords').value = '';
                document.getElementById('modal-industry-tags').value = '';
                
                loadComponentLibrary();
                loadDashboard();
                
            } catch (error) {
                console.error('Error saving component:', error);
                showStatus('❌ Error saving component. Please try again.', 'error');
            }
        }

        async function saveEmployment() {
            const employment = {
                company_name: document.getElementById('emp-company').value,
                position_title: document.getElementById('emp-position').value,
                start_date: document.getElementById('emp-start-date').value,
                end_date: document.getElementById('emp-end-date').value,
                location: document.getElementById('emp-location').value,
                employment_type: document.getElementById('emp-type').value,
                responsibilities: document.getElementById('emp-responsibilities').value,
                achievements: document.getElementById('emp-achievements').value,
                technologies: document.getElementById('emp-technologies').value
            };
            
            if (!employment.company_name.trim() || !employment.position_title.trim()) {
                showStatus('Please fill in company name and position title.', 'error');
                return;
            }
            
            // Check if we're editing an existing entry
            if (window.editingEmploymentId) {
                // Update existing employment entry
                const existingIndex = db.employment.findIndex(emp => emp.id === window.editingEmploymentId);
                if (existingIndex !== -1) {
                    // Keep the original ID and created_at
                    employment.id = window.editingEmploymentId;
                    employment.created_at = db.employment[existingIndex].created_at;
                    employment.updated_at = new Date().toISOString();
                    db.employment[existingIndex] = employment;
                    showStatus('Employment history updated successfully!', 'success');
                } else {
                    showStatus('Employment entry not found for update.', 'error');
                    return;
                }
                
                // Clear the editing flag
                delete window.editingEmploymentId;
            } else {
                // Create new employment entry
                db.addEmployment(employment);
                showStatus('Employment history saved successfully!', 'success');
            }
            
            db.saveEmployment();
            closeModal('employment-modal');
            
            // Clear form
            Object.keys(employment).forEach(key => {
                if (key !== 'id' && key !== 'created_at' && key !== 'updated_at') {
                    const element = document.getElementById('emp-' + key.replace('_', '-'));
                    if (element) element.value = '';
                }
            });
            
            loadEmploymentHistory();
            loadDashboard();
        }

        function loadEmploymentHistory() {
            const list = document.getElementById('employment-list');
            list.innerHTML = db.employment.map(emp => `
                <div class="employment-entry">
                    <h4>${emp.position_title} at ${emp.company_name}</h4>
                    <p><strong>Duration:</strong> ${emp.start_date} - ${emp.end_date || 'Present'}</p>
                    <p><strong>Location:</strong> ${emp.location}</p>
                    <p><strong>Type:</strong> ${emp.employment_type}</p>
                    ${emp.responsibilities ? `<p><strong>Responsibilities:</strong> ${emp.responsibilities}</p>` : ''}
                    ${emp.achievements ? `<p><strong>Achievements:</strong> ${emp.achievements}</p>` : ''}
                    ${emp.technologies ? `<p><strong>Technologies:</strong> ${emp.technologies}</p>` : ''}
                    <div class="component-actions" style="margin-top: 1rem;">
                        <button class="edit-btn" onclick="editEmployment('${emp.id}')">✏️ Edit</button>
                        <button class="delete-btn" onclick="deleteEmployment('${emp.id}', '${emp.position_title} at ${emp.company_name}')">🗑️ Delete</button>
                    </div>
                </div>
            `).join('') || '<p>No employment history added yet.</p>';
        }

        // Delete employment function
        function deleteEmployment(employmentId, employmentTitle) {
            const confirmed = confirm(`Are you sure you want to delete "${employmentTitle}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            // Remove from local storage
            db.employment = db.employment.filter(emp => emp.id !== employmentId);
            db.saveEmployment();
            
            showStatus(`✅ Employment entry "${employmentTitle}" deleted successfully!`, 'success');
            loadEmploymentHistory();
            loadDashboard();
        }

        // Edit employment function
        function editEmployment(employmentId) {
            const employment = db.employment.find(emp => emp.id === employmentId);
            
            if (!employment) {
                showStatus('Employment entry not found.', 'error');
                return;
            }
            
            // Pre-fill the employment modal with existing data
            document.getElementById('emp-company').value = employment.company_name || '';
            document.getElementById('emp-position').value = employment.position_title || '';
            document.getElementById('emp-start-date').value = employment.start_date || '';
            document.getElementById('emp-end-date').value = employment.end_date || '';
            document.getElementById('emp-location').value = employment.location || '';
            document.getElementById('emp-type').value = employment.employment_type || 'full-time';
            document.getElementById('emp-responsibilities').value = employment.responsibilities || '';
            document.getElementById('emp-achievements').value = employment.achievements || '';
            document.getElementById('emp-technologies').value = employment.technologies || '';
            
            // Store the ID for updating instead of creating new
            window.editingEmploymentId = employmentId;
            
            // Show the modal
            document.getElementById('employment-modal').style.display = 'block';
            
            showStatus('Editing employment entry. Modify the details and save.', 'info');
        }

        // Export employment data function
        function exportEmploymentData() {
            if (db.employment.length === 0) {
                showStatus('No employment history to export.', 'warning');
                return;
            }
            
            const data = {
                employment_history: db.employment,
                exported_at: new Date().toISOString(),
                total_entries: db.employment.length
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `employment_history_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showStatus('Employment history exported successfully!', 'success');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal, [id$="-modal"]');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Resume Library Functions
        function switchResumeSubTab(subtabName) {
            // Remove active class from all sub-tabs and content
            document.querySelectorAll('.sub-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.sub-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected sub-tab and content
            document.querySelector(`[data-subtab="${subtabName}"]`).classList.add('active');
            document.getElementById(subtabName).classList.add('active');
            
            // Load content based on sub-tab
            if (subtabName === 'uploaded-resumes') {
                loadUploadedResumes();
            } else if (subtabName === 'templates') {
                loadTemplates();
            }
        }

        // Uploaded Resumes Functions
        async function loadUploadedResumes() {
            try {
                const includeArchived = document.getElementById('include-archived').checked;
                const response = await fetch(`/api/uploaded-resumes?include_archived=${includeArchived}`);
                const resumes = await response.json();
                
                displayUploadedResumes(resumes);
                updateResumeStats(resumes);
                
            } catch (error) {
                console.error('Error loading uploaded resumes:', error);
                showStatus('Error loading uploaded resumes', 'error');
            }
        }

        function displayUploadedResumes(resumes) {
            const grid = document.getElementById('uploaded-resumes-grid');
            
            if (!resumes || resumes.length === 0) {
                grid.innerHTML = '<p>No uploaded resumes found. Upload a resume using the Resume Importer to get started.</p>';
                return;
            }
            
            grid.innerHTML = resumes.map(resume => `
                <div class="resume-card">
                    <div class="component-title">${resume.resume_title || resume.original_filename}</div>
                    <div class="file-info">
                        📁 ${resume.original_filename} (${formatFileSize(resume.file_size)})
                        ${resume.file_type ? `• ${resume.file_type.toUpperCase()}` : ''}
                    </div>
                    <div class="component-preview" style="max-height: 100px; overflow: hidden;">
                        ${resume.full_text_content.substring(0, 200)}${resume.full_text_content.length > 200 ? '...' : ''}
                    </div>
                    ${resume.tags && resume.tags.length > 0 ? `
                        <div class="tags">
                            ${resume.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="resume-meta">
                        <span>📅 ${new Date(resume.created_at).toLocaleDateString()}</span>
                        <span>🧩 ${resume.components_extracted || 0} components</span>
                    </div>
                    <div class="component-actions">
                        <button class="edit-btn" onclick="viewResumeDetails('${resume.id}')">👁️ View</button>
                        <button class="edit-btn" onclick="editResumeDetails('${resume.id}')">✏️ Edit</button>
                        <button class="delete-btn" onclick="deleteUploadedResume('${resume.id}', '${resume.resume_title || resume.original_filename}')">🗑️ Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function searchUploadedResumes() {
            const query = document.getElementById('resume-search').value;
            const includeArchived = document.getElementById('include-archived').checked;
            
            try {
                const response = await fetch(`/api/uploaded-resumes?q=${encodeURIComponent(query)}&include_archived=${includeArchived}`);
                const resumes = await response.json();
                displayUploadedResumes(resumes);
                updateResumeStats(resumes);
            } catch (error) {
                console.error('Error searching resumes:', error);
                showStatus('Error searching resumes', 'error');
            }
        }

        async function deleteUploadedResume(resumeId, resumeTitle) {
            const confirmed = confirm(`Are you sure you want to delete "${resumeTitle}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch(`/api/uploaded-resumes/${resumeId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showStatus(`✅ Resume "${resumeTitle}" deleted successfully!`, 'success');
                    loadUploadedResumes();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error deleting resume: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting resume:', error);
                showStatus('❌ Error deleting resume. Please try again.', 'error');
            }
        }

        function updateResumeStats(resumes) {
            document.getElementById('total-uploaded-resumes').textContent = resumes.length;
            const totalComponents = resumes.reduce((sum, resume) => sum + (resume.components_extracted || 0), 0);
            document.getElementById('total-extracted-components').textContent = totalComponents;
        }

        // Templates Functions
        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');
                const templates = await response.json();
                displayTemplates(templates);
            } catch (error) {
                console.error('Error loading templates:', error);
                showStatus('Error loading templates', 'error');
            }
        }

        function displayTemplates(templates) {
            const grid = document.getElementById('templates-grid');
            
            if (!templates || templates.length === 0) {
                grid.innerHTML = '<p>No templates found. Create your first template to get started.</p>';
                return;
            }
            
            grid.innerHTML = templates.map(template => `
                <div class="template-card">
                    <div class="component-title">${template.template_name} ${template.is_default ? '⭐' : ''}</div>
                    <div class="component-preview" style="max-height: 80px; overflow: hidden;">
                        ${template.description || 'No description provided'}
                    </div>
                    <div class="file-info">
                        ${template.target_role ? `🎯 ${template.target_role}` : ''} 
                        ${template.target_industry ? `• 🏢 ${template.target_industry}` : ''}
                    </div>
                    <div class="template-meta">
                        <span>📅 ${new Date(template.created_at).toLocaleDateString()}</span>
                        <span>📊 Used ${template.usage_count || 0} times</span>
                    </div>
                    <div class="component-actions">
                        <button class="edit-btn" onclick="viewTemplateDetails('${template.id}')">👁️ View</button>
                        <button class="edit-btn" onclick="editTemplateDetails('${template.id}')">✏️ Edit</button>
                        ${!template.is_default ? `<button class="delete-btn" onclick="deleteTemplate('${template.id}', '${template.template_name}')">🗑️ Delete</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function searchTemplates() {
            const query = document.getElementById('template-search').value;
            try {
                const response = await fetch(`/api/templates?q=${encodeURIComponent(query)}`);
                const templates = await response.json();
                displayTemplates(templates);
            } catch (error) {
                console.error('Error searching templates:', error);
                showStatus('Error searching templates', 'error');
            }
        }

        async function deleteTemplate(templateId, templateName) {
            const confirmed = confirm(`Are you sure you want to delete template "${templateName}"?\n\nThis action cannot be undone.`);
            
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch(`/api/templates/${templateId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showStatus(`✅ Template "${templateName}" deleted successfully!`, 'success');
                    loadTemplates();
                } else {
                    const error = await response.json();
                    showStatus(`❌ Error deleting template: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting template:', error);
                showStatus('❌ Error deleting template. Please try again.', 'error');
            }
        }

        // Helper Functions
        function formatFileSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function viewResumeDetails(resumeId) {
            showStatus('Resume details view coming soon!', 'info');
        }

        function editResumeDetails(resumeId) {
            showStatus('Resume editing coming soon!', 'info');
        }

        function viewTemplateDetails(templateId) {
            showStatus('Template details view coming soon!', 'info');
        }

        function editTemplateDetails(templateId) {
            showStatus('Template editing coming soon!', 'info');
        }

        function showAddTemplateModal() {
            showStatus('Template creation modal coming soon!', 'info');
        }

        // Resume Builder Shopping Cart Functions
        let cart = [];
        let builderComponents = [];

        // Load components for the resume builder
        async function loadBuilderComponents() {
            try {
                const response = await fetch('/api/components');
                if (response.ok) {
                    builderComponents = await response.json();
                } else {
                    // Fallback to local storage
                    builderComponents = db.components;
                }
                displayBuilderComponents();
            } catch (error) {
                console.error('Error loading builder components:', error);
                builderComponents = db.components;
                displayBuilderComponents();
            }
        }

        // Display components in the sidebar
        function displayBuilderComponents(components = builderComponents) {
            const list = document.getElementById('builder-component-list');
            
            if (!components || components.length === 0) {
                list.innerHTML = '<p class="cart-empty">No components available. Add some components first.</p>';
                return;
            }

            list.innerHTML = components.map(component => {
                const isInCart = cart.some(item => item.id === component.id);
                return `
                    <div class="builder-component-item">
                        <div class="builder-component-title">${component.title}</div>
                        <div class="builder-component-preview">${component.content.substring(0, 80)}${component.content.length > 80 ? '...' : ''}</div>
                        <div class="builder-component-meta">
                            <span>${component.section_type_name || component.section_type || 'General'}</span>
                            <span>Used: ${component.usage_count || 0}x</span>
                        </div>
                        <button class="add-to-cart-btn" onclick="addToCart('${component.id}')" ${isInCart ? 'disabled' : ''}>
                            ${isInCart ? '✓ In Cart' : '🛒 Add to Cart'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Filter components in builder
        function filterBuilderComponents() {
            const searchTerm = document.getElementById('component-builder-search').value.toLowerCase();
            const typeFilter = document.getElementById('component-type-filter').value;
            
            let filtered = builderComponents.filter(component => {
                const matchesSearch = component.title.toLowerCase().includes(searchTerm) || 
                                    component.content.toLowerCase().includes(searchTerm) ||
                                    (component.keywords && component.keywords.toLowerCase().includes(searchTerm));
                                    
                const matchesType = !typeFilter || component.section_type === typeFilter;
                
                return matchesSearch && matchesType;
            });
            
            displayBuilderComponents(filtered);
        }

        // Add component to cart
        function addToCart(componentId) {
            const component = builderComponents.find(comp => comp.id == componentId);
            if (!component) {
                showStatus('Component not found', 'error');
                return;
            }
            
            // Check if already in cart
            if (cart.some(item => item.id === component.id)) {
                showStatus('Component already in cart', 'warning');
                return;
            }
            
            cart.push({
                id: component.id,
                title: component.title,
                content: component.content,
                section_type: component.section_type,
                section_type_name: component.section_type_name || component.section_type,
                keywords: component.keywords
            });
            
            updateCartDisplay();
            displayBuilderComponents(); // Refresh to update button states
            showStatus(`Added "${component.title}" to cart`, 'success');
        }

        // Remove component from cart
        function removeFromCart(componentId) {
            cart = cart.filter(item => item.id !== componentId);
            updateCartDisplay();
            displayBuilderComponents(); // Refresh to update button states
            showStatus('Component removed from cart', 'info');
        }

        // Update cart display
        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            
            cartCount.textContent = `${cart.length} item${cart.length !== 1 ? 's' : ''}`;
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="cart-empty">Add components to your cart to build your resume</p>';
                return;
            }
            
            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <button class="remove-from-cart" onclick="removeFromCart('${item.id}')">×</button>
                    <div class="cart-item-title">${item.title}</div>
                    <div class="cart-item-preview">${item.content.substring(0, 60)}${item.content.length > 60 ? '...' : ''}</div>
                    <span class="cart-item-type">${item.section_type_name || item.section_type}</span>
                </div>
            `).join('');
        }

        // Clear entire cart
        function clearCart() {
            if (cart.length === 0) {
                showStatus('Cart is already empty', 'info');
                return;
            }
            
            const confirmed = confirm(`Are you sure you want to clear all ${cart.length} items from your cart?`);
            if (confirmed) {
                cart = [];
                updateCartDisplay();
                displayBuilderComponents();
                showStatus('Cart cleared', 'info');
            }
        }

        // Checkout cart - build resume
        function checkoutCart() {
            if (cart.length === 0) {
                showStatus('Cart is empty. Add some components first.', 'warning');
                return;
            }
            
            generateResumePreview();
            showStatus(`Checked out ${cart.length} components. Resume updated!`, 'success');
        }

        // Generate resume preview from cart contents
        function generateResumePreview() {
            const resumeContent = document.getElementById('resume-content');
            const resumeTitle = document.getElementById('resume-title').value || 'Professional Resume';
            
            if (cart.length === 0) {
                resumeContent.innerHTML = '<p class="empty-canvas">Select components from the library and add them to your cart, then checkout to build your resume.</p>';
                return;
            }
            
            // Group components by section type
            const sections = {};
            cart.forEach(component => {
                const sectionType = component.section_type || 'general';
                if (!sections[sectionType]) {
                    sections[sectionType] = [];
                }
                sections[sectionType].push(component);
            });
            
            // Define section order and names
            const sectionOrder = {
                'professional_summary': 'Professional Summary',
                'technical_skills': 'Technical Skills',
                'work_experience': 'Work Experience', 
                'projects': 'Projects',
                'education': 'Education',
                'certifications': 'Certifications',
                'achievements': 'Achievements',
                'general': 'Additional Information'
            };
            
            let resumeHTML = '';
            
            // Generate sections in order
            Object.keys(sectionOrder).forEach(sectionType => {
                if (sections[sectionType]) {
                    const sectionName = sectionOrder[sectionType];
                    resumeHTML += `
                        <div class="resume-section">
                            <h3>${sectionName}</h3>
                            ${sections[sectionType].map(component => `
                                <div class="resume-item">
                                    <h4>${component.title}</h4>
                                    <p>${component.content}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            resumeContent.innerHTML = resumeHTML;
            
            // Update resume title in header if provided
            if (resumeTitle && resumeTitle !== 'Professional Resume') {
                document.getElementById('resume-name').textContent = resumeTitle;
            }
        }

        // Export resume as text/HTML
        function exportResume() {
            const resumePreview = document.getElementById('resume-preview');
            const resumeTitle = document.getElementById('resume-title').value || 'Resume';
            
            if (cart.length === 0) {
                showStatus('No components to export. Build your resume first.', 'warning');
                return;
            }
            
            // Create HTML content
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${resumeTitle}</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.4; }
                        .resume-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #2f5597; padding-bottom: 10px; }
                        .resume-header h1 { margin: 0; color: #2f5597; font-size: 24px; }
                        .resume-header p { margin: 5px 0 0 0; color: #666; font-size: 14px; }
                        .resume-section { margin-bottom: 20px; }
                        .resume-section h3 { color: #2f5597; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; font-size: 16px; }
                        .resume-item { margin-bottom: 15px; padding: 10px; background-color: #fafafa; border-left: 3px solid #2f5597; }
                        .resume-item h4 { margin: 0 0 5px 0; color: #333; font-size: 14px; }
                        .resume-item p { margin: 0; font-size: 12px; line-height: 1.4; }
                    </style>
                </head>
                <body>
                    ${resumePreview.innerHTML}
                </body>
                </html>
            `;
            
            // Create and download file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${resumeTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('Resume exported successfully!', 'success');
        }

        // Save resume as template
        function saveResumeTemplate() {
            const resumeTitle = document.getElementById('resume-title').value;
            
            if (cart.length === 0) {
                showStatus('No components to save as template. Build your resume first.', 'warning');
                return;
            }
            
            if (!resumeTitle) {
                showStatus('Please enter a resume title before saving as template.', 'warning');
                return;
            }
            
            const template = {
                template_name: resumeTitle,
                description: `Template with ${cart.length} components`,
                components: cart.map(c => c.id),
                created_at: new Date().toISOString(),
                usage_count: 0
            };
            
            // Store in local storage for now (could be enhanced to save to database)
            const templates = JSON.parse(localStorage.getItem('resume_templates') || '[]');
            templates.push({
                ...template,
                id: Date.now().toString()
            });
            localStorage.setItem('resume_templates', JSON.stringify(templates));
            
            showStatus(`Template "${resumeTitle}" saved successfully!`, 'success');
        }

        // Initialize resume builder when tab is activated
        function initializeResumeBuilder() {
            loadBuilderComponents();
            updateCartDisplay();
        }

        // Load builder components when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize resume builder if the tab is already active
            const resumeBuilderTab = document.getElementById('resume-builder');
            if (resumeBuilderTab && resumeBuilderTab.classList.contains('active')) {
                initializeResumeBuilder();
            }
        });

        // Override the switchTab function to initialize builder when activated
        const originalSwitchTab = window.switchTab;
        window.switchTab = function(tabName) {
            if (originalSwitchTab) {
                originalSwitchTab(tabName);
            } else {
                // Basic tab switching if original function doesn't exist
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                
                document.getElementById(tabName).classList.add('active');
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            }
            
            if (tabName === 'resume-builder') {
                initializeResumeBuilder();
            }
        };
    </script>
</body>
</html>